<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title><![CDATA[简单修复MacOS High Sierra 允许 Root 用户无密码登录的安全 Bug]]></title>
      <url>/2017/11/29/mac10-13-root-bug/</url>
      <content type="html"><![CDATA[<p>macOS High Sierra 最近爆出一个严重的安全漏洞，允许任何人在没有密码的情况下以完全管理功能的 root 用户登录到 Mac。据说已经有安全补丁，但是很多人未收到推送。</p>
<p>受影响的系统版本：</p>
<ul>
<li>macOS High Sierra 10.13</li>
<li>macOS High Sierra 10.13.1</li>
<li>macOS High Sierra 10.13.2 beta</li>
</ul>
<p>同时，这些系统下还需符合以下<strong>条件之一</strong>时才会受到安全漏洞的影响：</p>
<ul>
<li>以前<strong>没有</strong>启用 root 账户</li>
<li><strong>没有</strong>在 Mac 上更改过 root 用户账户密码</li>
</ul>
<p>这里有个比较简单的解决方法，可以防止这个安全 Bug 成为一个大问题。简单来说就是：<strong>在受影响的 Mac 上设置 root 用户的密码。</strong></p>
<h2 id="为-root-账户设置密码"><a href="#为-root-账户设置密码" class="headerlink" title="为 root 账户设置密码"></a>为 root 账户设置密码</h2><p>有两个方法来为 root 账户设置密码：</p>
<ol>
<li>使用「目录实用工具」（Directory Utility）</li>
<li>使用「命令行工具」（Terminal）</li>
</ol>
<h3 id="方法一：目录实用工具"><a href="#方法一：目录实用工具" class="headerlink" title="方法一：目录实用工具"></a>方法一：目录实用工具</h3><ol>
<li>打开 Spotlight （Command+Spacebar）输入 <code>Directory Utility</code> 打开「目录实用工具」；</li>
<li>点击「服务」页左下方的小锁，输入当前账户的密码后点击「修改配置」确认进行解锁；</li>
<li>点击菜单栏中的「编辑」-「更改 Root 密码」，输入两次密码（一定要记好了）并点「确定」即可。</li>
</ol>
<p>注意：如果「3」中更改 Root 密码不能点选，先点击「启用 Root 用户」。</p>
<h3 id="方法二：终端命令行"><a href="#方法二：终端命令行" class="headerlink" title="方法二：终端命令行"></a>方法二：终端命令行</h3><ol>
<li>在 LaunchPad 里打开 「终端」；</li>
<li>在「终端」里输入：<code>sudo passwd root</code> ；</li>
<li>键入当前账户的密码</li>
<li>看到：Changing password for root.New password 时即开始输入你要设置的 root 用户的密码</li>
</ol>
<h2 id="自检是否受免密码登录-root-漏洞的影响"><a href="#自检是否受免密码登录-root-漏洞的影响" class="headerlink" title="自检是否受免密码登录 root 漏洞的影响"></a>自检是否受免密码登录 root 漏洞的影响</h2><p>你可以从通用启动登录界面或通过系统首选项（如安全性与隐私或用户和组）中的任何管理员身份验证面板（单击锁定图标）执行此操作。把用户名输入为：root，不要输密码，然后点两次「解锁」，能解锁的话即受此漏洞影响。</p>
]]></content>
      
        
        <tags>
            
            <tag> Mac </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android 必知必会 - 获取手机系统的构建模式]]></title>
      <url>/2017/10/09/android-usermode/</url>
      <content type="html"><![CDATA[<p>关键词：<code>Android</code> 、<code>Make</code> 、<code>user mode</code> 、<code>user</code> 、<code>userdebug</code> 、<code>eng</code></p>
<hr>
<p>判定手机系统的构建模式、用户模式</p>
<p>编译 Rom 时，需要指定目标构建模式，构建模式有三种：用户模式 user、用户调试模式 userdebug 和工程模式 eng</p>
<a id="more"></a>
<blockquote>
<ul>
<li>用户模式 user<ul>
<li>仅安装标签为 user 的模块</li>
<li>设定属性 ro.secure=1，打开安全检查功能</li>
<li>设定属性 ro.debuggable=0，关闭应用调试功能</li>
<li>默认关闭 adb 功能</li>
<li>打开 Proguard 混淆器</li>
<li>打开 DEXPREOPT 预先编译优化</li>
</ul>
</li>
<li>用户调试模式 userdebug<ul>
<li>安装标签为 user、debug 的模块</li>
<li>设定属性 ro.secure=1，打开安全检查功能</li>
<li>设定属性 ro.debuggable=1，启用应用调试功能</li>
<li>默认打开 adb 功能</li>
<li>打开 Proguard 混淆器</li>
<li>打开 DEXPREOPT 预先编译优化</li>
</ul>
</li>
<li>工程模式 eng<ul>
<li>安装标签为 user、debug、eng 的模块</li>
<li>设定属性 ro.secure=0，关闭安全检查功能</li>
<li>设定属性 ro.debuggable=1，启用应用调试功能</li>
<li>设定属性 ro.kernel.android.checkjni=1，启用 JNI 调用检查</li>
<li>默认打开 adb 功能</li>
<li>关闭 Proguard 混淆器</li>
<li>关闭 DEXPREOPT 预先编译优化</li>
</ul>
</li>
</ul>
<p>指定目标构建模式：在 <code>make</code> 命令中加入参数</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; $ sudo make -j8 PRODUCT-rk312x-user</div><div class="line">&gt; $ sudo make -j8 PRODUCT-rk312x-userdebug</div><div class="line">&gt; $ sudo make -j8 PRODUCT-rk312x-eng</div><div class="line">&gt;</div></pre></td></tr></table></figure>
<p>来源：<a href="https://www.kancloud.cn/amoy0226/fireprime_android_compile/105885" target="_blank" rel="external">https://www.kancloud.cn/amoy0226/fireprime_android_compile/105885</a></p>
</blockquote>
<h2 id="判断构建模式"><a href="#判断构建模式" class="headerlink" title="判断构建模式"></a>判断构建模式</h2><p><strong>思路</strong>：通过观察以上三个模式的属性，这里使用安全检查功能（ro.securero）和应用调试功能（ro.debuggable）两个属性来区分这三个模式：</p>
<ul>
<li>user：<ul>
<li>ro.securero = 1</li>
<li>ro.debuggable = 0</li>
</ul>
</li>
<li>userdebug<ul>
<li>ro.securero = 1</li>
<li>ro.debuggable = 1</li>
</ul>
</li>
<li>eng<ul>
<li>ro.securero = 0</li>
<li>ro.debuggable = 1</li>
</ul>
</li>
</ul>
<p>其中，如果只需判断是否为 user 模式，使用 ro.debuggable 一个属性即可。</p>
<h3 id="寻找源码"><a href="#寻找源码" class="headerlink" title="寻找源码"></a>寻找源码</h3><p>在 <code>android.os.Build</code> 的源码中我发现一个静态变量：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Returns true if we are running a debug build such as "user-debug" or "eng".</span></div><div class="line"><span class="comment"> * <span class="doctag">@hide</span></span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">boolean</span> IS_DEBUGGABLE =</div><div class="line">	SystemProperties.getInt(<span class="string">"ro.debuggable"</span>, <span class="number">0</span>) == <span class="number">1</span>;</div></pre></td></tr></table></figure>
<p>但是没有 <code>ro.securero</code> 这个属性，进一步发现其调用的是 <code>android.os.SystemProperties</code> 的 <code>getInt()</code>  函数，那可以直接使用它来获取  <code>ro.securero</code> 的值。</p>
<p>由于是 <code>android.os.SystemProperties</code> 是隐藏类，我们可以使用两种方式来调用其方法：</p>
<p>方法一：使用修改过增加了这些隐藏类的 android.jar 来编译 APK，此方式问题较多，配置繁琐，不推荐；</p>
<p>方法二：使用反射调用，普通 App 即可使用，无限制，推荐使用此方法。</p>
<h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><p>先说下方法一下的实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 获取系统构建模式</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * <span class="doctag">@return</span> int（0:未知, 1 user, 2 userdebug, 3 eng）</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getOSMode</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">int</span> debug = SystemProperties.getInt(<span class="string">"ro.debuggable"</span>, -<span class="number">1</span>);</div><div class="line">	<span class="keyword">int</span> secure = SystemProperties.getInt(<span class="string">"ro.secure"</span>, -<span class="number">1</span>);</div><div class="line"></div><div class="line">	<span class="keyword">if</span> (debug == <span class="number">0</span> &amp;&amp; secure == <span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (debug == <span class="number">1</span> &amp;&amp; secure == <span class="number">1</span>) <span class="keyword">return</span> <span class="number">2</span>;</div><div class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (debug == <span class="number">1</span> &amp;&amp; secure == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">3</span>;</div><div class="line">	<span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>那么方法二只是和方法一的属性获取方式不一样：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 获取系统构建模式</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * <span class="doctag">@return</span> int（0:未知, 1 user, 2 userdebug, 3 eng）</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getOSMode</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">try</span> &#123;</div><div class="line">		Class clazz = Class.forName(<span class="string">"android.os.SystemProperties"</span>);</div><div class="line">		<span class="keyword">int</span> debug = (<span class="keyword">int</span>) clazz.getMethod(<span class="string">"getInt"</span>, String.class, <span class="keyword">int</span>.class).invoke(clazz, <span class="string">"ro.debuggable"</span>, -<span class="number">1</span>);</div><div class="line">		<span class="keyword">int</span> secure = (<span class="keyword">int</span>) clazz.getMethod(<span class="string">"getInt"</span>, String.class, <span class="keyword">int</span>.class).invoke(clazz, <span class="string">"ro.secure"</span>, -<span class="number">1</span>);</div><div class="line">		<span class="keyword">if</span> (debug == <span class="number">0</span> &amp;&amp; secure == <span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (debug == <span class="number">1</span> &amp;&amp; secure == <span class="number">1</span>) <span class="keyword">return</span> <span class="number">2</span>;</div><div class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (debug == <span class="number">1</span> &amp;&amp; secure == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">3</span>;</div><div class="line">		<span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">	&#125; <span class="keyword">catch</span> (ClassNotFoundException ignore) &#123;</div><div class="line">	&#125; <span class="keyword">catch</span> (NoSuchMethodException ignore) &#123;</div><div class="line">	&#125; <span class="keyword">catch</span> (IllegalAccessException ignore) &#123;</div><div class="line">	&#125; <span class="keyword">catch</span> (InvocationTargetException ignore) &#123;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这里未对反射时可能产生的异常做处理，只是简单的返回 0，有需要请自行处理。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p><code>android.os.Build</code> 和  <code>android.os.SystemProperties</code> 的源码在 Android SDK 中，很方便寻找，比较困难的一步就是了解到所需的属性和这两个类有关，这就需要对 Android Rom 的编译有一点了解。</p>
<p><strong>PS</strong>：如果有什么建议或者问题，可以通过下面的方式和我联系</p>
<blockquote>
<ul>
<li>微博：<a href="http://weibo.com/zyansen" target="_blank" rel="external">cafeting</a></li>
<li>Github： <a href="https://github.com/likfe" target="_blank" rel="external">likfe</a></li>
<li>CSDN：<a href="http://blog.csdn.net/ys743276112" target="_blank" rel="external">他叫自己Mr.张</a> </li>
</ul>
</blockquote>
]]></content>
      
        
        <tags>
            
            <tag> Android </tag>
            
            <tag> Make </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android 必知必会 - 使用 Intent 打开第三方应用及验证可用性]]></title>
      <url>/2017/08/30/android-is-intent-available/</url>
      <content type="html"><![CDATA[<p>本文主要记录：</p>
<ul>
<li>使用 Intent 打开第三方应用或指定 Activity 的三种方式</li>
<li>使用上面三种方式时分别如何判断该 Intent 能否被解析</li>
<li>判断该 Intent 能否被解析中可能出现的遗漏</li>
</ul>
<a id="more"></a>
<h2 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h2><h3 id="1-App-的入口-Activity-与其-icon"><a href="#1-App-的入口-Activity-与其-icon" class="headerlink" title="1. App 的入口 Activity 与其 icon"></a>1. App 的入口 Activity 与其 icon</h3><p>一个普通的应用默认会有一个入口 Activity，它在 AndroidManifest.xml 中一般这样写：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">application</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">".MainActivity"</span> &gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.MAIN"</span> /&gt;</span></div><div class="line"></div><div class="line">			<span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.LAUNCHER"</span> /&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">activity</span>&gt;</span></div><div class="line">	...</div><div class="line"><span class="tag">&lt;/<span class="name">application</span>&gt;</span></div></pre></td></tr></table></figure>
<p>只有配置了一个这样的 Activity，这个应用才会点击的时候知道启动哪个 Activity，如果把 <code>category</code> 的值修改为 <code>android.intent.category.DEFAULT</code> 那么，这个应用将在桌面看不到 icon，无法直接打开了。</p>
<h2 id="使用-Intent-打开第三方应用或指定-Activity-的方式"><a href="#使用-Intent-打开第三方应用或指定-Activity-的方式" class="headerlink" title="使用 Intent 打开第三方应用或指定 Activity 的方式"></a>使用 Intent 打开第三方应用或指定 Activity 的方式</h2><ol>
<li>只知道包名 - 需要有默认的入口 Activity</li>
<li>启动指定第三方应用的 Activity - 需要包名和 Activity 名，且该 Activity 的 <code>Export=“true”</code></li>
<li>隐式启动第三方应用</li>
</ol>
<h3 id="1-使用-PackageManager-getLaunchIntentForPackage"><a href="#1-使用-PackageManager-getLaunchIntentForPackage" class="headerlink" title="1. 使用 PackageManager.getLaunchIntentForPackage()"></a>1. 使用 <code>PackageManager.getLaunchIntentForPackage()</code></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">String package_name=<span class="string">"xx.xx.xx"</span>;</div><div class="line">PackageManager packageManager = context.getPackageManager();</div><div class="line">Intent it = packageManager.getLaunchIntentForPackage(package_name);</div><div class="line">startActivity(it);</div></pre></td></tr></table></figure>
<p>该方法针对只知道包名，想要启动该应用时使用，对该应用的唯一限制是<strong>有默认的入口 Activity</strong>。</p>
<p>当没有默认的入口 Activity 时，会报 <code>NullPointerException</code> 异常：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">java.lang.NullPointerException: Attempt to invoke virtual method &apos;java.lang.String android.content.Intent.toString()&apos; on a null object reference</div></pre></td></tr></table></figure>
<p>再看看 <code>getLaunchIntentForPackage()</code> 方法的说明：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment">     * Returns a "good" intent to launch a front-door activity in a package.</span></div><div class="line"><span class="comment">     * This is used, for example, to implement an "open" button when browsing</span></div><div class="line"><span class="comment">     * through packages.  The current implementation looks first for a main</span></div><div class="line"><span class="comment">     * activity in the category &#123;<span class="doctag">@link</span> Intent#CATEGORY_INFO&#125;, and next for a</span></div><div class="line"><span class="comment">     * main activity in the category &#123;<span class="doctag">@link</span> Intent#CATEGORY_LAUNCHER&#125;. Returns</span></div><div class="line"><span class="comment">     * &lt;code&gt;null&lt;/code&gt; if neither are found.</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> packageName The name of the package to inspect.</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span> A fully-qualified &#123;<span class="doctag">@link</span> Intent&#125; that can be used to launch the</span></div><div class="line"><span class="comment">     * main activity in the package. Returns &lt;code&gt;null&lt;/code&gt; if the package</span></div><div class="line"><span class="comment">     * does not contain such an activity, or if &lt;em&gt;packageName&lt;/em&gt; is not</span></div><div class="line"><span class="comment">     * recognized.</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> Intent <span class="title">getLaunchIntentForPackage</span><span class="params">(String packageName)</span></span>;</div></pre></td></tr></table></figure>
<p>所以使用此方式判定 Intent 是否为空即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">String package_name = <span class="string">"xx.xx.xx"</span>;</div><div class="line">PackageManager packageManager = getPackageManager();</div><div class="line">Intent it = packageManager.getLaunchIntentForPackage(package_name);</div><div class="line"><span class="keyword">if</span> (it != <span class="keyword">null</span>)&#123;</div><div class="line">	startActivity(it);</div><div class="line">&#125;<span class="keyword">else</span>&#123;</div><div class="line">	<span class="comment">//没有默认的入口 Activity</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="2-使用-Intent-setComponent"><a href="#2-使用-Intent-setComponent" class="headerlink" title="2. 使用 Intent.setComponent()"></a>2. 使用 <code>Intent.setComponent()</code></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">String package_name = <span class="string">"xx.xx.xx"</span>;</div><div class="line">String activity_path = <span class="string">"xx.xx.xx.ab.xxActivity"</span>;</div><div class="line">Intent intent = <span class="keyword">new</span> Intent();</div><div class="line">intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);<span class="comment">//可选</span></div><div class="line">ComponentName comp = <span class="keyword">new</span> ComponentName(package_name,activity_path);</div><div class="line">intent.setComponent(comp);</div><div class="line">startActivity(intent);</div></pre></td></tr></table></figure>
<p>此方式可以启动一个应用指定的 Activity，不限于默认入口 Activity。但此方式要求的条件多，如下：</p>
<ol>
<li>知道 App 的包名和 Activity 的全路径及其名称</li>
<li>需要启动的目标 Activity 在 AndroidManifest.xml 中的属性 <code>Export=“true”</code></li>
</ol>
<p>那这种方式下，如何判断目标 Activity 是否存在呢？</p>
<p>下面是网上流传的非常普遍的用法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">String package_name = <span class="string">"xx.xx.xx"</span>;</div><div class="line">String activity_path = <span class="string">"xx.xx.xx.ab.xxActivity"</span>;</div><div class="line">Intent intent = <span class="keyword">new</span> Intent();</div><div class="line">intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);<span class="comment">//可选</span></div><div class="line">ComponentName cn = <span class="keyword">new</span> ComponentName(package_name,activity_path);</div><div class="line">intent.setComponent(cn);</div><div class="line"></div><div class="line"><span class="keyword">if</span> (intent.resolveActivity(getPackageManager()) != <span class="keyword">null</span>) &#123;</div><div class="line">	startActivity(intent);</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">	<span class="comment">//找不到指定的 Activity</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>遗憾的是，<code>Intent.resolveActivity()</code> 方法并不能判定此方式所要启动的 Activity 是否存在，如果此 Activity 不存在，会报 <code>java.lang.IllegalArgumentException: Unknown component</code> 异常，并导致程序崩溃。</p>
<p>下面看下 <code>resolveActivity()</code> 的代码，以及它的 相似方法 <code>resolveActivityInfo()</code> ：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> ComponentName <span class="title">resolveActivity</span><span class="params">(PackageManager pm)</span> </span>&#123;</div><div class="line">	<span class="keyword">if</span> (mComponent != <span class="keyword">null</span>) &#123;</div><div class="line">		<span class="keyword">return</span> mComponent;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	ResolveInfo info = pm.resolveActivity(<span class="keyword">this</span>,</div><div class="line">		PackageManager.MATCH_DEFAULT_ONLY);</div><div class="line">	<span class="keyword">if</span> (info != <span class="keyword">null</span>) &#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">new</span> ComponentName(</div><div class="line">			info.activityInfo.applicationInfo.packageName,</div><div class="line">			info.activityInfo.name);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> ActivityInfo <span class="title">resolveActivityInfo</span><span class="params">(PackageManager pm, <span class="keyword">int</span> flags)</span> </span>&#123;</div><div class="line">	ActivityInfo ai = <span class="keyword">null</span>;</div><div class="line">    <span class="keyword">if</span> (mComponent != <span class="keyword">null</span>) &#123;</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			ai = pm.getActivityInfo(mComponent, flags);</div><div class="line">		&#125; <span class="keyword">catch</span> (PackageManager.NameNotFoundException e) &#123;</div><div class="line">			<span class="comment">// ignore</span></div><div class="line">		&#125;</div><div class="line">	&#125; <span class="keyword">else</span> &#123;</div><div class="line">		ResolveInfo info = pm.resolveActivity(<span class="keyword">this</span>,</div><div class="line">			PackageManager.MATCH_DEFAULT_ONLY | flags);</div><div class="line">		<span class="keyword">if</span> (info != <span class="keyword">null</span>) &#123;</div><div class="line">			ai = info.activityInfo;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">return</span> ai;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>显而易见，我们此方式就是先设置的 ComponentName，所以会直接 <code>return mComponent</code> 给我们，并没有任何判定的逻辑。相对的，<code>resolveActivityInfo()</code> 则可以进行有效判定并返回 null。故，我们选择使用 <code>Intent.resolveActivityInfo()</code> 进行此方式下的判定：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">String package_name = <span class="string">"xx.xx.xx"</span>;</div><div class="line">String activity_path = <span class="string">"xx.xx.xx.ab.xxActivity"</span>;</div><div class="line">Intent intent = <span class="keyword">new</span> Intent();</div><div class="line">intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);<span class="comment">//可选</span></div><div class="line">ComponentName cn = <span class="keyword">new</span> ComponentName(package_name,activity_path);</div><div class="line">intent.setComponent(cn);</div><div class="line"></div><div class="line"><span class="keyword">if</span> (intent.resolveActivityInfo(getPackageManager(), PackageManager.MATCH_DEFAULT_ONLY) != <span class="keyword">null</span>) &#123;</div><div class="line">	startActivity(intent);</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">	<span class="comment">//找不到指定的 Activity</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="3-隐式启动第三方应用"><a href="#3-隐式启动第三方应用" class="headerlink" title="3.隐式启动第三方应用"></a>3.隐式启动第三方应用</h3><p>此方式多用于启动系统中的功能性应用，比如打电话、发邮件、预览图片、使用默认浏览器打开一个网页等。</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; Intent intent = <span class="keyword">new</span> Intent();</div><div class="line">&gt; intent.setAction(action);</div><div class="line">&gt; intent.addCategory(category);</div><div class="line">&gt; intent.setDataAndType(<span class="string">"abc://www.dfg.com"</span>,<span class="string">"image/gif"</span>);</div><div class="line">&gt; startActivity(intent);</div><div class="line">&gt;</div></pre></td></tr></table></figure>
<ul>
<li>条件1：IntentFilter 至少有一个 action 至少有一个Category，可以没有 Data 和 Type</li>
</ul>
<ul>
<li>条件2：如果有 Data，参数中 Data 必须符合 Data 规则</li>
</ul>
<ul>
<li>条件3：Action 和 Category 必须同时匹配 Activity 中的一个 Action 和一个 Category (Category 默认：android.intent.category.DEFAULT)</li>
</ul>
<p>来源： <a href="http://blog.csdn.net/tonyyxm/article/details/50260185" target="_blank" rel="external">Android 启动第三方应用的几种方法（整理）</a></p>
</blockquote>
<p>隐式启动功能繁多，就不一一列举了，需要时直接搜索相关代码即可，我们用打开一个网页为例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Uri uri = Uri.parse(<span class="string">"http://www.abc.xyz"</span>);</div><div class="line">Intent intent = <span class="keyword">new</span> Intent(Intent.ACTION_VIEW, uri);</div><div class="line">startActivity(intent);</div></pre></td></tr></table></figure>
<p>这时，直接使用 <code>Intent.resolveActivity()</code> 方法没什么问题：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">Uri uri = Uri.parse(<span class="string">"http://www.abc.xyz"</span>);</div><div class="line">Intent intent = <span class="keyword">new</span> Intent(Intent.ACTION_VIEW, uri);</div><div class="line"></div><div class="line"><span class="keyword">if</span> (intent.resolveActivity(getPackageManager()) != <span class="keyword">null</span>) &#123;</div><div class="line">	startActivity(intent);</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">	<span class="comment">// 没有安装所需应用</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>经过阅读 PackageManager 的代码，发现还可以使用 <code>packageManager.queryIntentActivities()</code> 方法判断系统里是否有能解析指定 Intent 的应用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isAvailable</span><span class="params">(Context context, Intent intent)</span> </span>&#123;</div><div class="line">	PackageManager packageManager = context.getPackageManager();</div><div class="line">	List list = packageManager.queryIntentActivities(intent,</div><div class="line">	PackageManager.MATCH_DEFAULT_ONLY);</div><div class="line">	<span class="keyword">return</span> list.size() &gt; <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>那么，总结下来就是：</p>
<ul>
<li>方式一 <code>PackageManager.getLaunchIntentForPackage()</code>，直接判断返回的 Intent 是否为空即可；</li>
<li>方式二 <code>Intent.setComponent()</code>，使用 <code>Intent.resolveActivityInfo()</code> 或者 <code>packageManager.queryIntentActivities()</code> 两种方式；</li>
<li>方式三 隐式启动，使用  <code>Intent.resolveActivity()</code>、<code>Intent.resolveActivityInfo()</code> 、<code>packageManager.queryIntentActivities()</code> 三种方式均可。</li>
</ul>
<p>如果有什么建议或者问题可以随时联系我，共同探讨学习：</p>
<blockquote>
<ul>
<li>微博：<a href="http://weibo.com/zyansen" target="_blank" rel="external">cafeting</a></li>
<li>Github： <a href="https://github.com/likfe" target="_blank" rel="external">likfe</a></li>
<li>CSDN：<a href="http://blog.csdn.net/ys743276112" target="_blank" rel="external">他叫自己Mr.张</a> </li>
</ul>
</blockquote>
]]></content>
      
        
        <tags>
            
            <tag> Android </tag>
            
            <tag> Intent </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android 必知必会 - EmptyView]]></title>
      <url>/2017/07/07/android-empty-view/</url>
      <content type="html"><![CDATA[<p>关键词：GridView ListView EmptyView SwipeRefreshLayout</p>
<p>在使用 GridView、ListView 时经常需要处理无数据的情况，给用户一些必要的提示。而 GridView 和 ListView 可以使用 <code>setEmptyView()</code> 方法来设置无数据时展示的  View 。</p>
<p>本文讲一下 EmptyView 的基本用法以及如何配合 SwipeRefreshLayout 使用。</p>
<a id="more"></a>
<h2 id="背景知识点"><a href="#背景知识点" class="headerlink" title="背景知识点"></a>背景知识点</h2><h3 id="FrameLayout-布局方式的特点"><a href="#FrameLayout-布局方式的特点" class="headerlink" title="FrameLayout 布局方式的特点"></a>FrameLayout 布局方式的特点</h3><p>FrameLayout 是对其子 View 约束最少最简单的布局，所有放在 FrameLayout 里的控件，都按照层次堆叠在屏幕的左上角。后加进来的控件覆盖前面的控件。</p>
<p>嗯，就像喷漆，后面喷的总是覆盖在之前喷的上面。</p>
<h3 id="setEmptyView-都做了什么？"><a href="#setEmptyView-都做了什么？" class="headerlink" title="setEmptyView() 都做了什么？"></a><code>setEmptyView()</code> 都做了什么？</h3><p><code>setEmptyView(View emptyView)</code> 是 <code>AdapterView</code> 的一个方法，ListView、GridView、Spinner 和 Gallery 都是 <code>AdapterView</code> 的子类，那么理论上来说，本文讲解的针对 ListView、GridView 设置 EmptyView 的方法对于 Spinner、Gallery 应该同样适用。</p>
<p>下面简单看下这个方法的源码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEmptyView</span><span class="params">(View emptyView)</span> </span>&#123;</div><div class="line">        mEmptyView = emptyView;</div><div class="line"></div><div class="line">        <span class="comment">// If not explicitly specified this view is important for accessibility.</span></div><div class="line">        <span class="keyword">if</span> (emptyView != <span class="keyword">null</span></div><div class="line">                &amp;&amp; emptyView.getImportantForAccessibility() == IMPORTANT_FOR_ACCESSIBILITY_AUTO) &#123;</div><div class="line">            emptyView.setImportantForAccessibility(IMPORTANT_FOR_ACCESSIBILITY_YES);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">final</span> T adapter = getAdapter();</div><div class="line">        <span class="keyword">final</span> <span class="keyword">boolean</span> empty = ((adapter == <span class="keyword">null</span>) || adapter.isEmpty());</div><div class="line">        updateEmptyStatus(empty);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment">     * Update the status of the list based on the empty parameter.  If empty is true and</span></div><div class="line"><span class="comment">     * we have an empty view, display it.  In all the other cases, make sure that the listview</span></div><div class="line"><span class="comment">     * is VISIBLE and that the empty view is GONE (if it's not null).</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">updateEmptyStatus</span><span class="params">(<span class="keyword">boolean</span> empty)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (isInFilterMode()) &#123;</div><div class="line">            empty = <span class="keyword">false</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (empty) &#123;</div><div class="line">            <span class="keyword">if</span> (mEmptyView != <span class="keyword">null</span>) &#123;</div><div class="line">                mEmptyView.setVisibility(View.VISIBLE);</div><div class="line">                setVisibility(View.GONE);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="comment">// If the caller just removed our empty view, make sure the list view is visible</span></div><div class="line">                setVisibility(View.VISIBLE);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="comment">// We are now GONE, so pending layouts will not be dispatched.</span></div><div class="line">            <span class="comment">// Force one here to make sure that the state of the list matches</span></div><div class="line">            <span class="comment">// the state of the adapter.</span></div><div class="line">            <span class="keyword">if</span> (mDataChanged) &#123;           </div><div class="line">                <span class="keyword">this</span>.onLayout(<span class="keyword">false</span>, mLeft, mTop, mRight, mBottom); </div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">if</span> (mEmptyView != <span class="keyword">null</span>) mEmptyView.setVisibility(View.GONE);</div><div class="line">            setVisibility(View.VISIBLE);</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>基本就是：</p>
<ul>
<li>数据为空<ul>
<li><code>setVisibility(View.GONE);</code> 隐藏自身</li>
<li><code>mEmptyView.setVisibility(View.VISIBLE);</code> 显示 EmptyView</li>
</ul>
</li>
<li>数据不为空<ul>
<li><code>mEmptyView.setVisibility(View.GONE);</code> 隐藏 EmptyView</li>
<li><code>setVisibility(View.VISIBLE);</code> 显示自身</li>
</ul>
</li>
</ul>
<p>当然，中间还有一些非空判断等。</p>
<h2 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h2><p>这里需要说明一点，EmptyView 只要是一个 View 即可，所以除了基本控件（TextView|Button 等）外，也可以是嵌套的布局（LinearLayout|RelativeLayout 等）。</p>
<h3 id="基础用法"><a href="#基础用法" class="headerlink" title="基础用法"></a>基础用法</h3><p><strong>布局：</strong></p>
<ul>
<li>LinearLayout|FrameLayout|RelativeLayout<ul>
<li>GridView|ListView (id = dataView)</li>
<li>View( id = mEmptyView ,任意 View，可嵌套)</li>
</ul>
</li>
</ul>
<p><strong>关键代码：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">	<span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">	setContentView(R.layout.xxx);</div><div class="line">	mDataView = (GridView|ListView) findViewById(R.id.dataView);</div><div class="line">	adapter = xxxx;</div><div class="line">	mDataView.setAdapter(adapter);</div><div class="line">	mDataView.setEmptyView(findViewById(R.id.mEmptyView));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>PS：务必在 <code>setAdapter()</code> 之后调用 <code>setEmptyView()</code> 。</p>
<h3 id="配合-SwipeRefreshLayout-使用"><a href="#配合-SwipeRefreshLayout-使用" class="headerlink" title="配合 SwipeRefreshLayout 使用"></a>配合 SwipeRefreshLayout 使用</h3><p>配合 SwipeRefreshLayout 使用和基础用法类似，唯一需要注意的是布局的嵌套关系。</p>
<p><strong>布局：</strong></p>
<ul>
<li>FrameLayout<ul>
<li>SwipeRefreshLayout<ul>
<li>GridView|ListView (id = dataView)</li>
</ul>
</li>
<li>View( id = mEmptyView ,任意 View，可嵌套)</li>
</ul>
</li>
</ul>
<p><strong>关键代码没有变化</strong>。这里 <code>GridView|ListView</code>在 <code>SwipeRefreshLayout</code> 内部，<code>SwipeRefreshLayout</code> 和 <code>EmptyView</code> 需要同级，且最好在 <code>FrameLayout</code> 内部。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>本文简单总结了两种最基本的用法，其他更高级更复杂嵌套的情况都可以参考这两种基本用法。</p>
<p>有什么建议或者问题可以随时联系我，共同探讨学习：</p>
<blockquote>
<ul>
<li>微博：<a href="http://weibo.com/zyansen" target="_blank" rel="external">cafeting</a></li>
<li>Github： <a href="https://github.com/likfe" target="_blank" rel="external">likfe</a></li>
<li>CSDN：<a href="http://blog.csdn.net/ys743276112" target="_blank" rel="external">他叫自己Mr.张</a> </li>
</ul>
</blockquote>
]]></content>
      
        
        <tags>
            
            <tag> Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android 必知必会 - DialogFragment 实现类似 PopupWindow 效果]]></title>
      <url>/2017/06/01/android-dialogfragment-as-pop/</url>
      <content type="html"><![CDATA[<p>近期有网友根据 <a href="http://blog.csdn.net/ys743276112/article/details/52962046" target="_blank" rel="external">Android 必知必会 - DialogFragment 使用总结</a> 做一些业务，但是目标却是用 DialogFragment 实现类似 PopupWindow 效果：</p>
<ul>
<li>只拦截自身所占空间部分的事件，其余空间的点击事件不处理</li>
<li>可以根据某个 View 定位自身位置</li>
</ul>
<p>虽然在功能上 PopupWindow 更符合需要，但是使用 DialogFragment 代码更简洁、更方便封装功能模块。</p>
<a id="more"></a>
<h2 id="基础知识点"><a href="#基础知识点" class="headerlink" title="基础知识点"></a>基础知识点</h2><h3 id="WindowManager-LayoutParams-flags"><a href="#WindowManager-LayoutParams-flags" class="headerlink" title="WindowManager.LayoutParams.flags"></a>WindowManager.LayoutParams.flags</h3><p><code>WindowManager.LayoutParams.flags</code> 修改 Window 的表现行为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"> /**</div><div class="line">* Various behavioral options/flags.  Default is none.</div><div class="line">*</div><div class="line">* @see #FLAG_ALLOW_LOCK_WHILE_SCREEN_ON</div><div class="line">* @see #FLAG_DIM_BEHIND</div><div class="line">* @see #FLAG_NOT_FOCUSABLE</div><div class="line">* @see #FLAG_NOT_TOUCHABLE</div><div class="line">* @see #FLAG_NOT_TOUCH_MODAL</div><div class="line">* @see #FLAG_TOUCHABLE_WHEN_WAKING</div><div class="line">* @see #FLAG_KEEP_SCREEN_ON</div><div class="line">* @see #FLAG_LAYOUT_IN_SCREEN</div><div class="line">* @see #FLAG_LAYOUT_NO_LIMITS</div><div class="line">* @see #FLAG_FULLSCREEN</div><div class="line">* @see #FLAG_FORCE_NOT_FULLSCREEN</div><div class="line">* @see #FLAG_SECURE</div><div class="line">* @see #FLAG_SCALED</div><div class="line">* @see #FLAG_IGNORE_CHEEK_PRESSES</div><div class="line">* @see #FLAG_LAYOUT_INSET_DECOR</div><div class="line">* @see #FLAG_ALT_FOCUSABLE_IM</div><div class="line">* @see #FLAG_WATCH_OUTSIDE_TOUCH</div><div class="line">* @see #FLAG_SHOW_WHEN_LOCKED</div><div class="line">* @see #FLAG_SHOW_WALLPAPER</div><div class="line">* @see #FLAG_TURN_SCREEN_ON</div><div class="line">* @see #FLAG_DISMISS_KEYGUARD</div><div class="line">* @see #FLAG_SPLIT_TOUCH</div><div class="line">* @see #FLAG_HARDWARE_ACCELERATED</div><div class="line">* @see #FLAG_LOCAL_FOCUS_MODE</div><div class="line">* @see #FLAG_DRAWS_SYSTEM_BAR_BACKGROUNDS</div><div class="line">*/</div></pre></td></tr></table></figure>
<p>以上可以看到它有很多可选项，加上可以多个相互组合，能满足很多需求，这里重点关注三个属性值：</p>
<ul>
<li><p>FLAG_NOT_TOUCH_MODAL</p>
<blockquote>
<p>Window flag: even when this window is focusable (its <code>FLAG_NOT_FOCUSABLE</code> is not set), allow any pointer events outside of the window to be sent to the windows behind it.</p>
<p> (API level 1)</p>
</blockquote>
</li>
<li><p>FLAG_TRANSLUCENT_NAVIGATION</p>
<blockquote>
<p>Window flag: request a translucent navigation bar with minimal system-provided background protection.</p>
<p> (API level 19)</p>
</blockquote>
</li>
<li><p>FLAG_TRANSLUCENT_STATUS</p>
<blockquote>
<p>Window flag: request a translucent status bar with minimal system-provided background protection.</p>
<p> (API level 19)</p>
</blockquote>
</li>
</ul>
<p>更详细的介绍请点击 <a href="https://developer.android.google.cn/reference/android/view/WindowManager.LayoutParams.html" target="_blank" rel="external">文档</a></p>
<p>其中 <code>FLAG_NOT_TOUCH_MODAL</code> 可达到『只拦截自身所占空间部分的事件，其余空间的点击事件不处理』的需求，而 <code>FLAG_TRANSLUCENT_NAVIGATION</code> 和 <code>FLAG_TRANSLUCENT_STATUS</code> 主要是用来调整使用<strong>沉浸式状态栏</strong>时显示自身位置不正确的问题。</p>
<h3 id="获取-View-位置的时机"><a href="#获取-View-位置的时机" class="headerlink" title="获取 View 位置的时机"></a>获取 View 位置的时机</h3><p>如果需要让 DialogFragment 在 <code>onCreate()</code> 等生命周期函数内直接调用显示到某个 View 的位置处，可能无法正确获取到该 View 的坐标，具体参考 <a href="http://blog.csdn.net/ys743276112/article/details/51396838" target="_blank" rel="external">Android必知必会-获取View坐标和长宽的时机</a> 一文。</p>
<p>但是，如果在界面显示给用户后，DialogFragment 的显示交给用户触发的话，就不需要在意这个问题了。</p>
<h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><blockquote>
<p>TopFragment.java</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TopFragment</span> <span class="keyword">extends</span> <span class="title">DialogFragment</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String EXT_Y = <span class="string">"y value"</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String EXT_BAR = <span class="string">"isTranslucentDecor"</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> y;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isTranslucentDecor;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> TopFragment <span class="title">getInstant</span><span class="params">(<span class="keyword">int</span> y)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> getInstant(y, <span class="keyword">false</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> TopFragment <span class="title">getInstant</span><span class="params">(<span class="keyword">int</span> y, <span class="keyword">boolean</span> isTranslucentDecor)</span> </span>&#123;</div><div class="line">        TopFragment fragment = <span class="keyword">new</span> TopFragment();</div><div class="line">        Bundle ext = <span class="keyword">new</span> Bundle();</div><div class="line">        ext.putInt(EXT_Y, y);</div><div class="line">        ext.putBoolean(EXT_BAR, isTranslucentDecor);</div><div class="line">        fragment.setArguments(ext);</div><div class="line">        <span class="keyword">return</span> fragment;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setStyle(DialogFragment.STYLE_NO_TITLE, R.style.dialogFrag);</div><div class="line">        Bundle args = getArguments();</div><div class="line">        <span class="keyword">if</span> (args != <span class="keyword">null</span>) &#123;</div><div class="line">            y = args.getInt(EXT_Y, <span class="number">0</span>);</div><div class="line">            isTranslucentDecor = args.getBoolean(EXT_BAR, <span class="keyword">false</span>);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            y = <span class="number">0</span>;</div><div class="line">            isTranslucentDecor = <span class="keyword">false</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">onCreateView</span><span class="params">(LayoutInflater inflater, ViewGroup container,</span></span></div><div class="line"><span class="function"><span class="params">                             Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        getDialog().setCanceledOnTouchOutside(<span class="keyword">false</span>);</div><div class="line">        View rootView = inflater.inflate(R.layout.fragment_top, container, <span class="keyword">false</span>);</div><div class="line">        <span class="comment">//Do something</span></div><div class="line">        <span class="keyword">final</span> Window window = getDialog().getWindow();</div><div class="line">        window.setBackgroundDrawableResource(android.R.color.transparent);</div><div class="line">        window.getDecorView().setPadding(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">        WindowManager.LayoutParams wlp = window.getAttributes();</div><div class="line">        wlp.width = WindowManager.LayoutParams.MATCH_PARENT;</div><div class="line">        wlp.height = WindowManager.LayoutParams.WRAP_CONTENT;</div><div class="line">        wlp.flags = WindowManager.LayoutParams.FLAG_NOT_TOUCH_MODAL;</div><div class="line">        <span class="keyword">if</span> (isTranslucentDecor) &#123;</div><div class="line">            wlp.flags |= WindowManager.LayoutParams.FLAG_TRANSLUCENT_NAVIGATION;</div><div class="line">        &#125;</div><div class="line">        wlp.gravity = Gravity.TOP;<span class="comment">//必须为 TOP，否则定位不准确</span></div><div class="line">        wlp.y = y;<span class="comment">//配合 Gravity.TOP 才能准确定位</span></div><div class="line">        window.setAttributes(wlp);</div><div class="line">      	<span class="comment">//Debug info</span></div><div class="line">        rootView.findViewById(R.id.vvv).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">                Toast.makeText(getActivity(), <span class="string">"dialogFragment 响应了点击事件"</span>, Toast.LENGTH_SHORT).show();</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        <span class="keyword">return</span> rootView;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>MainActivity.java</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">	<span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">	setContentView(R.layout.activity_main);</div><div class="line">  	findViewById(R.id.bt_menu).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</div><div class="line">    	<span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">			TextView title = (TextView) findViewById(R.id.tv_title);</div><div class="line">			TopFragment.getInstant(title.getBottom()).show(getSupportFragmentManager(), <span class="string">"tags"</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>注意：如果当前 Activity 使用了<strong>沉浸式状态栏</strong>，需要使用 <code>TopFragment.getInstant(int y, boolean isTranslucentDecor)</code> 方法，并且 <code>isTranslucentDecor</code> 传值为 <code>true</code> 。</p>
<h3 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h3><table>
<thead>
<tr>
<th style="text-align:left">未使用沉浸式状态栏、 <code>isTranslucentDecor</code> 传值为 <code>false</code> ，位置正确</th>
<th style="text-align:left">使用沉浸式状态栏、 <code>isTranslucentDecor</code> 传值为 <code>false</code> ，位置定位差个状态栏高度</th>
<th style="text-align:left">使用沉浸式状态栏、 <code>isTranslucentDecor</code> 传值为 <code>true</code> ，位置正确</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><img src="http://img.blog.csdn.net/20170601183835306?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveXM3NDMyNzYxMTI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="s1"></td>
<td style="text-align:left"><img src="http://img.blog.csdn.net/20170601183850744?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveXM3NDMyNzYxMTI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="s2"></td>
<td style="text-align:left"><img src="http://img.blog.csdn.net/20170601183904651?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveXM3NDMyNzYxMTI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="s3"></td>
</tr>
</tbody>
</table>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>总的来说，这里基本完成了要求的效果，但是定位只能指定其顶部开始的位置，不方便底部定位到某个 View 的上面，因为高度自适应的话，在页面渲染完成前是不能知道它的高度的。当然，你可以使用固定高度布局的方式来实现随意定位。</p>
<p>有什么建议或者问题可以随时联系我，共同探讨学习：</p>
<blockquote>
<ul>
<li>微博：<a href="http://weibo.com/zyansen" target="_blank" rel="external">cafeting</a></li>
<li>Github： <a href="https://github.com/likfe" target="_blank" rel="external">likfe</a></li>
<li>CSDN：<a href="http://blog.csdn.net/ys743276112" target="_blank" rel="external">他叫自己Mr.张</a> </li>
</ul>
</blockquote>
]]></content>
      
        
        <tags>
            
            <tag> Android </tag>
            
            <tag> DialogFragment </tag>
            
            <tag> PopupWindow </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android 项目开发填坑记 - 获取系统语言(兼容7.0)]]></title>
      <url>/2017/05/10/android-sys-language/</url>
      <content type="html"><![CDATA[<p>关键词：<code>Android7.0</code> 、<code>系统语言</code> 、<code>顺序不一致</code></p>
<p>获取系统当前语言是一个比较常用的功能，在 Android 7.0 系统上旧函数获取到的当前系统语言并不正确，或者说从 Android 7.0 起，Android 系统语言的规则变了。</p>
<a id="more"></a>
<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>下面是未适配 Android 7.0 的代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 获取 Locale 的方式有二</span></div><div class="line">Locale locale = getResources().getConfiguration().locale;</div><div class="line">Locale locale = Locale.getDefault();</div><div class="line"><span class="comment">// 获取当前系统语言</span></div><div class="line">locale.getLanguage();</div></pre></td></tr></table></figure>
<p>由于仅仅根据 <code>getLanguage()</code> 无法全面的了解当前的系统语言信息，比如简体中文和繁体中文的 Language 都是 <code>zh</code>，所以还需要 <code>getCountry()</code>  方法获取地区信息，我们就能得到 <code>zh-CN</code> 和 <code>zh-HK/zh-TW</code> 。</p>
<p>总结一下就是：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 获取 Locale 的方式有二</span></div><div class="line">Locale locale = getResources().getConfiguration().locale;</div><div class="line">Locale locale = Locale.getDefault();</div><div class="line"><span class="comment">// 获取当前系统语言</span></div><div class="line">String lang = locale.getLanguage() + <span class="string">"-"</span> + locale.getCountry();</div></pre></td></tr></table></figure>
<p>但是，在 Android 7.0 上：<code>getResources().getConfiguration().locale</code> 被标记为 <strong>deprecated</strong> 了，所以<strong>初步适配</strong>后是：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">Locale locale；</div><div class="line"><span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.N) &#123;</div><div class="line">    locale = getResources().getConfiguration().getLocales().get(<span class="number">0</span>);</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">    locale = getResources().getConfiguration().locale;</div><div class="line">&#125;</div><div class="line"><span class="comment">//或者仅仅使用 locale = Locale.getDefault(); 不需要考虑接口 deprecated(弃用)问题</span></div><div class="line">String lang = locale.getLanguage() + <span class="string">"-"</span> + locale.getCountry();</div></pre></td></tr></table></figure>
<p>从 Android 7.0 起使用的<code>getResources().getConfiguration().getLocales()</code> 返回的是一个 <code>LocaleList</code> 对象，它包含 <code>&gt;=1</code> 个 Locale，内容项可由用户增删，顺序可由用户调整。但是，此接口返回的语言顺序和用户定义的顺序<strong>不一定一致</strong>！</p>
<h2 id="测试语言顺序"><a href="#测试语言顺序" class="headerlink" title="测试语言顺序"></a>测试语言顺序</h2><p>测试核心代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">Locale locale = Locale.getDefault();</div><div class="line">MLog.e(locale.getLanguage() + <span class="string">"-"</span> + locale.getCountry());</div><div class="line"></div><div class="line"><span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.N) &#123;</div><div class="line">	LocaleList localeList = getResources().getConfiguration().getLocales();</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; localeList.size(); i++) &#123;</div><div class="line">		MLog.e(i + <span class="string">" &gt;1&gt; "</span> + localeList.get(i).getLanguage() + <span class="string">"-"</span> + localeList.get(i).getCountry());</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	LocaleList localeList2 = LocaleList.getAdjustedDefault();</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; localeList2.size(); i++) &#123;</div><div class="line">		MLog.e(i + <span class="string">" &gt;2&gt; "</span> + localeList2.get(i).getLanguage() + <span class="string">"-"</span> + localeList2.get(i).getCountry());</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	LocaleList localeList3 = LocaleList.getDefault();</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; localeList3.size(); i++) &#123;</div><div class="line">		MLog.e(i + <span class="string">" &gt;3&gt; "</span> + localeList3.get(i).getLanguage() + <span class="string">"-"</span> + localeList3.get(i).getCountry());</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	LocaleList localeList4 = LocaleList.getEmptyLocaleList();</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; localeList4.size(); i++) &#123;</div><div class="line">		MLog.e(i + <span class="string">" &gt;4&gt; "</span> + localeList4.get(i).getLanguage() + <span class="string">"-"</span> + localeList4.get(i).getCountry());</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="第一次测试"><a href="#第一次测试" class="headerlink" title="第一次测试"></a>第一次测试</h3><p>测试手机：Nubia Z9 mini，Android 7.1，Mokee Rom</p>
<p>手机系统语言顺序：<code>hi-IN,zh-CN,en-US,zh-HK</code></p>
<p>App 国际化：<code>values,values-zh</code> （values 里的 string 为英文，values-zh 里的 string 为中文）</p>
<p>结果是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">zh-CN</div><div class="line"></div><div class="line">0 &gt;1&gt; zh-CN</div><div class="line">1 &gt;1&gt; hi-IN</div><div class="line">2 &gt;1&gt; en-US</div><div class="line">3 &gt;1&gt; zh-HK</div><div class="line"></div><div class="line">0 &gt;2&gt; zh-CN</div><div class="line">1 &gt;2&gt; hi-IN</div><div class="line">2 &gt;2&gt; en-US</div><div class="line">3 &gt;2&gt; zh-HK</div><div class="line"></div><div class="line">0 &gt;3&gt; hi-IN</div><div class="line">1 &gt;3&gt; zh-CN</div><div class="line">2 &gt;3&gt; en-US</div><div class="line">3 &gt;3&gt; zh-HK</div></pre></td></tr></table></figure>
<p>并且 App 当前显示的文字是<strong>中文</strong>。</p>
<h3 id="第二次测试"><a href="#第二次测试" class="headerlink" title="第二次测试"></a>第二次测试</h3><p>测试手机：Nubia Z9 mini，Android 7.1，Mokee Rom</p>
<p>手机系统语言顺序：<code>hi-IN,en-US,zh-CN,zh-HK</code></p>
<p>App 国际化：<code>values,values-zh</code></p>
<p>结果是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">en-US</div><div class="line"></div><div class="line">0 &gt;1&gt; en-US</div><div class="line">1 &gt;1&gt; hi-IN</div><div class="line">2 &gt;1&gt; zh-CN</div><div class="line">3 &gt;1&gt; zh-HK</div><div class="line"></div><div class="line">0 &gt;2&gt; en-US</div><div class="line">1 &gt;2&gt; hi-IN</div><div class="line">2 &gt;2&gt; zh-CN</div><div class="line">3 &gt;2&gt; zh-HK</div><div class="line"></div><div class="line">0 &gt;3&gt; hi-IN</div><div class="line">1 &gt;3&gt; en-US</div><div class="line">2 &gt;3&gt; zh-CN</div><div class="line">3 &gt;3&gt; zh-HK</div></pre></td></tr></table></figure>
<p>并且 App 当前显示的文字是<strong>英文</strong>。</p>
<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>从 Android 7.0 开始，系统语言支持多个，可手动排序，系统根据 App 本身支持的语言和手机出厂设置的语言等因素来调整 App 本身的默认语言。</p>
<p>要获取系统为 App <strong>调整后的默认语言</strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Locale locale = Locale.getDefault();</div><div class="line"><span class="comment">//Locale.getDefault() 和 LocaleList.getAdjustedDefault().get(0) 同等效果，还不需要考虑版本问题，推荐直接使用</span></div><div class="line">String language = locale.getLanguage() + <span class="string">"-"</span> + locale.getCountry();</div></pre></td></tr></table></figure>
<p>要获取系统<strong>真实首选语言</strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Locale locale;</div><div class="line"><span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.N) &#123;</div><div class="line">	locale = LocaleList.getDefault().get(<span class="number">0</span>);</div><div class="line">&#125; <span class="keyword">else</span> locale = Locale.getDefault();</div><div class="line"></div><div class="line">String language = locale.getLanguage() + <span class="string">"-"</span> + locale.getCountry();</div></pre></td></tr></table></figure>
<blockquote>
<p>参考资料：<a href="https://developer.android.com/reference/java/util/Locale.html" target="_blank" rel="external">https://developer.android.com/reference/java/util/Locale.html</a></p>
</blockquote>
<p><strong>PS</strong>：你可以通过下面的方式和我联系</p>
<blockquote>
<ul>
<li>微博：<a href="http://weibo.com/zyansen" target="_blank" rel="external">cafeting</a></li>
<li>Github： <a href="https://github.com/likfe" target="_blank" rel="external">likfe</a></li>
<li>CSDN：<a href="http://blog.csdn.net/ys743276112" target="_blank" rel="external">他叫自己Mr.张</a> </li>
</ul>
</blockquote>
]]></content>
      
        
        <tags>
            
            <tag> Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[ThinkPHP 转换数据库查询出的数据到对应类型]]></title>
      <url>/2017/03/25/tp3-x-all-string/</url>
      <content type="html"><![CDATA[<p>最近使用 ThinkPHP3.2.3 进行 API 开发，发现 ThinkPHP3.x 查询数据库返回所有字段值类型都是 String。以前开发 web 的时候没怎么注意这个，现在发现用到 API 开发很难办，数据类型不对，不能每个字段都让客户端自己强制转换一下。</p>
<p>查资料后发现 ThinkPHP3.x 的 Model.class.php，提供了 <code>_parseType</code> 方法，在查询完以后进行类型转换，但需要我们手工调一下。</p>
<a id="more"></a>
<p>需要自己写一个 Model 基类:</p>
<p><code>MBaseModel.class.php</code> 继承自 <code>Model</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">use</span> <span class="title">Think</span>\<span class="title">Model</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseModel</span> <span class="keyword">extends</span> <span class="title">Model</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">_after_select</span><span class="params">(&amp;$resultSet, $options)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">parent</span>::_after_select($resultSet,$options);</div><div class="line">        <span class="keyword">foreach</span> ($resultSet <span class="keyword">as</span> &amp;$result) &#123;</div><div class="line">            <span class="keyword">$this</span>-&gt;_after_find($result, $options);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">_after_find</span><span class="params">(&amp;$result, $options)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">parent</span>::_after_find($result,$options);</div><div class="line">        <span class="keyword">foreach</span> ($result <span class="keyword">as</span> $field =&gt; $value) &#123;</div><div class="line">            <span class="keyword">$this</span>-&gt;_parseType($result, $field);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后所有自己写的 Model 类都继承自 MBaseModel.</p>
<p><strong>注意：</strong>必须把上面两个方法写到 <code>Model</code> 的子类中。</p>
<p>本来，这样已经搞定了，但发现 Model.class.php 的 <code>_parseType</code> 方法里有个低级 bug：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 数据类型检测</span></div><div class="line"><span class="comment">     * <span class="doctag">@access</span> protected</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> mixed $data 数据</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> string $key 字段名</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">_parseType</span><span class="params">(&amp;$data,$key)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;options[<span class="string">'bind'</span>][<span class="string">':'</span>.$key]) &amp;&amp; <span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;fields[<span class="string">'_type'</span>][$key]))&#123;</div><div class="line">            $fieldType = strtolower(<span class="keyword">$this</span>-&gt;fields[<span class="string">'_type'</span>][$key]);</div><div class="line">            <span class="keyword">if</span>(<span class="keyword">false</span> !== strpos($fieldType,<span class="string">'enum'</span>))&#123;</div><div class="line">                <span class="comment">// 支持ENUM类型优先检测</span></div><div class="line">            &#125;<span class="keyword">elseif</span>(<span class="keyword">false</span> === strpos($fieldType,<span class="string">'bigint'</span>) &amp;&amp; <span class="keyword">false</span> !== strpos($fieldType,<span class="string">'int'</span>)) &#123;</div><div class="line">                $data[$key]   =  intval($data[$key]);</div><div class="line">            &#125;<span class="keyword">elseif</span>(<span class="keyword">false</span> !== strpos($fieldType,<span class="string">'float'</span>) || <span class="keyword">false</span> !== strpos($fieldType,<span class="string">'double'</span>))&#123;</div><div class="line">                $data[$key]   =  floatval($data[$key]);</div><div class="line">            &#125;<span class="keyword">elseif</span>(<span class="keyword">false</span> !== strpos($fieldType,<span class="string">'bool'</span>))&#123;</div><div class="line">                $data[$key]   =  (bool)$data[$key];</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"><span class="comment">// 上面第13行修改为</span></div><div class="line">            &#125;<span class="keyword">elseif</span>(<span class="keyword">false</span> !== strpos($fieldType,<span class="string">'bigint'</span>) || <span class="keyword">false</span> !== strpos($fieldType,<span class="string">'int'</span>) || <span class="keyword">false</span> !== strpos($fieldType,<span class="string">'tinyint'</span>)) &#123;</div></pre></td></tr></table></figure>
<blockquote>
<p>原文链接：<a href="https://www.pocketdigi.com/20160411/1469.html?utm_source=tuicool&amp;utm_medium=referral" target="_blank" rel="external">https://www.pocketdigi.com/20160411/1469.html?utm_source=tuicool&amp;utm_medium=referral</a></p>
</blockquote>
]]></content>
      
        
        <tags>
            
            <tag> PHP </tag>
            
            <tag> ThinkPHP </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android 必知必会 - Android Studio 2.3 找回 exploded-aar 目录【官方已更新】]]></title>
      <url>/2017/03/15/android-studio-exploded-aar/</url>
      <content type="html"><![CDATA[<p>今天收到邮件提示 <code>exploded-aar</code> 目录问题在 <code>gradle plugin 2.5</code> 版本修复好了。</p>
<blockquote>
<p>Marked as Fixed</p>
<p>in 2.3/2.4 you can look in the build cache entries and look in the input file that indicate the source of the cache entry (maven coordinate).<br>in 2.5+ we switched to Gradle’s own cache so you’ll have to look in the gradle folder.<br>If all you need is manually get the aar content you could also manually download the aar and unzip it yourself.</p>
</blockquote>
<p>查看 Issue 详情（需要梯子）：<a href="https://issuetracker.google.com/issues/37127616" target="_blank" rel="external">Issue 页</a></p>
<p>— 更新于 2017-05-11</p>
<hr>
<p>升级到 Android Studio 2.3 后，Gradle Plugin 也升级到 2.3.0，对应推荐使用的 Gradle 版本是 3.3。</p>
<p>这时候会发现项目目录下 <code>{module name}/build/intermediates/exploded-aar/</code> 目录没了，经过一番查找，发现这并不是一个 Bug，是官方刻意为之，它会在 <code>{user name}/.android/build-cache</code> 下生成一部分缓存文件，来代替 <code>exploded-aar</code> ，如果需要生成它，可以配置项目目录下的 <code>gradle.properties</code> ，添加一行内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">android.enableBuildCache=false</div></pre></td></tr></table></figure>
<a id="more"></a>
<p>然后重建项目即可在 <code>{module name}/build/intermediates/</code> 看到 <strong>exploded-aar</strong> 目录了。</p>
<p>想重新开启 <code>BuildCache</code>  功能，可以修改为 <code>android.enableBuildCache=true</code> 或者直接删除本行内容即可。</p>
<p><strong>PS</strong>：你可以通过下面的方式和我联系</p>
<blockquote>
<ul>
<li>微博：<a href="http://weibo.com/zyansen" target="_blank" rel="external">cafeting</a></li>
<li>Github： <a href="https://github.com/likfe" target="_blank" rel="external">likfe</a></li>
<li>CSDN：<a href="http://blog.csdn.net/ys743276112" target="_blank" rel="external">他叫自己Mr.张</a> </li>
</ul>
</blockquote>
]]></content>
      
        
        <tags>
            
            <tag> Android </tag>
            
            <tag> AndroidStudio </tag>
            
            <tag> Gradle </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android Studio 升级 gradle 报错]]></title>
      <url>/2017/03/13/android-update-gradle/</url>
      <content type="html"><![CDATA[<p>错误提示如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Gradle sync failed: Cause: error in opening zip file</div><div class="line">Consult IDE log for more details (Help | Show Log)</div></pre></td></tr></table></figure>
<p>今天升级 2.2 到 2.3 后打开一个项目提示升级 gradle，就同意了，结果报了上面的错误。</p>
<p>大概原因应该是下载的最新的 gradle 包有问题，新升级后配置的代理失效了。</p>
<p>操作如下：</p>
<ol>
<li>删除项目目录下的 <code>.gradle/</code> 整个项目</li>
<li>查看 <code>gradle/wrapper/gradle-warpper.properties</code> 的 <code>distributionUrl</code> 的 gradle 版本，比如是 3.3 ，然后去 <code>~/.gradle/warpper/dists/</code> 下删除对应版本的 gradle ,这里是 <code>gradle-3.3-all</code></li>
<li>然后重启 Android Studio 让它重新同步即可</li>
</ol>
]]></content>
      
        
        <tags>
            
            <tag> Android </tag>
            
            <tag> AndroidStudio </tag>
            
            <tag> Gradle </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[解决 Mac 下 Android Studio 不打印日志]]></title>
      <url>/2017/03/02/mac-android-no-log/</url>
      <content type="html"><![CDATA[<p>在 Mac 下使用 Android Studio 时常会遇到 Android Monitor 突然不打印日志的情况，目前知道的有三个方法：</p>
<ol>
<li><p>重启 Android Studio</p>
<p>这个不需要多说，点击 Android Studio 的 File =&gt; Invalidate caches / Restart ，选择 Just Restart</p>
</li>
<li><p>重启 adb</p>
<p>命令行下输入：<code>adb kill-server</code> 关闭 adb，<code>adb start-server</code> 开启 adb 即可。</p>
</li>
<li><p>切换 adb 的 root/unroot 模式</p>
<p>这个实际上还是重启了 adb 。 <code>adb root</code> 使 adb 默认进入 root 模式，<code>adb unroot</code> 使 adb 进入非 root 模式，切换模式会导致 adb 重启。</p>
</li>
</ol>
]]></content>
      
        
        <tags>
            
            <tag> Android </tag>
            
            <tag> Mac </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android 必知必会 - 根据包名判断 App 运行状态]]></title>
      <url>/2017/02/07/android-is-app-running/</url>
      <content type="html"><![CDATA[<p>获取指定包名的 APP 是否还在后台运行，判断 APP 是否存活。</p>
<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>可以根据 App 是否有 <code>Service</code> 分两类情况处理：</p>
<ul>
<li>没有 <code>Service</code></li>
<li>有 <code>Service</code></li>
</ul>
<p>对于没有 <code>Service</code> 的 App，程序一旦切换到后台，可能很快就被回收了，这里使用 <code>ActivityManager.getRunningTasks(int maxNum)</code> 方法来获取当前正在运行的任务，注意：此方法并不被系统推荐，且是一个 <code>Deprecated</code> 的方法。</p>
<p>对于有 <code>Service</code> 的 App，大多会有多个 <code>Service</code> ，且有可能都是 <code>:remote</code> 类型的，这样在判断上需要进行一定的处理，这里根据 App 的 <code>uid</code> 来判断，避免在一些特殊的情况下判断存活不准确的问题。我们使用 <code>ActivityManager.getRunningServices(int maxNum)</code> 方法获取当前运行中的 <code>Service</code> 列表。</p>
<p><strong>注意：</strong>App 的 <code>uid</code>  对于系统内置 App 而言不是唯一的，Android 内置的应用会有共用 <code>uid</code> 的情况。如果你是开发系统内置应用或者类似的东西，务必要自行进行特殊方式检查。</p>
<a id="more"></a>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p>下面是几个工具类，在正式使用的时候需要配合使用，才能覆盖全部情况：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment">    * 方法描述：判断某一应用是否正在运行</span></div><div class="line"><span class="comment">    * Created by cafeting on 2017/2/4.</span></div><div class="line"><span class="comment">    * <span class="doctag">@param</span> context     上下文</span></div><div class="line"><span class="comment">    * <span class="doctag">@param</span> packageName 应用的包名</span></div><div class="line"><span class="comment">    * <span class="doctag">@return</span> true 表示正在运行，false 表示没有运行</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isAppRunning</span><span class="params">(Context context, String packageName)</span> </span>&#123;</div><div class="line">       ActivityManager am = (ActivityManager) context.getSystemService(Context.ACTIVITY_SERVICE);</div><div class="line">       List&lt;ActivityManager.RunningTaskInfo&gt; list = am.getRunningTasks(<span class="number">100</span>);</div><div class="line">       <span class="keyword">if</span> (list.size() &lt;= <span class="number">0</span>) &#123;</div><div class="line">           <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">       &#125;</div><div class="line">       <span class="keyword">for</span> (ActivityManager.RunningTaskInfo info : list) &#123;</div><div class="line">           <span class="keyword">if</span> (info.baseActivity.getPackageName().equals(packageName)) &#123;</div><div class="line">               <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">       <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">   &#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//获取已安装应用的 uid，-1 表示未安装此应用或程序异常</span></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getPackageUid</span><span class="params">(Context context, String packageName)</span> </span>&#123;</div><div class="line">       <span class="keyword">try</span> &#123;</div><div class="line">           ApplicationInfo applicationInfo = context.getPackageManager().getApplicationInfo(packageName, <span class="number">0</span>);</div><div class="line">           <span class="keyword">if</span> (applicationInfo != <span class="keyword">null</span>) &#123;</div><div class="line">               Logger.d(applicationInfo.uid);</div><div class="line">               <span class="keyword">return</span> applicationInfo.uid;</div><div class="line">           &#125;</div><div class="line">       &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">           <span class="keyword">return</span> -<span class="number">1</span>;</div><div class="line">       &#125;</div><div class="line">       <span class="keyword">return</span> -<span class="number">1</span>;</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   <span class="comment">/**</span></div><div class="line"><span class="comment">    * 判断某一 uid 的程序是否有正在运行的进程，即是否存活</span></div><div class="line"><span class="comment">    * Created by cafeting on 2017/2/4.</span></div><div class="line"><span class="comment">    *</span></div><div class="line"><span class="comment">    * <span class="doctag">@param</span> context     上下文</span></div><div class="line"><span class="comment">    * <span class="doctag">@param</span> uid 已安装应用的 uid</span></div><div class="line"><span class="comment">    * <span class="doctag">@return</span> true 表示正在运行，false 表示没有运行</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isProcessRunning</span><span class="params">(Context context, <span class="keyword">int</span> uid)</span> </span>&#123;</div><div class="line">       ActivityManager am = (ActivityManager) context.getSystemService(Context.ACTIVITY_SERVICE);</div><div class="line">       List&lt;ActivityManager.RunningServiceInfo&gt; runningServiceInfos = am.getRunningServices(<span class="number">200</span>);</div><div class="line">       <span class="keyword">if</span> (runningServiceInfos.size() &gt; <span class="number">0</span>) &#123;</div><div class="line">           <span class="keyword">for</span> (ActivityManager.RunningServiceInfo appProcess : runningServiceInfos)&#123;</div><div class="line">               <span class="keyword">if</span> (uid == appProcess.uid) &#123;</div><div class="line">                   <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">               &#125;</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">       <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>在正式使用的时候结合两者即可：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">String pName = <span class="string">"xxx"</span>;</div><div class="line"><span class="keyword">int</span> uid = getPackageUid(context, pName);</div><div class="line"><span class="keyword">if</span>(uid &gt; <span class="number">0</span>)&#123;</div><div class="line">  	<span class="keyword">boolean</span> rstA = isAppRunning(context, pName);</div><div class="line">  	<span class="keyword">boolean</span> rstB = isProcessRunning(context, uid);</div><div class="line">  	<span class="keyword">if</span>(rstA||rstB)&#123;</div><div class="line">      	<span class="comment">//指定包名的程序正在运行中</span></div><div class="line">  	&#125;<span class="keyword">else</span>&#123;</div><div class="line">      	<span class="comment">//指定包名的程序未在运行中</span></div><div class="line">  	&#125;</div><div class="line">&#125;<span class="keyword">else</span>&#123;</div><div class="line">  	<span class="comment">//应用未安装</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>在探索验证程序存活的过程中，发现 <code>ActivityManager.RunningServiceInfo</code> 包含很多信息，一开始我是使用其 <code>process</code> 和 <code>started</code> 属性来判断，其中 <code>process</code> 对应包名，但是对于只有 <code>:remote</code> 类型 <code>service</code> 时，则判定不了。</p>
<p>以上是最近开发中处理的一个需求，希望能对你有所帮助。如果你有更好的方法或者发现了文中的错误，可以通过下面的方式和我联系：</p>
<blockquote>
<ul>
<li>微博：<a href="http://weibo.com/zyansen" target="_blank" rel="external">cafeting</a></li>
<li>Github： <a href="https://github.com/likfe" target="_blank" rel="external">likfe</a></li>
<li>CSDN：<a href="http://blog.csdn.net/ys743276112" target="_blank" rel="external">他叫自己Mr.张</a> </li>
</ul>
</blockquote>
]]></content>
      
        
        <tags>
            
            <tag> Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[【译】在 Jelly Bean 中使用应用加密]]></title>
      <url>/2017/01/05/android-app-encrypt/</url>
      <content type="html"><![CDATA[<p>翻译自：<a href="http://nelenkov.blogspot.jp/2012/07/using-app-encryption-in-jelly-bean.html" target="_blank" rel="external">Using app encryption in Jelly Bean</a></p>
<p>关键词 : <code>adb install -l</code></p>
<hr>
<p>最新的 Android 4.1（Jelly Bean）版本在上周的 Google I / O 大会上发布了，它有一大堆新功能和改进。 其中一个有趣的功能是<strong>应用程序加密</strong>，除了简短的说明还没有任何细节：“从 Jelly Bean 版本起，Google Play 中的付费应用程序在分发和存储之前，会使用设备特定的密钥加密”。缺乏细节当然会引起猜测，有些人甚至担心，当他们使用一个新的设备时必须回购他们的付费应用程序。 在本文中，我们将介绍如何在操作系统中实施应用加密，展示如何在不通过 Google Play 的情况下安装加密的应用，并了解 Google Play 如何提供加密的应用。</p>
<h2 id="操作系统对加密应用程序的支持"><a href="#操作系统对加密应用程序的支持" class="headerlink" title="操作系统对加密应用程序的支持"></a>操作系统对加密应用程序的支持</h2><p>本文之前的版本是基于 Eclipse 框架和二进制的系统镜像，并且缺少一部分。由于 Jelly Bean 已经开源，下面的讨论已经修改，现在是基于 AOSP 代码（4.1.1_r1）。如果你回来重读本文，重点放在第二部分。</p>
<a id="more"></a>
<p>Android 上的应用可以通过几种不同的方式安装：</p>
<ul>
<li>通过应用商店（例如 <a href="https://play.google.com/store" target="_blank" rel="external">Google Play Store</a>，也称为 Android Market）</li>
<li>直接在手机上打开应用文件或电子邮件附件（如果启用“位置来源”选项）</li>
<li>使用通过 USB 连接的计算机的 <code>adb install</code> SDK 命令</li>
</ul>
<p>前两个不提供任何选项或者特定视角的底层实现，让我们探索第三个。看看使用 adb 命令的输出，可以看到 install 命令在最新的 SDK 版本中获得了几个新选项：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ adb install [-l] [-r] [-s] [--algo &lt;algorithm name&gt; --key &lt;hex-encoded key&gt; </div><div class="line">--iv &lt;hex-encoded iv&gt;] &lt;file&gt;</div></pre></td></tr></table></figure>
<p>显然 <code>—algo</code> 、 <code>—key</code> 和 <code>—iv</code> 参数与加密应用程序有关，所以在进入详细信息之前，首先尝试安装一个加密的 APK。使用 <strong><a href="http://openssl.org/" target="_blank" rel="external">OpenSSL</a> enc </strong> 命令加密文件相当容易，通常它已经在大多数 Linux 系统上安装。我们使用 CBC 模式下的 AES 算法，配合一个128 bit 的 Key（下文可以看到，这一个不是很安全的密钥），为使事情更简单，这里使用与密钥相同的初始化向量（initialization vector, IV）。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span><span class="bash"> openssl enc -aes-128-cbc -K 000102030405060708090A0B0C0D0E0F </span></div><div class="line">-iv 000102030405060708090A0B0C0D0E0F -in my-app.apk -out my-app-enc.apk</div></pre></td></tr></table></figure>
<p>让我们尝试安装它来检查 Android 是否喜欢我们新加密的应用程序：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span><span class="bash"> adb install --algo <span class="string">'AES/CBC/PKCS5Padding'</span> --key 000102030405060708090A0B0C0D0E0F </span></div><div class="line">--iv 000102030405060708090A0B0C0D0E0F my-app-enc.apk</div><div class="line">        pkg: /data/local/tmp/my-app-enc.apk</div><div class="line">Success</div></pre></td></tr></table></figure>
<p>“Success” 的输出结果看起来似乎很有前途，然后确认应用的图标显示在系统面板中并且启动时无错误。实际的 APK 文件像往常一样被复制在 <code>/data/app</code> 中，将其哈希值与我们加密的 APK 进行比较，发现它实际上是一个不同的文件。安装后的文件的哈希值和原始（未加密） APK 的完全相同，因此我们可以得出结论，APK 在安装是使用我们提供的加密参数（算法、密钥和 IV）进行解密。让我们看看这是如何实现的。</p>
<p><code>adb install</code> 命令根本上是调用 <code>pm</code> Android 命令行实用程序，它允许我们列出、安装和删除包（应用程序）。 通常 PackageManagerService 是负责在 Android 上安装应用程序的组件，pm 只是一个方便的前端。 应用程序通常通过 <a href="https://developer.android.com/reference/android/content/pm/PackageManager.html" target="_blank" rel="external">PackageManager</a> 类来访问包服务。 浏览其代码并检查加密相关方法，我们发现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">installPackageWithVerification</span><span class="params">(Uri packageURI,</span></span></div><div class="line"><span class="function"><span class="params">        IPackageInstallObserver observer, <span class="keyword">int</span> flags, String installerPackageName,</span></span></div><div class="line"><span class="function"><span class="params">        Uri verificationURI, ManifestDigest manifestDigest,</span></span></div><div class="line"><span class="function"><span class="params">        ContainerEncryptionParams encryptionParams)</span></span>;</div></pre></td></tr></table></figure>
<p>ContainerEncryptionParams 类看起来特别有可能，所以让我们看看里面：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ContainerEncryptionParams</span> <span class="keyword">implements</span> <span class="title">Parcelable</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String mEncryptionAlgorithm;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> IvParameterSpec mEncryptionSpec;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SecretKey mEncryptionKey;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String mMacAlgorithm;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AlgorithmParameterSpec mMacSpec;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SecretKey mMacKey;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">byte</span>[] mMacTag;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> mAuthenticatedDataStart;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> mEncryptedDataStart;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>我们使用的 <code>adb install</code> 参数完全对应于类的前三个字段。 除此之外，该类还存储 MAC 相关参数，因此可以安全地假设 Android 现在可以检查应用程序二进制文件的完整性。 不幸的是，pm 命令没有任何 MAC 相关的参数（它实际上有，但由于某些原因，在当前生成中禁用），所以为了尝试 MAC 支持，我们需要直接调用 <code>installPackageWithVerification</code> 方法。</p>
<p>该方法对于 SDK 应用程序是隐藏的，因此从应用程序里调用它的唯一方法是使用反射。事实证明，它的大多数参数类（ IPackageInstallObserver，ManifestDigest 和 ContainerEncryptionParams ）也被隐藏，但这只是一个小陷阱。 对于 Android 预加载框架类，即使你的应用程序捆绑了一个框架类，系统副本仍旧会在运行时使用它。这意味着我们必须做的是为 <code>installPackageWithVerification</code> 方法获取一个句柄，将所需的类添加到我们的应用程序中的 <code>andorid.content.pm</code> 包中。一旦我们有一个方法句柄，我们只需要实例化 <code>ContainerEncryptionParams</code> 类，然后提供所有的加密和 MAC 相关的参数。需要注意的是，由于我们的整个文件是加密的，并且 MAC 是在其所有内容上计算的（见下文），我们为加密和认证数据的开头指定为 0，将文件大小指定为数据的结尾（查看<a href="https://github.com/nelenkov/jb-app-encryption" target="_blank" rel="external">示例代码</a>）。为了计算 MAC 值（标签），我们再次使用 OpenSSL：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span><span class="bash"> openssl dgst -hmac <span class="string">'hmac_key_1'</span> -sha1 -hex my-app-enc.apk</span></div><div class="line">HMAC-SHA1(my-app-enc.apk)= 0dc53c04d33658ce554ade37de8013b2cff0a6a5</div></pre></td></tr></table></figure>
<p>请注意，<code>dgst</code> 命令不支持使用十六进制或 Base64 的 HMAC 密钥，因此您只能使用 ASCII 字符。 这对于生产使用可能不是一个好主意，因此请考虑使用真正的密钥并以某种其他方式（使用 JCE 等）来计算 MAC。</p>
<p>我们的应用程序现在大部分已准备就绪，但安装应用程序需要 <code>INSTALL_PACKAGES</code> 权限，该权限与保护级别 <code>signatureOrSystem</code> 一起定义。 因此，它只被授予使用系统（ROM）密钥签名的应用程序或安装在 <code>/system</code> 分区中的应用程序。 构建 Jelly Bean ROM 是一个有趣的练习，但现在，我们只需将我们的应用程序复制到 <code>/system/app</code>，以获得安装软件包（在模拟器或 Root 过的设备上）的必要权限。 一旦完成，我们可以通过 <code>PackageManager</code> 安装加密的应用程序，Android 将通过比较指定的 MAC 标记与基于实际文件内容计算的值来解密 APK 并验证包没有被篡改。 您可以通过稍微更改加密和 MAC 参数来使用示例应用程序进行测试，这将导致安装错误。</p>
<p><img src="http://mmmedia.qiniudn.com/2017-01-08-160231.jpg" alt="jb-app-encryption"></p>
<p><code>android.content.pm</code> 包有一些更有趣的类，例如 <code>MacAuthenticatedInputStream</code> 和 <code>ManifestDigest</code> ，但实际的 APK 加密和 MAC 验证是由 <code>DefaultContainerService$ApkContainer</code> 做的，它是 <code>DefaultContainerService</code>（aka，<code>Package Access Helper</code>）的一部分。</p>
<h2 id="前向锁定（Forward-locking）"><a href="#前向锁定（Forward-locking）" class="headerlink" title="前向锁定（Forward locking）"></a>前向锁定（Forward locking）</h2><p>在移动（功能）手机上，通常当铃声、壁纸或者其他数字商品开始进行销售时，<strong>Forward locking</strong> 会弹出。它的名称来自它的意图：阻止用户转发他们已经购买的文件给自己的朋友和家人。Android 上的主要数字内容是原生应用程序，随着付费应用越来越受欢迎，共享（二次销售）成为一个问题。应用程序包（APKs）在 Android 上是公共可读的，这使得即使是在生产设备中提取应用程序也相对容易。虽然公共可读的应用程序文件可能听起来像是一个坏主意，它根植于 Android 的开放和可扩展性—第三方启动器、Widget 容器和应用程序可以轻松的提取 APKs 的 Icon、Widget 的可定义 Intents等等。为了锁定付费应用程序而不失去任何操作系统的灵活性，Android 引入了 <strong>Forward locking</strong>（又称“拷贝保护”）。它的想法是把应用程序包分为两部分：一个公共可读的部分，包括资源文件和 manifest （保存在 <code>/data/app</code> ）；一个系统用户可读的包含可执行代码的包（保存在 <code>/data/app-private</code> ）。代码包受文件系统权限保护，虽然这使得大多数消费者设备上的用户无法访问它，但是只需要获得 <code>root</code> 访问权限即可提取它。这种方法很快就被启用，引入了在线 Android 授权（LVL）作为替代品。然而，这将应用程序保护实施从操作系统转移到应用程序开发人员，并取得了不同的结果。</p>
<p>在 Jelly Bean 中，<strong>Forward locking</strong>  的实现已经重新设计，现在提供了将 APK 存储在加密容器中的能力，该加密容器需要在运行时安装设备特定密钥。让我们更详细地研究一下实现。</p>
<h2 id="Jelly-Bean-实现"><a href="#Jelly-Bean-实现" class="headerlink" title="Jelly Bean 实现"></a>Jelly Bean 实现</h2><p>虽然对于 JB（Jelly Bean），把加密的应用程序容器作为一个前向锁定机制是新加的，但加密容器的想法开始于 Froyo。 当时（2010年5月），大多数Android 设备都配备有有限的内部存储空间和相当大（几GB）的外部存储设备，通常采用 micro SD 卡的形式。 为了使文件共享更容易，外部存储使用 FAT 文件系统进行了格式化，该文件系统缺少文件权限。 因此，任何人（任何应用程序）都可以读取和写入 SD 卡上的文件。 为了防止用户简单地将付费应用程序复制到 SD 卡上，Froyo 创建了一个加密的文件系统映像文件，并在您选择将应用移动到外部存储时将 APK 存储在其中。 然后使用 Linux 的设备映射程序在运行时安装映像，系统将从新创建的安装点（每个应用程序一个）加载应用程序文件。 基于此，JB 的容器使用 EXT4 文件系统，它允许权限。 典型的前向锁定应用程序的挂载点现在如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">shell@android:/mnt/asec/org.mypackage-1 # ls -l</div><div class="line">ls -l</div><div class="line">drwxr-xr-x system   system            2012-07-16 15:07 lib</div><div class="line">drwx------ root     root              1970-01-01 09:00 lost+found</div><div class="line">-rw-r----- system   u0_a96    1319057 2012-07-16 15:07 pkg.apk</div><div class="line">-rw-r--r-- system   system     526091 2012-07-16 15:07 res.zip</div></pre></td></tr></table></figure>
<p>这里 <strong>res.zip</strong> 拥有应用程序资源，是公共可读的，而保存完整 APK 的 <strong>pkg.apk</strong> 文件只能由系统和应用程序的专用用户（u0_a96）读取。 实际的应用程序容器存储在<code>/data/app-asec</code> 中，文件名为 <code>pacakge.name-1.asec</code> 。 ASEC 容器管理（创建/删除和挂载/卸载）在系统卷守护程序（vold）中实现，框架服务通过通过本地 <strong>socket</strong> 发送命令与之通信。 我们可以使用 <strong>vdc</strong> 实用程序从 <strong>shell</strong> 管理转发锁定的应用程序：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> vdc asec list</span></div><div class="line">vdc asec list</div><div class="line">111 0 com.mypackage-1</div><div class="line">111 0 org.foopackage-1</div><div class="line">200 0 asec operation succeeded</div><div class="line"></div><div class="line"><span class="meta">#</span><span class="bash"> vdc asec unmount org.foopackage-1</span></div><div class="line">200 0 asec operation succeeded</div><div class="line"></div><div class="line"><span class="meta">#</span><span class="bash"> vdc asec mount org.foopackage-1 000102030405060708090a0b0c0d0e0f 1000</span></div><div class="line">org.foopackage-1 000102030405060708090a0b0c0d0e0f  1000                    </div><div class="line">200 0 asec operation succeeded</div><div class="line"></div><div class="line"><span class="meta">#</span><span class="bash"> vdc asec path org.foopackage-1</span></div><div class="line">vdc asec path org.foopackage-1</div><div class="line">211 0 /mnt/asec/org.foopackage-1</div></pre></td></tr></table></figure>
<p>所有命令都将命名空间 ID（实际上基于包名称）作为参数，对于 <strong>mount</strong> 命令，您需要指定加密密钥和装载点的所有者 UID（1000是系统）。 那就是如何存储和使用应用程序，剩下的是找出实际的加密算法和密钥。 两者从原始的 Froyo 应用程序到 SD 实现没有变化：Twofish 与128位密钥存储在 <code>/data/misc/systemkeys</code> ：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">shell@android:/data/misc/systemkeys $ ls</div><div class="line">ls</div><div class="line">AppsOnSD.sks</div><div class="line">shell@android:/data/misc/systemkeys $ od -t x1 AppsOnSD.sks</div><div class="line">od -t x1 AppsOnSD.sks</div><div class="line">0000000 00 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f</div><div class="line">0000020</div></pre></td></tr></table></figure>
<p>通过指定 <code>pm install</code>命令的 <code>-l</code> 选项或为 <code>PackageManager</code> 的 <code>installPackage*</code> 方法指定 <code>INSTALL_FORWARD_LOCK</code> 标志（请参阅<a href="https://github.com/nelenkov/jb-app-encryption" target="_blank" rel="external">示例应用程序</a>）来触发转发锁定应用程序。</p>
<h2 id="加密应用程序和-Google-Play"><a href="#加密应用程序和-Google-Play" class="headerlink" title="加密应用程序和 Google Play"></a>加密应用程序和 Google Play</h2><p>所有这一切都很有趣，但正如我们所见，安装应用程序、加密或其他都需要系统权限，因此它只能由自定义运营商Android 固件和下一个版本友好的 CyanogenMod ROM 使用。 目前唯一利用了新的加密应用程序和前向锁定基础设施的应用程序是 Play Store（谁出来了这些名字，真的？）Android 客户端。 要详细了解 Google Play 客户端的工作原理，需要详细了解底层协议（这始终是一个移动目标），但随意查看最新的 Android 客户端确实显示了一些有用的信息。 Google Play 服务器会发送相当多的有关您即将下载和安装的应用的元数据，例如下载网址，APK 文件大小，版本代码和退款窗口。 其中新增的是 <code>EncryptionParams</code> ，它看起来非常类似于上面显示的<code>ContainerEncryptionParams</code> ：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">AndroidAppDelivery</span>$<span class="title">EncryptionParams</span> </span>&#123;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">int</span> cachedSize;</div><div class="line">  <span class="keyword">private</span> String encryptionKey;</div><div class="line">  <span class="keyword">private</span> String hmacKey;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">int</span> version;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>加密算法和 HMAC 算法总是分别设置为 <code>&#39;AES / CBC / PKCS5Padding&#39;</code> 和 <code>&#39;HMACSHA1&#39;</code> 。 IV 和 MAC 标签与加密的APK 捆绑在一个 blob 中。 一旦读取和验证所有参数，它们基本上将转换为 <code>ContainerEncryptionParams</code> 实例，并使用熟悉的 <code>PackageManager.installPackageWithVerification()</code> 方法安装应用程序。 如可能预期的，安装付费应用程序时，将设置 <code>INSTALL_FORWARD_LOCK</code> 标志。 操作系统从这里获取它，并且过程与上一节中描述的相同：免费应用程序被解密，APK最终在 <code>/data/app</code> 中，而在 <code>/data/app-asec</code> 中的加密容器被创建和装载在付费应用的 <code>/mnt/asec/package.name</code> 下。</p>
<p>那么在实践中这是什么意思？ Google Play 现在声称，付费应用程序始终以加密形式传输和存储，因此，如果您决定使用 Jelly Bean 提供的应用程序加密设施实现它，则您自己的应用程序分发渠道也会如此。 应用程序必须在某些时候可用于操作系统，所以如果你有 root 用户访问正在运行的 Android 设备，仍然可以提取前向锁定 APK 或容器加密密钥，但这确实是所有软件的解决方案。</p>
<p><strong>更新：</strong>虽然正向锁定使得复制付费应用程序更难，似乎它与其他服务的集成仍然有一些问题。 根据<a href="http://code.google.com/p/android/issues/detail?id=34880" target="_blank" rel="external">这里</a>的多个开发人员和用户的报告，它目前打破了应用程序注册自己账户管理的实现，包含大多数付费小部件的应用程序。 这是由于一些服务在 <code>/mnt/asec</code> 被挂载之前被初始化，因此不能访问它。 据说有一个可用的修复（没有Gerrit链接），并应在 Jelly Bean 维护版中发布。</p>
<p><strong>更新2</strong>：似乎最新版本的 Google Play 客户端（3.7.15）安装了带有小部件的付费应用程序，并且可能还会在 <code>/data/app</code> 中管理帐户（临时？）解决方法。 下载的 APK 仍会加密传输。 例如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">shell@android:/data/app # ls -l|grep -i beautiful</div><div class="line">ls -l|grep -i beautiful</div><div class="line">-rw-r--r-- system   system    6046274 2012-08-06 10:45 com.levelup.beautifulwidgets-1.apk</div></pre></td></tr></table></figure>
<p>这就是现在的情况。 希望，很快就会从官方来源获得有关应用加密操作系统实施和设计以及 Google Play 商店的使用情况的更详细信息。 在那之前，获取<a href="https://github.com/nelenkov/jb-app-encryption" target="_blank" rel="external">示例项目</a>，启动 OpenSSL 并尝试。</p>
<p><a href="https://plus.google.com/117221066931981967754" target="_blank" rel="external">Nikolay Elenkov</a> 发布于 2012 年 7 月 6 日。</p>
]]></content>
      
        
        <tags>
            
            <tag> Android </tag>
            
            <tag> ADB </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android 必知必会- 解决在 Android Studio 中 framework 等 jar 包无法被引用的问题]]></title>
      <url>/2016/12/28/android-code-framework/</url>
      <content type="html"><![CDATA[<blockquote>
<p>在编译原生 Contacts 应用时需用到非公开的 API，需要引入 framework 等 jar 包，但在 Android Studio 中 SDK 带的 jar 包的优先级最高，导致引入的 framework 等 jar 包无法被引用，请问如何将 framework 等 jar 包的优先级调成最高？</p>
<p>—— 知乎 <a href="https://www.zhihu.com/question/35628837" target="_blank" rel="external">在 Android Studio 中如何将依赖的 jar 包放在 SDK 的 android.jar 前？</a></p>
</blockquote>
<p>这是在知乎上的原问题的描述。尝试了该问题下面的多个答案，并没有十分完美的方案，直到一个为公司编译 Android 系统的同事，最近无奈转战到 Android Studio 开始…..</p>
<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>先了解一些基础点：</p>
<h3 id="Android-Studio-中的六种依赖"><a href="#Android-Studio-中的六种依赖" class="headerlink" title="Android Studio 中的六种依赖"></a>Android Studio 中的六种依赖</h3><p>Compile，Provided，APK，Test compile，Debug compile，Release compile</p>
<a id="more"></a>
<p><strong>Compile</strong></p>
<p>compile 是对所有的 build type 以及 favlors 都会参与编译并且打包到最终的 apk 文件中。</p>
<p><strong>Provided</strong></p>
<p>Provided 是对所有的 build type 以及 favlors 只在编译时使用，类似 eclipse 中的 external-libs ，只参与编译，不打包到最终 apk 。</p>
<p><strong>APK</strong></p>
<p>只会打包到 apk 文件中，而不参与编译，所以不能再代码中直接调用 jar 中的类或方法，否则在编译时会报错</p>
<p><strong>Test compile</strong></p>
<p>Test compile 仅仅是针对单元测试代码的编译编译以及最终打包测试 apk 时有效，而对正常的 debug 或者 release apk 包不起作用。</p>
<p><strong>Debug compile</strong></p>
<p>Debug compile 仅仅针对 debug 模式的编译和最终的 debug apk 打包。</p>
<p><strong>Release compile</strong></p>
<p>Release compile 仅仅针对 Release 模式的编译和最终的 Release apk 打包。</p>
<p><strong>PS：</strong>我们会用到 <code>Provided</code> 引用。</p>
]]></content>
      
        
        <tags>
            
            <tag> Android </tag>
            
            <tag> framework </tag>
            
            <tag> gradle </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[android library version]]></title>
      <url>/2016/11/11/android-library-version/</url>
      <content type="html"></content>
      
        
    </entry>
    
    <entry>
      <title><![CDATA[Android 必知必会 - DialogFragment 使用总结]]></title>
      <url>/2016/10/27/dialog-fragment/</url>
      <content type="html"><![CDATA[<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>Android 官方推荐使用 <code>DialogFragment</code> 来代替 <code>Dialog</code> ，可以让它具有更高的可复用性（降低耦合）和更好的便利性（很好的处理屏幕翻转的情况）。</p>
<p>而创建 <code>DialogFragment</code> 有两种方式：</p>
<ol>
<li>覆写其 <code>onCreateDialog</code> 方法 — ①</li>
<li>覆写其 <code>onCreateView</code> 方法 — ②</li>
</ol>
<p>虽然这两种方式都能实现相同的效果，但是它们各有自己适合的应用场景：</p>
<ol>
<li>方法 ①，一般用于创建替代传统的 <code>Dialog</code> 对话框的场景，UI 简单，功能单一。</li>
<li>方法 ②，一般用于创建复杂内容弹窗或全屏展示效果的场景，UI 复杂，功能复杂，一般有网络请求等异步操作。</li>
</ol>
<a id="more"></a>
<h2 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h2><h3 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h3><p><strong>对于方法 ①</strong>，创建一个 <code>Dialog</code> 并返回它即可：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> Dialog <span class="title">onCreateDialog</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">  	<span class="comment">//为了样式统一和兼容性，可以使用 V7 包下的 AlertDialog.Builder</span></div><div class="line">    AlertDialog.Builder builder = <span class="keyword">new</span> AlertDialog.Builder(getActivity());</div><div class="line">  	<span class="comment">// 设置主题的构造方法</span></div><div class="line">	<span class="comment">// AlertDialog.Builder builder = new AlertDialog.Builder(getActivity(), R.style.CustomDialog);</span></div><div class="line">    builder.setTitle(<span class="string">"注意："</span>)</div><div class="line">           .setMessage(<span class="string">"是否退出应用？"</span>)</div><div class="line">           .setPositiveButton(<span class="string">"确定"</span>, <span class="keyword">null</span>)</div><div class="line">           .setNegativeButton(<span class="string">"取消"</span>, <span class="keyword">null</span>)</div><div class="line">           .setCancelable(<span class="keyword">false</span>);</div><div class="line">           <span class="comment">//builder.show(); // 不能在这里使用 show() 方法</span></div><div class="line">    <span class="keyword">return</span> builder.create();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>当然，你也可以使用自定义 <code>View</code> 来创建：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> Dialog <span class="title">onCreateDialog</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">	AlertDialog.Builder builder = <span class="keyword">new</span> AlertDialog.Builder(getActivity());</div><div class="line">  	<span class="comment">// 设置主题的构造方法</span></div><div class="line">	<span class="comment">// AlertDialog.Builder builder = new AlertDialog.Builder(getActivity(), R.style.CustomDialog);</span></div><div class="line">	LayoutInflater inflater = getActivity().getLayoutInflater();  </div><div class="line">    View view = inflater.inflate(R.layout.fragment_dialog, <span class="keyword">null</span>);  </div><div class="line">    builder.setView(view) </div><div class="line"> 	<span class="comment">// Do Someting,eg: TextView tv = view.findViewById(R.id.tv);</span></div><div class="line">    <span class="keyword">return</span> builder.create();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>PS：创建 <code>Dialog</code> 的方式有多种，比如下面这种，使用时略有差异，需要自己注意：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> Dialog <span class="title">onCreateDialog</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">	LayoutInflater inflater = getActivity().getLayoutInflater();</div><div class="line">    View view = inflater.inflate(R.layout.fragment_dialog, <span class="keyword">null</span>);</div><div class="line">	Dialog dialog = <span class="keyword">new</span> Dialog(getActivity());</div><div class="line">    <span class="comment">// 设置主题的构造方法</span></div><div class="line">  	<span class="comment">// Dialog dialog = new Dialog(getActivity(), R.style.CustomDialog);</span></div><div class="line">    dialog.setContentView(view);</div><div class="line">  	<span class="comment">// Do Someting</span></div><div class="line">	<span class="keyword">return</span> dialog;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>对于方法 ②</strong>，和普通的 <code>Fragment</code> 用法基本一致：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> View <span class="title">onCreateView</span><span class="params">(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">	View rootView = inflater.inflate(R.layout.fragment_dialog, container, <span class="keyword">false</span>);</div><div class="line">	<span class="comment">// Do Someting</span></div><div class="line">	<span class="keyword">return</span> rootView;</div><div class="line">&#125;</div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 设置主题需要在 onCreate() 方法中调用 setStyle() 方法</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">	<span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">	setStyle(DialogFragment.STYLE_NO_TITLE, R.style.CustomDialog);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="处理屏幕翻转"><a href="#处理屏幕翻转" class="headerlink" title="处理屏幕翻转"></a>处理屏幕翻转</h3><p>如果使用传统的 <code>Dialog</code> ，需要我们手动处理屏幕翻转的情况，但使用 <code>DialogFragment</code> 的话，则不需要我们进行任何处理，<code>FragmentManager</code> 会自动管理 <code>DialogFragment</code> 的生命周期。</p>
<p>扩展阅读：<a href="http://likfe.com">Dialog 在屏幕翻转时的处理</a></p>
<h3 id="无标题栏-全屏"><a href="#无标题栏-全屏" class="headerlink" title="无标题栏/全屏"></a>无标题栏/全屏</h3><p>在基本用法里代码注释有设置主题的地方，下面详细说下两种方法下设置无标题栏和实现全屏的方式：</p>
<h4 id="无标题栏"><a href="#无标题栏" class="headerlink" title="无标题栏"></a>无标题栏</h4><p>对于方法 ① ：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> Dialog <span class="title">onCreateDialog</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">	LayoutInflater inflater = getActivity().getLayoutInflater();</div><div class="line">	View view = inflater.inflate(R.layout.fragment_dialog, <span class="keyword">null</span>);</div><div class="line">	Dialog dialog = <span class="keyword">new</span> Dialog(getActivity(), R.style.CustomDialog);</div><div class="line">  	<span class="comment">// 关闭标题栏，setContentView() 之前调用</span></div><div class="line">	dialog.requestWindowFeature(Window.FEATURE_NO_TITLE);</div><div class="line">	dialog.setContentView(view);</div><div class="line">	dialog.setCanceledOnTouchOutside(<span class="keyword">true</span>);</div><div class="line">	<span class="keyword">return</span> dialog;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>对于方法 ②：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">	<span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">	<span class="comment">/**</span></div><div class="line"><span class="comment">	 * setStyle() 的第一个参数有四个可选值：</span></div><div class="line"><span class="comment">	 * STYLE_NORMAL|STYLE_NO_TITLE|STYLE_NO_FRAME|STYLE_NO_INPUT</span></div><div class="line"><span class="comment">	 * 其中 STYLE_NO_TITLE 和 STYLE_NO_FRAME 可以关闭标题栏</span></div><div class="line"><span class="comment">	 * 每一个参数的详细用途可以直接看 Android 源码的说明</span></div><div class="line"><span class="comment">	 */</span></div><div class="line">	setStyle(DialogFragment.STYLE_NO_TITLE, R.style.CustomDialog);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="实现全屏（宽-高度全屏）"><a href="#实现全屏（宽-高度全屏）" class="headerlink" title="实现全屏（宽/高度全屏）"></a>实现全屏（宽/高度全屏）</h4><p>常用的形式大多是宽度上和屏幕一样宽，高度自适应，下面直接看代码：</p>
<p><strong>方法 ① ：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> Dialog <span class="title">onCreateDialog</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">	LayoutInflater inflater = getActivity().getLayoutInflater();</div><div class="line">	View view = inflater.inflate(R.layout.fragment_dialog, <span class="keyword">null</span>);</div><div class="line">	Dialog dialog = <span class="keyword">new</span> Dialog(getActivity(), R.style.CustomDialog);</div><div class="line">	dialog.requestWindowFeature(Window.FEATURE_NO_TITLE);</div><div class="line">	dialog.setContentView(view);</div><div class="line">	dialog.setCanceledOnTouchOutside(<span class="keyword">true</span>);</div><div class="line">	<span class="comment">//Do something</span></div><div class="line">    <span class="comment">// 设置宽度为屏宽、位置靠近屏幕底部</span></div><div class="line">	Window window = dialog.getWindow();</div><div class="line">	window.setBackgroundDrawableResource(R.color.transparent);</div><div class="line">	WindowManager.LayoutParams wlp = window.getAttributes();</div><div class="line">	wlp.gravity = Gravity.BOTTOM;</div><div class="line">	wlp.width = WindowManager.LayoutParams.MATCH_PARENT;</div><div class="line">  	wlp.height = WindowManager.LayoutParams.WRAP_CONTENT;</div><div class="line">	window.setAttributes(wlp);</div><div class="line">	<span class="keyword">return</span> dialog;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>代码 <code>12</code> 行设置了窗口的背景色为透明，这一步是必须的；</p>
<p>代码 <code>15</code> 行设置窗口的宽度为 <code>MATCH_PARENT</code>,效果是和屏幕宽度一样大，同样你也可以设置高度的值。设置宽度和高度除了 <code>MATCH_PARENT</code> 和 <code>WRAP_CONTENT</code> ，也可以直接设置成具体的数值。</p>
<p><strong>方法 ②：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">	<span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">	setStyle(DialogFragment.STYLE_NO_TITLE, R.style.CustomDialog);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> View <span class="title">onCreateView</span><span class="params">(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        getDialog().setCanceledOnTouchOutside(<span class="keyword">true</span>);</div><div class="line">        View rootView = inflater.inflate(R.layout.fragment_dialog, container, <span class="keyword">false</span>);</div><div class="line">        <span class="comment">//Do something</span></div><div class="line">        <span class="comment">// 设置宽度为屏宽、靠近屏幕底部。</span></div><div class="line">        <span class="keyword">final</span> Window window = getDialog().getWindow();</div><div class="line">        window.setBackgroundDrawableResource(R.color.transparent);</div><div class="line">        window.getDecorView().setPadding(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">        WindowManager.LayoutParams wlp = window.getAttributes();</div><div class="line">        wlp.gravity = Gravity.BOTTOM;</div><div class="line">        wlp.width = WindowManager.LayoutParams.MATCH_PARENT;</div><div class="line">        wlp.height = WindowManager.LayoutParams.WRAP_CONTENT;</div><div class="line">        window.setAttributes(wlp);</div><div class="line">        <span class="keyword">return</span> rootView;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>代码 <code>14</code> 行设置了窗口的背景色为透明，这一步是必须的；</p>
<p>代码 <code>15</code> 行设置了窗口的 Pading 值全部为0，这一步也是必须的，内容不能填充全部宽度和高度。</p>
<p>其他的和 ① 中的类似。</p>
<h3 id="应用场景区别"><a href="#应用场景区别" class="headerlink" title="应用场景区别"></a>应用场景区别</h3><p>文章一开始简单总结了方法 ① 和方法 ② 的应用场景，这里说明下：</p>
<ul>
<li>从基本的用法中可以看到方法 ① 为简单的替代 <code>Dialog</code> 提供了非常方便的创建方式，比方法 ② 有优势</li>
<li>方法 ① 在使用了多线程（例如网络请求）的情况下，不能正确的获取当前 Fragment 的状态，会产生空指针异常。方法 ② 则没有此问题，而且，其创建方式默认使用了自定义 View，更便于应对复杂 UI 的场景。</li>
</ul>
<p>这里举例说明：方法 ① 和方法 ② 的<code>//Do something</code> 代码处，我们进行一些异步操作：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">TextView title = rootView.findViewById(R.id.dialoag_tv);</div><div class="line">title.setText(<span class="string">"Value A"</span>);</div><div class="line"><span class="keyword">new</span> SomeTask().execute(url);</div><div class="line"></div><div class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">SomeTask</span> <span class="keyword">extends</span> <span class="title">AsyncTask</span>&lt;<span class="title">String</span>, <span class="title">Void</span>, <span class="title">Boolean</span>&gt; </span>&#123;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">protected</span> Boolean <span class="title">doInBackground</span><span class="params">(String... params)</span> </span>&#123;</div><div class="line">            <span class="comment">// 一些网络请求</span></div><div class="line">          	<span class="comment">// 成功时 return true;</span></div><div class="line">            <span class="comment">// 异常时 return false;</span></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onPostExecute</span><span class="params">(Boolean aBoolean)</span> </span>&#123;</div><div class="line">            <span class="keyword">super</span>.onPostExecute(aBoolean);</div><div class="line">            <span class="comment">// if (!isVisible()) return;</span></div><div class="line">            <span class="keyword">if</span> (aBoolean) &#123;</div><div class="line">                title.setText(<span class="string">"Value B"</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p> 如果在网络请求未结束或者刚结束时关闭了当前 <code>DialogFragment</code> ，代码 <code>19</code> 行就会报空指针异常了，代码 <code>17</code> 的作用就是判断 <code>DialogFragment</code> 当前的状态是否为可用态，但是 <code>isVisible()</code> 以及 <code>isHide()</code> 对于方法 ① 无法正确返回其状态，方法 ② 则正常。方法 ① 和方法 ② 创建 <code>DialogFragment</code> 的一些状态并不是完全一致。</p>
<p>PS：你也可以使用静态 <code>Handler</code> 结合弱引用等来处理异步操作，那样对 <code>DialogFragment</code> 状态的获取就不重要了。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>以上是个人在实际开发过程中的一点总结和看法，希望你能抱着存疑的态度进行尝试，如果有新的观点或者文章中有不正确的地方，欢迎和我联系。</p>
<p>扩展阅读：</p>
<ul>
<li><a href="http://www.cnblogs.com/tianzhijiexian/p/4161811.html" target="_blank" rel="external">详细解读 DialogFragment</a></li>
<li><a href="http://blog.csdn.net/angcyo/article/details/50613084" target="_blank" rel="external">Android–&gt;Dialog/DialogFragment宽度高度修改/全屏,自定义样式</a> </li>
<li><a href="http://stackoverflow.com/questions/7189948/full-screen-dialogfragment-in-android" target="_blank" rel="external">Full Screen DialogFragment in Android</a></li>
</ul>
<p><strong>PS</strong>：你可以通过下面的方式和我联系</p>
<blockquote>
<ul>
<li>微博：<a href="http://weibo.com/zyansen" target="_blank" rel="external">cafeting</a></li>
<li>Github： <a href="https://github.com/likfe" target="_blank" rel="external">likfe</a></li>
<li>CSDN：<a href="http://blog.csdn.net/ys743276112" target="_blank" rel="external">他叫自己Mr.张</a> </li>
</ul>
</blockquote>
]]></content>
      
        
        <tags>
            
            <tag> Android </tag>
            
            <tag> DialogFragment </tag>
            
            <tag> Fragment </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android 必知必会 - RadioGroup 和 ViewPager 联动]]></title>
      <url>/2016/09/20/androd-radioGroup-and-viewPager/</url>
      <content type="html"><![CDATA[<p>使用 RadioGroup 和 ViewPager 实现更加可定制的效果。</p>
<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>昨天设计图刚出一点，写了<a href="http://blog.csdn.net/ys743276112/article/details/52587509" target="_blank" rel="external">《Android 必知必会 - 动态切换着色模式和全屏模式》</a>，记录了动态修改页面显示模式的方式。今天又有新图，不过设计师只考虑 iOS 平台的设计，拿到设计图发现 <code>TabLayout + ViewPager</code> 的套路实现起来很麻烦，考虑了下，为了方便，决定使用 <code>RadioGroup + ViewPager</code> 来实现，之所以使用 <code>RadioGroup</code> ，是因为它内部多个 <code>RadioButton</code> 的状态是互斥的，也就是只有一个是选中状态，不需要我们进行多余的处理。总体来说比较简单，就是细节略多了点。</p>
<p>主要知识点：</p>
<ul>
<li>自定义 <code>RadioButton</code> 样式 : <code>selector + shape</code></li>
<li>自定义 <code>RadioButton</code> 文字样式 : <code>selector</code></li>
<li><code>ViewPager + Fragment</code> 及其适配器</li>
<li><code>RadioGroup</code> 状态监听</li>
<li><code>ViewPager</code> 页面切换监听</li>
</ul>
<a id="more"></a>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p>先看效果图：</p>
<p><img src="http://mmmedia.qiniudn.com/2016-09-20-radiogroup_viewpager.gif" alt=""></p>
<h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p><strong>UI：</strong></p>
<ul>
<li>顶部是 <code>RadioGroup</code> ，内部包含两个 <code>RadioButton</code> <ul>
<li><code>RadioButton</code> 需要自定义背景和文字</li>
</ul>
</li>
<li>中间是 <code>ViewPager</code> </li>
</ul>
<p><strong>联动事件：</strong></p>
<ul>
<li><code>ViewPager</code> <ul>
<li>需要为 <code>ViewPager</code> 写适配器，以配合 <code>Fragment</code></li>
<li>使用 <code>addOnPageChangeListener()</code>  为其添加监听页面变动的事件<ul>
<li>在 <code>onPageSelected(int position)</code> 方法中修改 <code>RadioGroup</code> 中 <code>RadioButton</code> 的选中状态</li>
</ul>
</li>
</ul>
</li>
<li><code>RadioGroup</code> <ul>
<li>设置 <code>setOnCheckedChangeListener</code> 监听，并在其中修改 <code>ViewPager</code> 的状态</li>
</ul>
</li>
</ul>
<h3 id="实现-UI"><a href="#实现-UI" class="headerlink" title="实现 UI"></a>实现 UI</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">LinearLayout</span></span></div><div class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></span></div><div class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></span></div><div class="line"><span class="tag">    &gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">RelativeLayout</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"45dp"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:background</span>=<span class="string">"@color/title_bar"</span>&gt;</span></div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">RadioGroup</span></span></div><div class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/main_top_rg"</span></span></div><div class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></div><div class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></div><div class="line"><span class="tag">            <span class="attr">android:layout_centerInParent</span>=<span class="string">"true"</span></span></div><div class="line"><span class="tag">            <span class="attr">android:gravity</span>=<span class="string">"center"</span></span></div><div class="line"><span class="tag">            <span class="attr">android:orientation</span>=<span class="string">"horizontal"</span>&gt;</span></div><div class="line"></div><div class="line">            <span class="tag">&lt;<span class="name">RadioButton</span></span></div><div class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">"@+id/top_rg_a"</span></span></div><div class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">"76dp"</span></span></div><div class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">"29dp"</span></span></div><div class="line"><span class="tag">                <span class="attr">android:background</span>=<span class="string">"@drawable/top_r_bg"</span></span></div><div class="line"><span class="tag">                <span class="attr">android:button</span>=<span class="string">"@null"</span></span></div><div class="line"><span class="tag">                <span class="attr">android:checked</span>=<span class="string">"true"</span></span></div><div class="line"><span class="tag">                <span class="attr">android:gravity</span>=<span class="string">"center"</span></span></div><div class="line"><span class="tag">                <span class="attr">android:text</span>=<span class="string">"@string/main_tab1"</span></span></div><div class="line"><span class="tag">                <span class="attr">android:textColor</span>=<span class="string">"@drawable/top_r_text"</span></span></div><div class="line"><span class="tag">                <span class="attr">android:textColorHighlight</span>=<span class="string">"@color/title_bar"</span></span></div><div class="line"><span class="tag">                <span class="attr">android:textSize</span>=<span class="string">"15sp"</span>/&gt;</span></div><div class="line"></div><div class="line">            <span class="tag">&lt;<span class="name">RadioButton</span></span></div><div class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">"@+id/top_rg_b"</span></span></div><div class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">"76dp"</span></span></div><div class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">"29dp"</span></span></div><div class="line"><span class="tag">                <span class="attr">android:background</span>=<span class="string">"@drawable/top_r_bg2"</span></span></div><div class="line"><span class="tag">                <span class="attr">android:button</span>=<span class="string">"@null"</span></span></div><div class="line"><span class="tag">                <span class="attr">android:gravity</span>=<span class="string">"center"</span></span></div><div class="line"><span class="tag">                <span class="attr">android:layout_marginLeft</span>=<span class="string">"-1dp"</span></span></div><div class="line"><span class="tag">                <span class="attr">android:text</span>=<span class="string">"@string/main_tab2"</span></span></div><div class="line"><span class="tag">                <span class="attr">android:textColor</span>=<span class="string">"@drawable/top_r_text"</span></span></div><div class="line"><span class="tag">                <span class="attr">android:textColorHighlight</span>=<span class="string">"@color/title_bar"</span></span></div><div class="line"><span class="tag">                <span class="attr">android:textSize</span>=<span class="string">"15sp"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">RadioGroup</span>&gt;</span></div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></div><div class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/main_top_right"</span></span></div><div class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></div><div class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></div><div class="line"><span class="tag">            <span class="attr">android:layout_alignParentRight</span>=<span class="string">"true"</span></span></div><div class="line"><span class="tag">            <span class="attr">android:layout_centerVertical</span>=<span class="string">"true"</span></span></div><div class="line"><span class="tag">            <span class="attr">android:paddingLeft</span>=<span class="string">"@dimen/left_padding"</span></span></div><div class="line"><span class="tag">            <span class="attr">android:paddingRight</span>=<span class="string">"@dimen/right_padding"</span></span></div><div class="line"><span class="tag">            <span class="attr">android:src</span>=<span class="string">"@drawable/main_search"</span></span></div><div class="line"><span class="tag">            /&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">android.support.v4.view.ViewPager</span></span></div><div class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/main_viewpager"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"0dp"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_weight</span>=<span class="string">"1"</span></span></div><div class="line"><span class="tag">        /&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<p>重点在 <code>RadioButton</code> 的几个属性：</p>
<ul>
<li><code>android:button=&quot;@null&quot;</code> 隐藏 <code>RadioButton</code>  默认的图标</li>
<li><code>android:background=&quot;@drawable/top_r_bg&quot;</code> 设置背景，实际上是一个 <code>selector</code></li>
<li><code>android:textColor=&quot;@drawable/top_r_text&quot;</code> 设置文字颜色，它也是一个 <code>selector</code></li>
<li>对于第二个 <code>RadioButton</code> ： <code>android:layout_marginLeft=&quot;-1dp&quot;</code> 和描边宽度一样，防止出现间隙</li>
</ul>
<p>下面把 xml 代码放在一起看，它们都放在 <code>drawable</code> 目录下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- drawable/top_r_bg --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">selector</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">item</span></span></div><div class="line"><span class="tag">        <span class="attr">android:drawable</span>=<span class="string">"@drawable/top_r_bg_a"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:state_checked</span>=<span class="string">"false"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">item</span></span></div><div class="line"><span class="tag">        <span class="attr">android:drawable</span>=<span class="string">"@drawable/top_r_bg_b"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:state_checked</span>=<span class="string">"true"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">selector</span>&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- drawable/top_r_bg_a --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">shape</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">corners</span></span></div><div class="line"><span class="tag">        <span class="attr">android:bottomLeftRadius</span>=<span class="string">"2dp"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:bottomRightRadius</span>=<span class="string">"0dp"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:topLeftRadius</span>=<span class="string">"2dp"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:topRightRadius</span>=<span class="string">"0dp"</span></span></div><div class="line"><span class="tag">        /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">stroke</span></span></div><div class="line"><span class="tag">        <span class="attr">android:width</span>=<span class="string">"1dp"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:color</span>=<span class="string">"@color/white"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">solid</span> <span class="attr">android:color</span>=<span class="string">"@color/transparent"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">shape</span>&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- drawable/top_r_bg_b --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">shape</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">corners</span></span></div><div class="line"><span class="tag">        <span class="attr">android:bottomLeftRadius</span>=<span class="string">"2dp"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:topLeftRadius</span>=<span class="string">"2dp"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">solid</span> <span class="attr">android:color</span>=<span class="string">"@color/white"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">shape</span>&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- drawable/top_r_text --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">selector</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:color</span>=<span class="string">"@color/white"</span> <span class="attr">android:state_checked</span>=<span class="string">"false"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:color</span>=<span class="string">"@color/title_bar"</span> <span class="attr">android:state_checked</span>=<span class="string">"true"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">selector</span>&gt;</span></div></pre></td></tr></table></figure>
<p>上面只贴出了左边按钮的样式，右边的类似，不再张贴。UI 到这里已经完成，下面看事件：</p>
<h3 id="实现联动事件"><a href="#实现联动事件" class="headerlink" title="实现联动事件"></a>实现联动事件</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">        List&lt;Fragment&gt; fragments = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        fragments.add(<span class="keyword">new</span> FragmentMain01A());</div><div class="line">        fragments.add(<span class="keyword">new</span> FragmentMain01B());</div><div class="line"></div><div class="line">        NotePagerAdapter pagerAdapter = <span class="keyword">new</span> NotePagerAdapter(getFragmentManager(), fragments);</div><div class="line">        mainViewpager.setAdapter(pagerAdapter);</div><div class="line">  <span class="comment">/**</span></div><div class="line"><span class="comment">   * 为 Viewpager 设置页面切换监听，当页面切换完成被选中时，我们同步 RadioButton 的状态</span></div><div class="line"><span class="comment">   **/</span></div><div class="line">        mainViewpager.addOnPageChangeListener(<span class="keyword">new</span> ViewPager.OnPageChangeListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPageScrolled</span><span class="params">(<span class="keyword">int</span> position, <span class="keyword">float</span> positionOffset, <span class="keyword">int</span> positionOffsetPixels)</span> </span>&#123;</div><div class="line"></div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPageSelected</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line">                <span class="keyword">if</span> (position == <span class="number">0</span>) radioButtonA.setChecked(<span class="keyword">true</span>);</div><div class="line">                <span class="keyword">else</span> radioButtonB.setChecked(<span class="keyword">true</span>);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPageScrollStateChanged</span><span class="params">(<span class="keyword">int</span> state)</span> </span>&#123;</div><div class="line"></div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">  <span class="comment">/**</span></div><div class="line"><span class="comment">   * 为 RadioGroup 设置选中变化事件监听，当 RadioButton 状态变化，我们同步 Viewpager 的选中页面</span></div><div class="line"><span class="comment">   **/</span></div><div class="line">        mRadioGroup.setOnCheckedChangeListener(<span class="keyword">new</span> RadioGroup.OnCheckedChangeListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCheckedChanged</span><span class="params">(RadioGroup group, <span class="keyword">int</span> checkedId)</span> </span>&#123;</div><div class="line">                <span class="keyword">if</span> (checkedId == radioButtonA.getId()) mainViewpager.setCurrentItem(<span class="number">0</span>);</div><div class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (checkedId == radioButtonB.getId()) mainViewpager.setCurrentItem(<span class="number">1</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line"></div><div class="line">        <span class="comment">//设置默认选中页</span></div><div class="line">        mainViewpager.setCurrentItem(<span class="number">0</span>);</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>对了，还有 <code>NotePagerAdapter</code> 的代码，这个比较简单，是 <code>ViewPager</code> 和 <code>Fragment</code> 的适配器：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NotePagerAdapter</span> <span class="keyword">extends</span> <span class="title">FragmentStatePagerAdapter</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> List&lt;Fragment&gt; mFragments;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span>  <span class="title">NotePagerAdapter</span><span class="params">(FragmentManager fm, List&lt;Fragment&gt; fragments)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(fm);</div><div class="line">        mFragments = fragments;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mFragments.size();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Fragment <span class="title">getItem</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mFragments.get(position);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>注意，以上代码使用的是 <code>android.support.v4</code> 包的类，理论上不使用 <code>V4</code> 包是没问题的。</p>
<p>看完整体的代码发现并没什么难点，纯属基础知识的叠加，主要是 UI 控件上的细节需要处理的比较多。</p>
<p>再者，如果顶部的控件超过2个，还需要更多的 xml 文件，顶部的几个控件是可以封装成一个自定义 View 的，甚至加上中间的 <code>ViewPager</code> 一起封装。等待我后面的成果吧。如果有什么疑问或建议，可以通过文末的联系方式和我交流。</p>
<p>最后，纪念一下自己今天正式成为 <code>CSDN博客专家</code> ，祝愿广大程序员都能在编程的路上有所成就！</p>
<p><strong>PS</strong>：你可以通过下面的方式和我联系</p>
<blockquote>
<ul>
<li>微博：<a href="http://weibo.com/zyansen" target="_blank" rel="external">cafeting</a></li>
<li>Github： <a href="https://github.com/likfe" target="_blank" rel="external">likfe</a></li>
<li>CSDN：<a href="http://blog.csdn.net/ys743276112" target="_blank" rel="external">他叫自己Mr.张</a> </li>
</ul>
</blockquote>
]]></content>
      
        
        <tags>
            
            <tag> Android </tag>
            
            <tag> ViewPager </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android 必知必会 - 动态切换着色模式和全屏模式]]></title>
      <url>/2016/09/19/android-dynamic-set-statusBar/</url>
      <content type="html"><![CDATA[<p>通过代码动态切换页面的<strong>着色模式</strong>和<strong>全屏模式</strong>，兼容 <code>Android 4.4 +</code> 。</p>
<p>本文假设读者已经了解着色模式和全屏模式（沉浸模式）。</p>
<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>公司的 APP 设计图仅有 iOS 版的，对于 Android 平台，它整体算是着色模式，但是在个人页面是全屏模式（沉浸模式），实现设计图时，我使用的是一个 <code>Activity</code> + 四个 <code>Fragment</code> 实现的。</p>
<a id="more"></a>
<p>下面直接上效果图：</p>
<table>
<thead>
<tr>
<th style="text-align:center">iOS 效果图</th>
<th style="text-align:center">Android 4.4 +</th>
<th style="text-align:center">Android 5.0 +</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><img src="http://mmmedia.qiniudn.com/2016-09-19-ios.gif" alt=""></td>
<td style="text-align:center"><img src="http://mmmedia.qiniudn.com/2016-09-19-android_4.4.gif" alt=""></td>
<td style="text-align:center"><img src="http://mmmedia.qiniudn.com/2016-09-19-android_5.x.gif" alt=""></td>
</tr>
</tbody>
</table>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p>从 <code>Android 4.4</code> 起，Window 新增了  <code>WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS</code> 的 Flag ，而从 <code>Android 5.0</code> 起，Window 又新增了 <code>setStatusBarColor()</code> 方法，可以直接修改状态栏的颜色。</p>
<h3 id="对于-Android-4-4-gt-4-4-且-lt-5-0"><a href="#对于-Android-4-4-gt-4-4-且-lt-5-0" class="headerlink" title="对于 Android 4.4 + ( &gt;= 4.4 且 &lt; 5.0 )"></a>对于 Android 4.4 + ( &gt;= 4.4 且 &lt; 5.0 )</h3><p>这种情况下，我们启用 4.4 新增的半透明状态栏，通过修改当前 Activity 的<strong>根布局</strong>的 <code>background</code> 和 <code>paddingTop</code> 来动态切换『着色模式』和全屏模式。</p>
<p>实际上，这种情况下的『着色模式』是在全屏模式下模拟出来的，并不是真正意义上的着色模式。</p>
<p><strong>着色模式：</strong></p>
<ul>
<li><code>android:background=&quot;@color/title_bar&quot;</code></li>
<li><code>paddingTop = statusHeight</code></li>
</ul>
<p><strong>全屏模式：</strong></p>
<ul>
<li><code>paddingTop = 0</code></li>
</ul>
<h3 id="对于-Android-5-0-gt-5-0"><a href="#对于-Android-5-0-gt-5-0" class="headerlink" title="对于 Android 5.0 + ( &gt;= 5.0 )"></a>对于 Android 5.0 + ( &gt;= 5.0 )</h3><p>这种情况下，我们修改Window 对应的 Flag，然后直接设置状态栏的颜色即可。</p>
<p><strong>全屏模式：</strong></p>
<ul>
<li><code>window.clearFlags(WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS);</code></li>
<li><code>window.setStatusBarColor(Color.TRANSPARENT);</code></li>
</ul>
<p><strong>着色模式：</strong></p>
<ul>
<li><code>window.setStatusBarColor(getResources().getColor(R.color.title_bar));</code></li>
<li><code>window.addFlags(WindowManager.LayoutParams.FLAG_DRAWS_SYSTEM_BAR_BACKGROUNDS);</code></li>
</ul>
<h3 id="关键代码"><a href="#关键代码" class="headerlink" title="关键代码"></a>关键代码</h3><blockquote>
<p>activity_main.xml</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">LinearLayout</span></span></div><div class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:background</span>=<span class="string">"@color/title_bar"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></span></div><div class="line"><span class="tag">    &gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">FrameLayout</span></span></div><div class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/main_fl"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"0dp"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_weight</span>=<span class="string">"1"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:background</span>=<span class="string">"@color/white"</span></span></div><div class="line"><span class="tag">        /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></div><div class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/main_bottom"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"50dp"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:background</span>=<span class="string">"@color/white"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:clickable</span>=<span class="string">"false"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:orientation</span>=<span class="string">"horizontal"</span></span></div><div class="line"><span class="tag">        &gt;</span></div><div class="line">	<span class="comment">&lt;!-- ...... 四个 ImageView  --&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<blockquote>
<p>MainActivity.java</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//响应底部对应的 ImageView 被点击的事件，i 为 0-3</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setSelect</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</div><div class="line">        resetBg();<span class="comment">//重置背景</span></div><div class="line">        FragmentManager fm = getSupportFragmentManager();</div><div class="line">        FragmentTransaction ft = fm.beginTransaction();</div><div class="line">        hideFragment(ft);<span class="comment">//隐藏已经显示的 Fragment</span></div><div class="line">        <span class="keyword">switch</span> (i) &#123;</div><div class="line">            <span class="keyword">case</span> <span class="number">0</span>:</div><div class="line">                setStatusBar(<span class="keyword">false</span>);<span class="comment">//着色模式</span></div><div class="line">                <span class="comment">//... 显示 Fragment_a</span></div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> <span class="number">1</span>:</div><div class="line">                setStatusBar(<span class="keyword">false</span>);<span class="comment">//着色模式</span></div><div class="line">                <span class="comment">//... 显示 Fragment_b</span></div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> <span class="number">2</span>:</div><div class="line">                setStatusBar(<span class="keyword">false</span>);<span class="comment">//着色模式</span></div><div class="line">                <span class="comment">//... 显示 Fragment_c</span></div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> <span class="number">3</span>:</div><div class="line">                setStatusBar(<span class="keyword">true</span>);<span class="comment">//全屏模式</span></div><div class="line">                <span class="comment">//... 显示 Fragment_d</span></div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        ft.commit();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//修改当前 Activity 的显示模式，hideStatusBarBackground :true 全屏模式，false 着色模式</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setStatusBar</span><span class="params">(<span class="keyword">boolean</span> hideStatusBarBackground)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.KITKAT &amp;&amp; Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.LOLLIPOP) &#123;</div><div class="line">            Window window = getWindow();</div><div class="line">            window.addFlags(WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS);</div><div class="line">            <span class="keyword">if</span> (hideStatusBarBackground) &#123;</div><div class="line">                window.getDecorView().setSystemUiVisibility(View.SYSTEM_UI_FLAG_LAYOUT_STABLE | View.SYSTEM_UI_FLAG_LAYOUT_FULLSCREEN);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                window.getDecorView().setSystemUiVisibility(View.SYSTEM_UI_FLAG_VISIBLE);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            ViewGroup mContentView = (ViewGroup) window.findViewById(Window.ID_ANDROID_CONTENT);</div><div class="line">            View mChildView = mContentView.getChildAt(<span class="number">0</span>);</div><div class="line">            <span class="keyword">if</span> (mChildView != <span class="keyword">null</span>) &#123;</div><div class="line">                <span class="keyword">if</span> (hideStatusBarBackground) &#123;</div><div class="line">                    mChildView.setPadding(</div><div class="line">                            mChildView.getPaddingLeft(),</div><div class="line">                            <span class="number">0</span>,</div><div class="line">                            mChildView.getPaddingRight(),</div><div class="line">                            mChildView.getPaddingBottom()</div><div class="line">                    );</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    <span class="keyword">int</span> statusHeight = getStatusBarHeight(<span class="keyword">this</span>);</div><div class="line">                    mChildView.setPadding(</div><div class="line">                            mChildView.getPaddingLeft(),</div><div class="line">                            statusHeight,</div><div class="line">                            mChildView.getPaddingRight(),</div><div class="line">                            mChildView.getPaddingBottom()</div><div class="line">                    );</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) &#123;</div><div class="line">            Window window = getWindow();</div><div class="line"></div><div class="line">            window.addFlags(WindowManager.LayoutParams.FLAG_DRAWS_SYSTEM_BAR_BACKGROUNDS);</div><div class="line">            <span class="keyword">if</span> (hideStatusBarBackground) &#123;</div><div class="line">                window.clearFlags(WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS);</div><div class="line">                window.setStatusBarColor(Color.TRANSPARENT);</div><div class="line">                window.getDecorView().setSystemUiVisibility(View.SYSTEM_UI_FLAG_LAYOUT_STABLE | View.SYSTEM_UI_FLAG_LAYOUT_FULLSCREEN);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                window.setStatusBarColor(getResources().getColor(R.color.title_bar));</div><div class="line">                window.addFlags(WindowManager.LayoutParams.FLAG_DRAWS_SYSTEM_BAR_BACKGROUNDS);</div><div class="line">                window.getDecorView().setSystemUiVisibility(View.SYSTEM_UI_FLAG_VISIBLE);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"><span class="comment">//get StatusBar Height</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getStatusBarHeight</span><span class="params">(Activity activity)</span> </span>&#123;</div><div class="line">        Rect frame = <span class="keyword">new</span> Rect();</div><div class="line">         activity.getWindow().getDecorView().getWindowVisibleDisplayFrame(frame);</div><div class="line">        <span class="keyword">return</span> frame.top;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="总结和回顾"><a href="#总结和回顾" class="headerlink" title="总结和回顾"></a>总结和回顾</h2><p>对于 Android 5.0 + ( &gt;= 5.0 ) 的情况很容易懂，毕竟可以直接设置状态栏的颜色。对于 Android 4.4 + ( &gt;= 4.4 且 &lt; 5.0 ) 的情况，我这里并没有使用网上一些教程：向 DecorView 中添加一个高度为状态栏的高度 View，也就没有黑线的问题，而是通过修改根布局的背景色和根布局的 PaddingTop 来<strong>模拟</strong>着色模式。</p>
<p>注意，<strong>本实验仅针对一个 Activity 包含多个 Fragment 且需要动态修改显示模式的情况</strong>。操作过程中页面并没有配合使用 ActionBar ，使用的主题是 <code>Theme.AppCompat.Light.NoActionBar</code> ，不确定是否会有意想不到的效果，请在配合 ActionBar 时先进行测试或者参考文末的相关资料。</p>
<p>如果有什么问题或建议，欢迎和我交流。</p>
<p>相关资料：</p>
<ul>
<li><a href="http://niorgai.github.io/2016/03/20/Android-transulcent-status-bar/" target="_blank" rel="external">Android-transulcent-status-bar</a></li>
<li><a href="http://www.jianshu.com/p/140be70b84cd?utm_source=tuicool&amp;utm_medium=referral" target="_blank" rel="external">由沉浸式状态栏引发的血案</a></li>
</ul>
<p><strong>PS</strong>：你可以通过下面的方式和我联系</p>
<blockquote>
<ul>
<li>微博：<a href="http://weibo.com/zyansen" target="_blank" rel="external">cafeting</a></li>
<li>Github： <a href="https://github.com/likfe" target="_blank" rel="external">likfe</a></li>
<li>CSDN：<a href="http://blog.csdn.net/ys743276112" target="_blank" rel="external">他叫自己Mr.张</a> </li>
</ul>
</blockquote>
]]></content>
      
        
        <tags>
            
            <tag> Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android 必知必会 - Glide 加载圆形和圆角图片的两种方法]]></title>
      <url>/2016/08/31/android-glide-roundedBitmapTransformation/</url>
      <content type="html"><![CDATA[<p>两种使用 <code>BitmapTransformation</code> 来实现<code>Glide</code> 加载圆形图片和圆角图片的方法。</p>
<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p><code>Glide</code> 并不能直接支持 <code>Round Pictures</code> ，需要使用 <code>BitmapTransformation</code> 来进行处理。</p>
<blockquote>
<p>Round Pictures: <code>CircleImageView</code> / <code>CircularImageView</code> / <code>RoundedImageView</code> are known to have <a href="https://github.com/bumptech/glide/issues?q=is%3Aissue+CircleImageView+OR+CircularImageView+OR+RoundedImageView" target="_blank" rel="external">issues</a> with TransitionDrawable (.crossFade() with .thumbnail() or .placeholder()) and animated GIFs, use a BitmapTransformation (.circleCrop() will be available in v4) or .dontAnimate() to fix the issue.</p>
</blockquote>
<p>这里介绍下网上常见的方式和使用 <code>RoundedBitmapDrawable</code> 两种方法，本质上是差不多的：</p>
<ul>
<li>使用 <code>Canvas</code> 和 <code>Paint</code> 来绘制</li>
<li>使用 <code>Android.support.v4.graphics.drawable.RoundedBitmapDrawable</code> </li>
</ul>
<p><strong>PS：</strong> <code>RoundedBitmapDrawable</code> 是 <code>support.v4</code> 下的一个类，想了解更多，可以阅读我之前的文章：<a href="http://blog.csdn.net/ys743276112/article/details/52316588" target="_blank" rel="external">Android 必知必会-使用 supportV4 的 RoundedBitmapDrawable 实现圆角</a> 。</p>
<a id="more"></a>
<h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><h3 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h3><p>实现圆形图片：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Glide 圆形图片 Transform</span></div><div class="line"><span class="comment"> */</span></div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlideCircleTransform</span> <span class="keyword">extends</span> <span class="title">BitmapTransformation</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GlideCircleTransform</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> Bitmap <span class="title">transform</span><span class="params">(BitmapPool pool, Bitmap toTransform, <span class="keyword">int</span> outWidth, <span class="keyword">int</span> outHeight)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> circleCrop(pool, toTransform);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Bitmap <span class="title">circleCrop</span><span class="params">(BitmapPool pool, Bitmap source)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (source == <span class="keyword">null</span>) <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">int</span> size = Math.min(source.getWidth(), source.getHeight());</div><div class="line">        <span class="keyword">int</span> x = (source.getWidth() - size) / <span class="number">2</span>;</div><div class="line">        <span class="keyword">int</span> y = (source.getHeight() - size) / <span class="number">2</span>;</div><div class="line">        Bitmap squared = Bitmap.createBitmap(source, x, y, size, size);</div><div class="line">        Bitmap result = pool.get(size, size, Bitmap.Config.ARGB_8888);</div><div class="line">        <span class="keyword">if</span> (result == <span class="keyword">null</span>) &#123;</div><div class="line">            result = Bitmap.createBitmap(size, size, Bitmap.Config.ARGB_8888);</div><div class="line">        &#125;</div><div class="line">        Canvas canvas = <span class="keyword">new</span> Canvas(result);</div><div class="line">        Paint paint = <span class="keyword">new</span> Paint();</div><div class="line">        paint.setShader(<span class="keyword">new</span> BitmapShader(squared, BitmapShader.TileMode.CLAMP, BitmapShader.TileMode.CLAMP));</div><div class="line">        paint.setAntiAlias(<span class="keyword">true</span>);</div><div class="line">        <span class="keyword">float</span> r = size / <span class="number">2f</span>;</div><div class="line">        canvas.drawCircle(r, r, r, paint);</div><div class="line">        <span class="keyword">return</span> result;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getId</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> getClass().getName();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>实现圆角图片：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Glide 圆角 Transform</span></div><div class="line"><span class="comment"> */</span></div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlideRoundTransform</span> <span class="keyword">extends</span> <span class="title">BitmapTransformation</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">float</span> radius = <span class="number">0f</span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 构造函数 默认圆角半径 4dp</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> context Context</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GlideRoundTransform</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>(context, <span class="number">4</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 构造函数</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> context Context</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> dp      圆角半径</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GlideRoundTransform</span><span class="params">(Context context, <span class="keyword">int</span> dp)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context);</div><div class="line">        radius = Resources.getSystem().getDisplayMetrics().density * dp;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> Bitmap <span class="title">transform</span><span class="params">(BitmapPool pool, Bitmap toTransform, <span class="keyword">int</span> outWidth, <span class="keyword">int</span> outHeight)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> roundCrop(pool, toTransform);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Bitmap <span class="title">roundCrop</span><span class="params">(BitmapPool pool, Bitmap source)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (source == <span class="keyword">null</span>) <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line"></div><div class="line">        Bitmap result = pool.get(source.getWidth(), source.getHeight(), Bitmap.Config.ARGB_8888);</div><div class="line">        <span class="keyword">if</span> (result == <span class="keyword">null</span>) &#123;</div><div class="line">            result = Bitmap.createBitmap(source.getWidth(), source.getHeight(), Bitmap.Config.ARGB_8888);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        Canvas canvas = <span class="keyword">new</span> Canvas(result);</div><div class="line">        Paint paint = <span class="keyword">new</span> Paint();</div><div class="line">        paint.setShader(<span class="keyword">new</span> BitmapShader(source, BitmapShader.TileMode.CLAMP, BitmapShader.TileMode.CLAMP));</div><div class="line">        paint.setAntiAlias(<span class="keyword">true</span>);</div><div class="line">        RectF rectF = <span class="keyword">new</span> RectF(<span class="number">0f</span>, <span class="number">0f</span>, source.getWidth(), source.getHeight());</div><div class="line">        canvas.drawRoundRect(rectF, radius, radius, paint);</div><div class="line">        <span class="keyword">return</span> result;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getId</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> getClass().getName() + Math.round(radius);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Bitmap <span class="title">drawableToBitmap</span><span class="params">(Drawable drawable)</span> </span>&#123;</div><div class="line">        <span class="comment">// 取 drawable 的长宽</span></div><div class="line">        <span class="keyword">int</span> w = drawable.getIntrinsicWidth();</div><div class="line">        <span class="keyword">int</span> h = drawable.getIntrinsicHeight();</div><div class="line"></div><div class="line">        <span class="comment">// 取 drawable 的颜色格式</span></div><div class="line">        Bitmap.Config config = drawable.getOpacity() != PixelFormat.OPAQUE ? Bitmap.Config.ARGB_8888</div><div class="line">                : Bitmap.Config.RGB_565;</div><div class="line">        <span class="comment">// 建立对应 bitmap</span></div><div class="line">        Bitmap bitmap = Bitmap.createBitmap(w, h, config);</div><div class="line">        <span class="comment">// 建立对应 bitmap 的画布</span></div><div class="line">        Canvas canvas = <span class="keyword">new</span> Canvas(bitmap);</div><div class="line">        drawable.setBounds(<span class="number">0</span>, <span class="number">0</span>, w, h);</div><div class="line">        <span class="comment">// 把 drawable 内容画到画布中</span></div><div class="line">        drawable.draw(canvas);</div><div class="line">        <span class="keyword">return</span> bitmap;</div><div class="line">    &#125;</div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment">  * RoundedBitmapDrawable 是 V4 下的一个类，不能简单的通过：强制转换成 BitmapDrawable 来获取 bitmap</span></div><div class="line"><span class="comment">  * Bitmap bitmap = ((BitmapDrawable)xxx).getBitmap();</span></div><div class="line"><span class="comment">  */</span></div></pre></td></tr></table></figure>
<p>实现圆形：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">RoundedBitmapDrawable drawableA = RoundedBitmapDrawableFactory.create(getResources(), bitmap);</div><div class="line">        drawableA.setCircular(<span class="keyword">true</span>);</div><div class="line">        Bitmap a = drawableToBitmap(drawableA);</div></pre></td></tr></table></figure>
<p>实现圆角：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">RoundedBitmapDrawable drawableB = RoundedBitmapDrawableFactory.create(getResources(), bitmap);</div><div class="line">       drawableB.setCornerRadius(<span class="number">30L</span>);</div><div class="line">       Bitmap b = drawableToBitmap(drawableB);</div></pre></td></tr></table></figure>
]]></content>
      
        
        <tags>
            
            <tag> Android </tag>
            
            <tag> Glide </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android 必知必会 - 极简版 Leancloud 短信验证码功能]]></title>
      <url>/2016/08/29/android-simple-leancloud-sms/</url>
      <content type="html"><![CDATA[<p>使用 LeanCloud 的 REST API 来自定义短信验证码相关功能，不再需要臃肿的 SDK 。</p>
<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>公司的项目仅仅使用了 Leancloud 短信功能来发送验证码，刚开始 Leancloud 的短信 SDK 还会和项目中的 <code>okhttp</code> 、<code>fastjson</code> 产生冲突，后来使用了独立的命名空间解决了冲突，但这样处理会导致项目中产生大量的冗余库。在仅仅使用短信验证码功能 SDK 的情况下会有下列文件被引入到项目中：</p>
<ul>
<li><code>avoscloud-sdk-v3.13.8.jar</code></li>
<li><code>fastjson-1.1.39-leancloud.jar</code></li>
<li><code>okhttp-2.6.0-leancloud.jar</code></li>
<li><code>okio-1.6.0-leancloud.jar</code></li>
</ul>
<p>本来开发 Android 时，大家都尽量避免触碰 <code>64K</code> 个方法的限制，对于发验证码这样一个简单的事情，还需要引入大量的第三方库实在是难以接受。</p>
<p>在目前开发的新项目中，我尽量控制第三方库的筛选和使用，不想引起启用 <code>Multidex</code> 导致应用启动慢的问题。直到我发现 Leancloud 的 <code>REST API</code> ，顿时觉得里面有搞头，对，<strong>大有搞头</strong>。</p>
<a id="more"></a>
<h2 id="搞点事情"><a href="#搞点事情" class="headerlink" title="搞点事情"></a>搞点事情</h2><p>首先贴下文档地址：<a href="https://leancloud.cn/docs/rest_sms_api.html" target="_blank" rel="external">短信服务 REST API 详解</a> ，建议先进行初步阅读了解基础概念。</p>
<p><code>REST API</code> 是请求接口，与具体的语言无关，这里仅仅演示 Android 下使用 Java 语言的一个实现。</p>
<p>项目中使用的是 <code>okhttp-3.4.1</code> 和 <code>gson-2.7</code> ，当然你也可以使用其他网络请求库和<code>JSON</code> 解析库。下面上关键代码：</p>
<blockquote>
<p>OkHttpUtil</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Constants.APP_KEY 和 Constants.APP_ID 在 LeanCloud 控制台获取</span></div><div class="line"><span class="comment">// String MD5Util.string2MD5(String s); 进行 MD5 加密的一个方法。</span></div><div class="line"><span class="comment">// 项目使用了 Logger 日志库，没使用的话请自行删除相关代码...</span></div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OkHttpUtil</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> OkHttpUtil OkHttpUtil = <span class="keyword">new</span> OkHttpUtil();</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> OkHttpClient client;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> OkHttpUtil <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</div><div class="line">        client = <span class="keyword">new</span> OkHttpClient().newBuilder().build();</div><div class="line">        <span class="keyword">return</span> OkHttpUtil;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> Boolean <span class="title">postJson</span><span class="params">(String target, String json)</span> </span>&#123;</div><div class="line">        MediaType JSON = MediaType.parse(<span class="string">"application/json; charset=utf-8"</span>);</div><div class="line">        RequestBody requestBody = RequestBody.create(JSON, json);</div><div class="line">        <span class="keyword">long</span> timestamp = System.currentTimeMillis();</div><div class="line">        String sign = MD5Util.string2MD5(timestamp + Constants.APP_KEY);</div><div class="line">        Request request = <span class="keyword">new</span> Request.Builder()</div><div class="line">                .addHeader(<span class="string">"X-LC-Id"</span>, Constants.APP_ID)</div><div class="line">                .addHeader(<span class="string">"X-LC-Sign"</span>, sign + <span class="string">","</span> + timestamp)</div><div class="line">                .url(target)</div><div class="line">                .post(requestBody)</div><div class="line">                .build();</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            Response response = client.newCall(request).execute();</div><div class="line">            <span class="comment">//判断请求是否成功</span></div><div class="line">            <span class="keyword">if</span> (response.isSuccessful()) &#123;</div><div class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                Logger.e(response.body().string());</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">            Logger.e(e.toString());</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>LoginActivity</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment">    * 发送短信验证码</span></div><div class="line"><span class="comment">    * params : mobilePhoneNumber</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">SendCodeTask</span> <span class="keyword">extends</span> <span class="title">AsyncTask</span>&lt;<span class="title">String</span>, <span class="title">Void</span>, <span class="title">Boolean</span>&gt; </span>&#123;</div><div class="line">       <span class="meta">@Override</span></div><div class="line">       <span class="function"><span class="keyword">protected</span> Boolean <span class="title">doInBackground</span><span class="params">(String... params)</span> </span>&#123;</div><div class="line">         <span class="comment">//ttl后面的值是短信有效时间(分钟)</span></div><div class="line">           String json = <span class="string">"&#123;\"mobilePhoneNumber\":\"&#123;0&#125;\",\"ttl\":10,\"name\":\"注册\"&#125;"</span>;</div><div class="line">           json = json.replace(<span class="string">"&#123;0&#125;"</span>, phone);</div><div class="line">           <span class="keyword">return</span> okHttpUtil.postJson(<span class="string">"https://api.leancloud.cn/1.1/requestSmsCode"</span>, json);</div><div class="line">       &#125;</div><div class="line"></div><div class="line">       <span class="meta">@Override</span></div><div class="line">       <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onPostExecute</span><span class="params">(Boolean s)</span> </span>&#123;</div><div class="line">           <span class="keyword">super</span>.onPostExecute(s);</div><div class="line">           <span class="keyword">if</span> (s) &#123;</div><div class="line">             Toast.makeText(LoginActivity.<span class="keyword">this</span>,<span class="string">"验证码发送成功"</span>,Toast.LENGTH_SHORT).show();</div><div class="line">           &#125; <span class="keyword">else</span> Toast.makeText(LoginActivity.<span class="keyword">this</span>, <span class="string">"验证码发送失败"</span>,Toast.LENGTH_SHORT).show();</div><div class="line">       &#125;</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   <span class="comment">/**</span></div><div class="line"><span class="comment">    * 验证短信验证码</span></div><div class="line"><span class="comment">    * params : mobilePhoneNumber , smsCode</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">VerifySmsCode</span> <span class="keyword">extends</span> <span class="title">AsyncTask</span>&lt;<span class="title">String</span>, <span class="title">Void</span>, <span class="title">Boolean</span>&gt; </span>&#123;</div><div class="line">       <span class="meta">@Override</span></div><div class="line">       <span class="function"><span class="keyword">protected</span> Boolean <span class="title">doInBackground</span><span class="params">(String... params)</span> </span>&#123;</div><div class="line">           String json = <span class="string">"&#123;\"mobilePhoneNumber\":\"&#123;0&#125;\"&#125;"</span>;</div><div class="line">           json = json.replace(<span class="string">"&#123;0&#125;"</span>, params[<span class="number">0</span>]);</div><div class="line">           <span class="keyword">return</span> okHttpUtil.postJson(<span class="string">"https://api.leancloud.cn/1.1/verifySmsCode/"</span> + params[<span class="number">1</span>], json);</div><div class="line">       &#125;</div><div class="line"></div><div class="line">       <span class="meta">@Override</span></div><div class="line">       <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onPostExecute</span><span class="params">(Boolean aBoolean)</span> </span>&#123;</div><div class="line">           <span class="keyword">super</span>.onPostExecute(aBoolean);</div><div class="line">           <span class="keyword">if</span> &#123;</div><div class="line">             <span class="comment">//do something</span></div><div class="line">           &#125;</div><div class="line">           <span class="keyword">else</span> Toast.makeText(LoginActivity.<span class="keyword">this</span>, <span class="string">"验证码不匹配"</span>,Toast.LENGTH_SHORT).show();</div><div class="line">       &#125;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>自己动手，丰衣足食啊。</p>
<p>顺便吐槽下：国内的很多第三方 SDK 封装的时候，基本上没怎么考虑使用者项目中已经使用了什么类库。对于大部分常见的类库（图片加载库，网络请求库等）进行进一步的抽象，可以大大减少开发者的负担。</p>
<p>如果你不明白我的意思，可以看看 <a href="https://github.com/ddwhan0123/GalleryFinal/" target="_blank" rel="external">GalleryFinal</a> 这个开源图片选择器对于图片加载库的封装，使得它可以适应多种图片加载库而不需要你修改项目中已有的图片库。</p>
<p>如果你有更好的或者其他想法，欢迎和我交流。</p>
<p><strong>PS</strong>：你可以通过下面的方式和我联系</p>
<blockquote>
<ul>
<li>微博：<a href="http://weibo.com/zyansen" target="_blank" rel="external">cafeting</a></li>
<li>Github： <a href="https://github.com/likfe" target="_blank" rel="external">likfe</a></li>
<li>CSDN：<a href="http://blog.csdn.net/ys743276112" target="_blank" rel="external">他叫自己Mr.张</a> </li>
</ul>
</blockquote>
]]></content>
      
        
        <tags>
            
            <tag> Android </tag>
            
            <tag> Leancloud </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android 必知必会-使用 supportV4 的 RoundedBitmapDrawable 实现圆角]]></title>
      <url>/2016/08/25/use-supportv4-RoundedBitmapDrawable/</url>
      <content type="html"><![CDATA[<p><code>RoundedBitmapDrawable</code> 是 <code>supportV4</code> 下的一个类，有了它，显示圆角和圆形图片的情况下就不需要额外的第三方类库了，还能和各种图片加载库配合使用。</p>
<a id="more"></a>
<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>今天无意间看到一段实现圆形头像的代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">RoundedBitmapDrawable drawable = RoundedBitmapDrawableFactory.create(getResources(), bitmap);</div><div class="line">drawable.setCircular(<span class="keyword">true</span>);</div></pre></td></tr></table></figure>
<p><code>RoundedBitmapDrawable</code> 这个类顿时就引起我的好奇了，一查发现是 <code>android.support.v4.graphics.drawable.RoundedBitmapDrawable</code> ，<a href="http://developer.android.youdaxue.com/reference/android/support/v4/graphics/drawable/RoundedBitmapDrawable.html?_ga=1.118511817.1571171213.1463032326" target="_blank" rel="external">点击此处</a> 可以看到官方的介绍。这个类中的两个方法是今天的主角：</p>
<table>
<thead>
<tr>
<th style="text-align:center">return</th>
<th style="text-align:center">method</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">void</td>
<td style="text-align:center"><code>setCircular(boolean circular)</code> : Sets the image shape to circular.</td>
</tr>
<tr>
<td style="text-align:center">void</td>
<td style="text-align:center"><code>setCornerRadius(float cornerRadius)</code> : Sets the corner radius to be applied when drawing the bitmap.</td>
</tr>
</tbody>
</table>
<p><code>setCircular(boolean circular)</code> : 把图片的形状设为圆形；</p>
<p><code>setCornerRadius(float cornerRadius)</code> : 设置图片的圆角半径。</p>
<p>这里贴一下源码，更能清晰的知道它的实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment">    * Sets the image shape to circular.</span></div><div class="line"><span class="comment">    * &lt;p&gt;This overwrites any calls made to &#123;<span class="doctag">@link</span> #setCornerRadius(float)&#125; so far.&lt;/p&gt;</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCircular</span><span class="params">(<span class="keyword">boolean</span> circular)</span> </span>&#123;</div><div class="line">       mIsCircular = circular;</div><div class="line">       mApplyGravity = <span class="keyword">true</span>;</div><div class="line">       <span class="keyword">if</span> (circular) &#123;</div><div class="line">           updateCircularCornerRadius();</div><div class="line">           mPaint.setShader(mBitmapShader);</div><div class="line">           invalidateSelf();</div><div class="line">       &#125; <span class="keyword">else</span> &#123;</div><div class="line">           setCornerRadius(<span class="number">0</span>);</div><div class="line">       &#125;</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">updateCircularCornerRadius</span><span class="params">()</span> </span>&#123;</div><div class="line">       <span class="keyword">final</span> <span class="keyword">int</span> minCircularSize = Math.min(mBitmapHeight, mBitmapWidth);</div><div class="line">       mCornerRadius = minCircularSize / <span class="number">2</span>;</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   <span class="comment">/**</span></div><div class="line"><span class="comment">    * Sets the corner radius to be applied when drawing the bitmap.</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCornerRadius</span><span class="params">(<span class="keyword">float</span> cornerRadius)</span> </span>&#123;</div><div class="line">       <span class="keyword">if</span> (mCornerRadius == cornerRadius) <span class="keyword">return</span>;</div><div class="line"></div><div class="line">       mIsCircular = <span class="keyword">false</span>;</div><div class="line">       <span class="keyword">if</span> (isGreaterThanZero(cornerRadius)) &#123;</div><div class="line">           mPaint.setShader(mBitmapShader);</div><div class="line">       &#125; <span class="keyword">else</span> &#123;</div><div class="line">           mPaint.setShader(<span class="keyword">null</span>);</div><div class="line">       &#125;</div><div class="line"></div><div class="line">       mCornerRadius = cornerRadius;</div><div class="line">       invalidateSelf();</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>至于具体的实现，阅读源码发现官方使用了 <code>BitmapShader</code> 来实现的圆角。</p>
<p>如果你有兴趣研究，更多资料：</p>
<ul>
<li><a href="http://blog.csdn.net/lmj623565791/article/details/41967509" target="_blank" rel="external">Android BitmapShader 实战 实现圆形、圆角图片</a></li>
<li><a href="http://blog.csdn.net/aigestudio/article/details/41799811" target="_blank" rel="external">自定义控件其实很简单1/3</a></li>
</ul>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p>先看效果图：</p>
<p><img src="http://mmmedia.qiniudn.com/2016-08-25_08104B752A742F5F71AE7F16661CBA2A.jpg" alt="2016-08-25_08104B752A742F5F71AE7F16661CBA2A.jpg"></p>
<p>其中第一个图片是圆形，第二个和第三个图片设置了自定义大小的圆角。</p>
<blockquote>
<p>xxActivity</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">        RoundedBitmapDrawable drawableA = RoundedBitmapDrawableFactory.create(getResources(), id2Bitmap(<span class="keyword">this</span>, R.drawable.icon_avatar));</div><div class="line">        drawableA.setCircular(<span class="keyword">true</span>);</div><div class="line">        rbA.setImageDrawable(drawableA);</div><div class="line"></div><div class="line">        RoundedBitmapDrawable drawableB = RoundedBitmapDrawableFactory.create(getResources(), id2Bitmap(<span class="keyword">this</span>, R.drawable.icon_avatar));</div><div class="line">        drawableB.setCornerRadius(<span class="number">30L</span>);</div><div class="line">        rbB.setImageDrawable(drawableB);</div><div class="line"></div><div class="line">        RoundedBitmapDrawable drawableC = RoundedBitmapDrawableFactory.create(getResources(), id2Bitmap(<span class="keyword">this</span>, R.drawable.icon_avatar));</div><div class="line">        drawableC.setCornerRadius(<span class="number">60L</span>);</div><div class="line">        rbC.setImageDrawable(drawableC);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Bitmap <span class="title">id2Bitmap</span><span class="params">(Context context, <span class="keyword">int</span> id)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> BitmapFactory.decodeResource(context.getResources(), id);</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>activity_xx.xml</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span><span class="meta">?&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">LinearLayout</span></span></div><div class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:gravity</span>=<span class="string">"center_horizontal"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></span></div><div class="line"><span class="tag">    &gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">ImageView</span></span></div><div class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/rb_a"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></div><div class="line"><span class="tag">        /&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">ImageView</span></span></div><div class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/rb_b"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_marginTop</span>=<span class="string">"10dp"</span></span></div><div class="line"><span class="tag">        /&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">ImageView</span></span></div><div class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/rb_c"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_marginTop</span>=<span class="string">"10dp"</span></span></div><div class="line"><span class="tag">        /&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<p>代码比较简单，有什么问题欢迎随时和我联系。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>一个小小的发现，让我又少使用了一个第三方库，心情大好。另外在此过程中发现的 <code>BitmapShader</code>  是学习自定义 View 的一个不错的切入点，需要再研究研究。</p>
<p><strong>PS</strong>：你可以通过下面的方式和我联系</p>
<blockquote>
<ul>
<li>微博：<a href="http://weibo.com/zyansen" target="_blank" rel="external">cafeting</a></li>
<li>Github： <a href="https://github.com/likfe" target="_blank" rel="external">likfe</a></li>
<li>CSDN：<a href="http://blog.csdn.net/ys743276112" target="_blank" rel="external">他叫自己Mr.张</a> </li>
</ul>
</blockquote>
]]></content>
      
        
        <tags>
            
            <tag> Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android 项目开发填坑记 - 使用 MultiDex 解决 64K 限制]]></title>
      <url>/2016/08/17/android-multiDex/</url>
      <content type="html"><![CDATA[<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>Android 的 <code>classLoader</code> 在加载 APK 的时候限制了<code>class.dex</code> 包含的 Java 方法数，其总数不能超过65535（64K，<strong>不要再说成 65K</strong> 了，1K = 2^10 = 1024 , 64 * 1024 = 65535），Google 官方给出的解决方案是使用  <a href="https://developer.android.com/studio/build/multidex.html" target="_blank" rel="external">Multidex</a> 。</p>
<h2 id="启用-Multidex"><a href="#启用-Multidex" class="headerlink" title="启用 Multidex"></a>启用 Multidex</h2><p>基本要求：</p>
<ul>
<li>使用 Android Studio 开发工具</li>
<li>Android SDK Build Tools &gt;= 21.1</li>
<li>更新  Android Support Repository 到最新版本</li>
</ul>
<p>配置步骤：</p>
<ol>
<li>配置 Gradle build 来开启 multidex</li>
<li>修改 manifest 来引用 MultiDexApplication 类</li>
</ol>
<a id="more"></a>
<p>修改 <code>module</code> 下的 <code>build.gradle</code> 文件，添加支持库并开启 multidex：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">android &#123;</div><div class="line">    compileSdkVersion <span class="number">21</span></div><div class="line">    buildToolsVersion <span class="string">"21.1.0"</span></div><div class="line"></div><div class="line">    defaultConfig &#123;</div><div class="line">        ...</div><div class="line">        minSdkVersion <span class="number">14</span></div><div class="line">        targetSdkVersion <span class="number">21</span></div><div class="line">        ...</div><div class="line"></div><div class="line">        <span class="comment">// Enabling multidex support.</span></div><div class="line">        multiDexEnabled <span class="literal">true</span></div><div class="line">    &#125;</div><div class="line">    ...</div><div class="line">&#125;</div><div class="line"></div><div class="line">dependencies &#123;</div><div class="line">  compile <span class="string">'com.android.support:multidex:1.0.0'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>PS： compileSdkVersion、buildToolsVersion 根据实际项目配置，但是版本不能低于上述版本。</p>
<p>在 <code>AndroidManifest.xml</code> 中给 <code>application</code> 节点添加对 <code>MultiDexApplication</code> 类的引用：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line"><span class="tag">    <span class="attr">package</span>=<span class="string">"xxx"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">application</span></span></div><div class="line"><span class="tag">        <span class="attr">...</span></span></div><div class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">"android.support.multidex.MultiDexApplication"</span>&gt;</span></div><div class="line">        ...</div><div class="line">    <span class="tag">&lt;/<span class="name">application</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></div></pre></td></tr></table></figure>
<p>PS： <code>manifest</code> 节点的 <code>package</code> 属性值根据实际项目有所不同。</p>
<p><strong>注意</strong>：如果你的 APP 使用了继承 <code>Application</code> 的类，你需要重写<code>attachBaseContext()</code>方法并调用 <code>MultiDex.install(this)</code> 来启用 multidex 。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">XXX</span> <span class="keyword">extends</span> <span class="title">Application</span></span>&#123;</div><div class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">attachBaseContext</span><span class="params">(Context base)</span> </span>&#123;</div><div class="line">		<span class="keyword">super</span>.attachBaseContext(base);</div><div class="line">		MultiDex.install(<span class="keyword">this</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>网上搜到还有一个方法：不继承 <code>Application</code> ，而是直接继承 <code>MultiDexApplication</code> 即可，这样就不需要重写<code>attachBaseContext()</code>方法了。</p>
<blockquote>
<p>参考资料：<a href="https://developer.android.com/studio/build/multidex.html" target="_blank" rel="external">Configure Apps with Over 64K Methods</a></p>
</blockquote>
<h2 id="可能遇到的问题"><a href="#可能遇到的问题" class="headerlink" title="可能遇到的问题"></a>可能遇到的问题</h2><h3 id="NoClassDefFoundError"><a href="#NoClassDefFoundError" class="headerlink" title="NoClassDefFoundError"></a>NoClassDefFoundError</h3><blockquote>
<p>Android SDK Build Tools 21.1 或者更高版本中的 Gradle  Android 插件有对 multidex 的支持。这个插件使用 Proguard 来分析你的项目并在 <code>[buildDir]/intermediates/multi-dex/[buildType]/maindexlist.txt</code> 文件中生成一个 app 启动 classes 的列表。但是这个列表并不是100%准确，可能会丢失一些app启动所需的 classes 。</p>
</blockquote>
<p>如果你在本地的测试机上没有遇到这个问题，并不代表你的 APP 没有问题，我通过查看友盟的崩溃记录和使用一些真机测试平台来进行检查，通常情况下会有所发现。</p>
<p>解决方法：在 <code>module</code> 下创建 <code>multidex.keep</code> 文件，并在其中罗列出那些 class，以便让编译器知道在 main dex 文件中要保持哪些 class。</p>
<p>生成 <code>multidex.keep</code> 文件中的内容有多种：</p>
<p><strong>方法一</strong>：修改 <code>module</code> 下的 <code>build.gradle</code> 文件</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">apply <span class="string">plugin:</span> <span class="string">'com.android.application'</span></div><div class="line">android &#123;</div><div class="line">  ...</div><div class="line">&#125;</div><div class="line">dependencies &#123;</div><div class="line">  ...</div><div class="line">&#125;</div><div class="line">android.applicationVariants.all &#123; variant -&gt;</div><div class="line">    task <span class="string">"fix$&#123;variant.name.capitalize()&#125;MainDexClassList"</span> &lt;&lt; &#123;</div><div class="line">        logger.info <span class="string">"Fixing main dex keep file for $variant.name"</span></div><div class="line">        File keepFile = <span class="keyword">new</span> File(<span class="string">"$buildDir/intermediates/multi-dex/$variant.buildType.name/maindexlist.txt"</span>)</div><div class="line">        keepFile.withWriterAppend &#123; w -&gt;</div><div class="line">            <span class="comment">// Get a reader for the input file</span></div><div class="line">            w.append(<span class="string">'\n'</span>)</div><div class="line">            <span class="keyword">new</span> File(<span class="string">"$&#123;projectDir&#125;/multidex.keep"</span>).withReader &#123; r -&gt;</div><div class="line">                <span class="comment">// And write data from the input into the output</span></div><div class="line">                w &lt;&lt; r &lt;&lt; <span class="string">'\n'</span></div><div class="line">            &#125;</div><div class="line">            logger.info <span class="string">"Updated main dex keep file for $&#123;keepFile.getAbsolutePath()&#125;\n$keepFile.text"</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">tasks.whenTaskAdded &#123; task -&gt;</div><div class="line">    android.applicationVariants.all &#123; variant -&gt;</div><div class="line">        <span class="keyword">if</span> (task.name == <span class="string">"create$&#123;variant.name.capitalize()&#125;MainDexClassList"</span>) &#123;</div><div class="line">            task.finalizedBy <span class="string">"fix$&#123;variant.name.capitalize()&#125;MainDexClassList"</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>方法二</strong>：修改 <code>module</code> 下的 <code>build.gradle</code> 文件</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">apply <span class="string">plugin:</span> <span class="string">'com.android.application'</span></div><div class="line">android &#123;</div><div class="line">  ...</div><div class="line">  afterEvaluate &#123;</div><div class="line">        tasks.matching &#123;</div><div class="line">            it.name.startsWith(<span class="string">'dex'</span>)</div><div class="line">        &#125;.each &#123; dx -&gt;</div><div class="line">            <span class="keyword">if</span> (dx.additionalParameters == <span class="literal">null</span>) &#123;</div><div class="line">                dx.additionalParameters = []</div><div class="line">            &#125;</div><div class="line">            dx.additionalParameters += <span class="string">'--multi-dex'</span> <span class="comment">// enable multidex</span></div><div class="line"></div><div class="line">            <span class="comment">// optional</span></div><div class="line">            dx.additionalParameters += <span class="string">"--main-dex-list=$projectDir/class-list.txt"</span>.toString() <span class="comment">// enable the main-dex-list</span></div><div class="line">            dx.additionalParameters += <span class="string">'--minimal-main-dex'</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">dependencies &#123;</div><div class="line">  ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>使用上述任意方式配置完成后，<code>clean</code> 然后 <code>rebuild</code> 项目，完成之后在 <code>module</code> 下的<code>build/intermediates/multi-dex/xxx</code>里找到 <code>maindexlist.txt</code> 文件（如果找不到相关目录，可能需要你同步后 <code>rebuild</code> 项目才能生成），复制里面的内容到 <code>module</code> 根目录下 <code>multidex.keep</code> 文件中（没有则先创建此文件）。</p>
<p>然后，比较重要的一步就是：通过友盟、测试记录、Bug记录等获取到 <code>NoClassDefFoundError</code> 错误对应的类，按照 <code>maindexlist.txt</code> 文件的方式添加这些类到 <code>multidex.keep</code> 文件中就可解决了。</p>
<h3 id="其他错误和问题"><a href="#其他错误和问题" class="headerlink" title="其他错误和问题"></a>其他错误和问题</h3><p>比如<strong>首次安装启动时黑屏没有响应／ANR</strong>、<strong>安装时异常</strong>等，你可以参考文末的一些文章，此外你还可以参考 <a href="http://blog.csdn.net/ys743276112/article/details/52223272" target="_blank" rel="external">Android 必知必会-Android Splash 页秒开之细节处理</a> 来优化启动体验。</p>
<p>参考资料和推荐阅读：</p>
<ul>
<li><a href="http://blog.csdn.net/wangbaochu/article/details/51178881" target="_blank" rel="external">Android Multidex 遇到的问题</a> （推荐此文）</li>
<li><a href="http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2015/1223/3796.html" target="_blank" rel="external">Android的multidex带来的性能问题－减慢app启动速度</a></li>
<li><a href="https://github.com/casidiablo/multidex/issues/7" target="_blank" rel="external">ClassNotFoundException</a></li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这是一篇早就准备写的文章，但当时搜集的资料未及时保存或者丢失，就拖到了现在。因为一个比较旧的 APP 也遇到了相关的问题，所以重新搜集了下资料整理发布出来了，希望能帮到遇到相关问题的朋友们。</p>
<p><strong>PS</strong>：你可以通过下面的方式和我联系</p>
<blockquote>
<ul>
<li>微博：<a href="http://weibo.com/zyansen" target="_blank" rel="external">cafeting</a></li>
<li>Github： <a href="https://github.com/likfe" target="_blank" rel="external">likfe</a></li>
<li>CSDN：<a href="http://blog.csdn.net/ys743276112" target="_blank" rel="external">他叫自己Mr.张</a> </li>
</ul>
</blockquote>
]]></content>
      
        
        <tags>
            
            <tag> Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android 必知必会 - Android Splash 页秒开之细节处理]]></title>
      <url>/2016/08/16/create-splash-activity/</url>
      <content type="html"><![CDATA[<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>今天阅读了两篇 Android Splash 页秒开的文章，就上手试了试，效果确实不错，不过在使用过程中发现个小的问题，应用是发现在 Android 6.0 系统下 APP 启动的时候有个默认的动画，如果按照文章介绍的直接启动下一个加载数据的页面会出现页面闪动，有点美中不足的感觉。</p>
<a id="more"></a>
<h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><p>解决方法很简单，我这里做出了两处修改：<strong>延迟启动</strong>和<strong>添加淡出的过场动画</strong></p>
<blockquote>
<p>SplashActivity</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line">   <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">       <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">       <span class="keyword">new</span> Handler().postDelayed(<span class="keyword">new</span> Runnable() &#123;</div><div class="line">           <span class="meta">@Override</span></div><div class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">               Intent starter = <span class="keyword">new</span> Intent(SplashActivity.<span class="keyword">this</span>, xxxActivity.class);</div><div class="line">       		startActivity(starter);</div><div class="line">               finish();</div><div class="line">               overridePendingTransition(R.anim.stand,R.anim.splash);</div><div class="line">           &#125;</div><div class="line">       &#125;,<span class="number">500</span>);</div><div class="line"></div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>stand.xml</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:interpolator</span>=<span class="string">"@android:anim/accelerate_interpolator"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">translate</span></span></div><div class="line"><span class="tag">        <span class="attr">android:duration</span>=<span class="string">"200"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:fromXDelta</span>=<span class="string">"0%p"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:toXDelta</span>=<span class="string">"0%p"</span></span></div><div class="line"><span class="tag">        /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></div></pre></td></tr></table></figure>
<blockquote>
<p>splash.xml</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">alpha</span></span></div><div class="line"><span class="tag">        <span class="attr">android:fromAlpha</span>=<span class="string">"1.0"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:toAlpha</span>=<span class="string">"0.0"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:duration</span>=<span class="string">"200"</span></span></div><div class="line"><span class="tag">        /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>首先贴一下阅读到的两篇文章：</p>
<ul>
<li><a href="http://blog.csdn.net/yanzhenjie1003/article/details/52201896" target="_blank" rel="external">带你重新认识：Android Splash 页秒开 Activity 白屏 Activity 黑屏</a></li>
<li><a href="https://www.bignerdranch.com/blog/splash-screens-the-right-way/" target="_blank" rel="external">Splash Screens the Right Way</a></li>
</ul>
<p>先感谢下博主的认真总结，才能让我们把自己的 APP 启动体验做的这么完美。</p>
<p>在实际开发中，我们可能会遇到很多复杂的情况，一篇博客或者教程也好，只能记录最核心的一些东西，学习的时候还是需要多多思考的。</p>
<p><strong>PS</strong>：你可以通过下面的方式和我联系</p>
<blockquote>
<ul>
<li>微博：<a href="http://weibo.com/zyansen" target="_blank" rel="external">cafeting</a></li>
<li>Github： <a href="https://github.com/likfe" target="_blank" rel="external">likfe</a></li>
<li>CSDN：<a href="http://blog.csdn.net/ys743276112" target="_blank" rel="external">他叫自己Mr.张</a> </li>
</ul>
</blockquote>
]]></content>
      
        
        <tags>
            
            <tag> Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[在自己的电脑上安装 GitBook For Mac]]></title>
      <url>/2016/08/05/use-gitbook-on-mac/</url>
      <content type="html"><![CDATA[<h2 id="剪不断的情缘"><a href="#剪不断的情缘" class="headerlink" title="剪不断的情缘"></a>剪不断的情缘</h2><p>之前写了一篇 <a href="http://blog.csdn.net/ys743276112/article/details/45130831" target="_blank" rel="external">在自己的服务器上安装GitBook</a> ,发布于 2015-04-20，当时的安装环境是 <code>CentOS 6.X_64Bit</code>，今天想再研究一下这个 <code>GitBook</code> ，发现在基于 <code>Linux</code> 内核的机器上<strong>安装基础功能很简单</strong>，但是牵涉到生成 <code>pdf/epub/mobi</code> 格式的书籍时，<strong>安装calibre的代价非常大</strong>（因为要安装 N 多前置库），对于不是非常非常熟练使用 <code>Linux</code> 的用户，几乎是一种灾难。</p>
<p>然而，对于 <code>OS X</code> 和 <code>Windows</code> 用户，则相对容易很多（Windows环境未测试），安装相应的 <code>calibre</code> 的客户端即可解决格式转换的问题。</p>
<a id="more"></a>
<h2 id="只讲重点-゜-゜"><a href="#只讲重点-゜-゜" class="headerlink" title="只讲重点  (゜-゜)"></a>只讲重点  (゜-゜)</h2><p>前提条件这里一笔带过（在 Mac 上进行）：</p>
<ol>
<li>安装 <code>nvm</code> ；</li>
<li>使用 <code>nvm</code> 安装 <code>Node.js</code> ，我安装了 <code>v5.0.0</code> 版本的；</li>
<li>使用 <code>npm</code> 安装 <code>gitbook</code> ，不会的看 <a href="http://toolchain.gitbook.com/setup.html" target="_blank" rel="external">这里</a>；</li>
<li>安装 <code>calibre</code> 的客户端==&gt;重点在此步；</li>
<li>执行生成命令：生成指定格式的文件。</li>
</ol>
<h3 id="画重点啦-´−｀-ﾝｰ-咳咳，看黑板"><a href="#画重点啦-´−｀-ﾝｰ-咳咳，看黑板" class="headerlink" title="画重点啦 (´−｀) ﾝｰ 咳咳，看黑板"></a>画重点啦 (´−｀) ﾝｰ 咳咳，看黑板</h3><p>1.下载对应的 <code>Calibre</code> 文件，<a href="http://www.calibre-ebook.com/download" target="_blank" rel="external">下载地址在此</a> ，Mac 用户自然是下载 <code>OS X</code> 版本的了；<br>2.下载安装 <code>Calibre</code> ，然后<strong>务必打开运行一次 <code>Calibre</code></strong> ，否则就嘿嘿嘿了；<br>3.在终端里执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">sudo ln -s /Applications/calibre.app/Contents/MacOS/ebook-convert /usr/<span class="built_in">local</span>/bin</div><div class="line"></div><div class="line">//官方的文档里是如下命令：会引起权限和命令无效等问题</div><div class="line">sudo ln -s ~/Applications/calibre.app/Contents/MacOS/ebook-convert /usr/bin</div></pre></td></tr></table></figure>
<p>4.转换格式，参考官方文档</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Generate a PDF file</span></div><div class="line">$ gitbook pdf ./ ./mybook.pdf</div><div class="line"></div><div class="line"><span class="comment"># Generate an ePub file</span></div><div class="line">$ gitbook epub ./ ./mybook.epub</div><div class="line"></div><div class="line"><span class="comment"># Generate a Mobi file</span></div><div class="line">$ gitbook mobi ./ ./mybook.mobi</div></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>不管怎么说，终于还是实现了 <code>GitBook</code> 在 Mac 上的完美运行。在有生成 <code>pdf/epub/mobi</code> 格式的文件的需求时，就不心虚了。</p>
<p>最近在阅读的比较火的一个项目 <a href="https://github.com/GeniusVJR/LearningNotes" target="_blank" rel="external">LearningNotes</a> ，是一个 Android 知识点笔记和面试题的一个总结，我用 <code>GitBook</code> 生成了一份 HTML 版，<a href="http://doc.inkcode.cc/ALN/index.html" target="_blank" rel="external">点击这里访问</a>，我还打算和作者联系一下，帮他生成 <code>pdf/epub/mobi</code> 格式，方便本地阅读。</p>
<p>PS:</p>
<blockquote>
<p>你可以通过 <a href="https://github.com/likfe" target="_blank" rel="external">Github</a>、<a href="http://blog.csdn.net/ys743276112" target="_blank" rel="external">CSDN</a> 和 <a href="http://weibo.com/zyansen" target="_blank" rel="external">微博</a> 与我联系</p>
</blockquote>
]]></content>
      
        
        <tags>
            
            <tag> Mac </tag>
            
            <tag> GitBook </tag>
            
            <tag> OSX </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Sublime Text 3 安装 Emmet]]></title>
      <url>/2016/08/01/sublime-text-3-install-emmet-for-mac/</url>
      <content type="html"><![CDATA[<p>前几天重写了2014年发布的 <a href="http://blog.csdn.net/ys743276112/article/details/52063396" target="_blank" rel="external">超高速前端开发工具——Emmet</a> ，主要是优化了代码段的格式，更加易读。今天在 MacBook 上安装了 Sublime Text 3 ，在安装一系列的插件时被网络问题影响到，这里介绍下安装过程，包含本地安装的情况。</p>
<h2 id="1-安装-Package-Control"><a href="#1-安装-Package-Control" class="headerlink" title="1. 安装 Package Control"></a>1. 安装 <code>Package Control</code></h2><p>这里我们访问 <a href="https://packagecontrol.io/installation" target="_blank" rel="external">Package Control 官网</a> ，按照步骤即可：</p>
<h3 id="1-打开命令行"><a href="#1-打开命令行" class="headerlink" title="1. 打开命令行"></a>1. 打开命令行</h3><p>使用快捷键 <strong>ctrl+` </strong> 或者在菜单中点击 <strong>View &gt; Show Console</strong> 。</p>
<a id="more"></a>
<h3 id="2-执行安装命令"><a href="#2-执行安装命令" class="headerlink" title="2. 执行安装命令"></a>2. 执行安装命令</h3><p>如果是 <code>Sublime Text 2</code> ，则复制下面的命令到命令行里并按下回车键进行安装：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> urllib2,os,hashlib; h = <span class="string">'2915d1851351e5ee549c20394736b442'</span> + <span class="string">'8bc59f460fa1548d1514676163dafc88'</span>; pf = <span class="string">'Package Control.sublime-package'</span>; ipp = sublime.installed_packages_path(); os.makedirs( ipp ) <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(ipp) <span class="keyword">else</span> <span class="keyword">None</span>; urllib2.install_opener( urllib2.build_opener( urllib2.ProxyHandler()) ); by = urllib2.urlopen( <span class="string">'http://packagecontrol.io/'</span> + pf.replace(<span class="string">' '</span>, <span class="string">'%20'</span>)).read(); dh = hashlib.sha256(by).hexdigest(); open( os.path.join( ipp, pf), <span class="string">'wb'</span> ).write(by) <span class="keyword">if</span> dh == h <span class="keyword">else</span> <span class="keyword">None</span>; print(<span class="string">'Error validating download (got %s instead of %s), please try manual install'</span> % (dh, h) <span class="keyword">if</span> dh != h <span class="keyword">else</span> <span class="string">'Please restart Sublime Text to finish installation'</span>)</div></pre></td></tr></table></figure>
<p>如果是 <code>Sublime Text 3</code> ，则复制下面的命令到命令行里并按下回车键进行安装：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> urllib.request,os,hashlib; h = <span class="string">'2915d1851351e5ee549c20394736b442'</span> + <span class="string">'8bc59f460fa1548d1514676163dafc88'</span>; pf = <span class="string">'Package Control.sublime-package'</span>; ipp = sublime.installed_packages_path(); urllib.request.install_opener( urllib.request.build_opener( urllib.request.ProxyHandler()) ); by = urllib.request.urlopen( <span class="string">'http://packagecontrol.io/'</span> + pf.replace(<span class="string">' '</span>, <span class="string">'%20'</span>)).read(); dh = hashlib.sha256(by).hexdigest(); print(<span class="string">'Error validating download (got %s instead of %s), please try manual install'</span> % (dh, h)) <span class="keyword">if</span> dh != h <span class="keyword">else</span> open(os.path.join( ipp, pf), <span class="string">'wb'</span> ).write(by)</div></pre></td></tr></table></figure>
<p><strong>本地安装：</strong></p>
<p>本地安装可能不区分 <code>Sublime Text</code> 的版本问题，因为官网只提供了一个下载链接。</p>
<ol>
<li>点击菜单：<code>Preferences &gt; Browse Packages…</code> ；</li>
<li>打开并进入 <code>Installed Packages/</code> 目录；</li>
<li>下载 <a href="https://packagecontrol.io/Package%20Control.sublime-package" target="_blank" rel="external">Package Control.sublime-packageb</a> 并拷贝文件到 <code>Installed Packages/</code> 目录；</li>
<li>重启 <code>Sublime Text</code> 。</li>
</ol>
<h2 id="2-安装-Emmet"><a href="#2-安装-Emmet" class="headerlink" title="2. 安装 Emmet"></a>2. 安装 <code>Emmet</code></h2><p>在 <code>Sublime Text</code> 中按 <code>Ctrl+Shift+p</code> 快捷键或在菜单-工具中打开“命令面板”（ <code>Tools &gt; Command Palette...</code> ），输入：<code>Install Package</code> (安装扩展)后回车，弹出新的窗口，再输入 <code>Emmet</code> 查找 <code>Emmet</code> 确定安装，等到自动打开一个文档，说明安装成功。</p>
<h3 id="解决-Emmet-安装之后，Pyv8-未安装的问题"><a href="#解决-Emmet-安装之后，Pyv8-未安装的问题" class="headerlink" title="解决 Emmet 安装之后，Pyv8 未安装的问题"></a>解决 Emmet 安装之后，Pyv8 未安装的问题</h3><p>安装 <code>Emmet</code> 之后，自动打开的文档提示会自动安装 <code>PyV8</code> 的包，请在安装 <code>PyV8</code> 成功之后重启 <code>Sublime Text</code> ，你可能会发现 <code>Sublime Text</code> 左下角一直显示 <code>Loading PyV8…</code> 之类的提示，如果关闭重启之后依旧如此，最后还是无法使用 <code>Emmet</code> 的话，就说明网络有一定的问题，无法正常下载 <code>PyV8</code> 的包了，下面介绍本地安装 <code>PyV8</code> 的方法（Mac系统下）：</p>
<ul>
<li>打开 <a href="https://github.com/emmetio/pyv8-binaries" target="_blank" rel="external">PyV8 的 Github 主页</a></li>
<li>按照说明下载对应版本的包，并解压到指定的目录。</li>
</ul>
<p>对于 <code>OSX 10.7+</code> 上使用 <code>Sublime Text 3</code> ,我们需要下载 <a href="https://raw.githubusercontent.com/emmetio/pyv8-binaries/master/pyv8-osx-p3.zip" target="_blank" rel="external">pyv8-osx-p3.zip</a> ,然后把解压后 2 个的文件放在如下目录结构中：</p>
<p><img src="http://mmmedia.qiniudn.com/2016-08-01_2016-08-01%20at%20%E4%B8%8B%E5%8D%884.39.png" alt="2016-08-01_2016-08-01 at 下午4.39.png"></p>
<p>没有的目录需要自己创建，然后重启 <code>Sublime Text 3</code> 即可。</p>
<p>PS:</p>
<blockquote>
<p>你可以关注的我 <a href="https://github.com/likfe" target="_blank" rel="external">Github</a>、<a href="http://blog.csdn.net/ys743276112" target="_blank" rel="external">CSDN</a> 和 <a href="http://weibo.com/zyansen" target="_blank" rel="external">微博</a></p>
</blockquote>
]]></content>
      
        
        <tags>
            
            <tag> Sublime Text </tag>
            
            <tag> Emmet </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android必知必会-App 常用图标尺寸规范汇总]]></title>
      <url>/2016/07/26/android-size-set/</url>
      <content type="html"><![CDATA[<p><strong>内容持续更新中，更新日期：2016-08-11</strong></p>
<h2 id="1-程序启动图标（icon-launcher）"><a href="#1-程序启动图标（icon-launcher）" class="headerlink" title="1. 程序启动图标（icon launcher）"></a>1. 程序启动图标（icon launcher）</h2><p>放在<code>mipmap-*dpi</code>下，文件名为<code>ic_launcher.png</code></p>
<ul>
<li>LDPI (Low Density Screen，120 DPI)，其图标大小为 36 x 36 px。</li>
<li>MDPI (Medium Density Screen, 160 DPI)，其图标大小为 48 x 48 px。</li>
<li>HDPI (High Density Screen, 240 DPI)，其图标大小为 72 x 72 px。</li>
<li>xhdpi (Extra-high density screen, 320 DPI)，其图标大小为 96 x 96 px。</li>
<li>xxhdpi（xx-high density screen, 480 DPI）,其图标大小为144 x 144 px。</li>
<li>xxxhdpi（xxx-high density screen, 640 DPI）,其图标大小为192 x 192 px。</li>
</ul>
<h3 id="技巧：自动生成对应分辨率的-icon-launcher"><a href="#技巧：自动生成对应分辨率的-icon-launcher" class="headerlink" title="技巧：自动生成对应分辨率的 icon launcher"></a>技巧：自动生成对应分辨率的 icon launcher</h3><blockquote>
<p>新增于2016-08-11 </p>
</blockquote>
<p>使用 <code>Android Studio</code> ，在 <code>module</code>或者 <code>drawable</code> 上右键 <code>new &gt; ImageAsset</code> ,可以把一张大图自动裁切成各 DPI 对应的分辨率的 icon launcher。</p>
<a id="more"></a>
<p>细节操作参照下图：</p>
<p><img src="http://mmmedia.qiniudn.com/2016-08-11_2016-08-11%20at%20%E4%B8%8A%E5%8D%8811.38.png" alt="2016-08-11_2016-08-11 at 上午11.38.png"></p>
<ol>
<li>选择要生成的图片类型：<code>Launcher Icons</code> ；</li>
<li>Name 会自动生成 <code>ic_launcher</code> ，如果不是则填成 <code>ic_launcher</code> ；</li>
<li><code>Asset Type</code> 设置成 <code>Image</code> ;</li>
<li>在 <code>path</code> 一列的最后选择自己要生成的图片</li>
<li>调整 <code>Shape</code> 等参数；</li>
<li>点击 <code>next</code> 一路到 <code>finish</code> 即可。</li>
</ol>
<p><strong>PS：</strong>使用 <code>Shape</code> 的其他参数，比如圆角<code>square</code> , 会默认使用<strong>不支持透明度的颜色</strong>作为背景，所以要根据具体的图标进行修改，特殊的情况需要设计师切出带圆角和透明度的大图。</p>
<h2 id="2-不透明度16进制值"><a href="#2-不透明度16进制值" class="headerlink" title="2. 不透明度16进制值"></a>2. 不透明度16进制值</h2><table>
<thead>
<tr>
<th style="text-align:center">不透明度</th>
<th style="text-align:center">16进制值</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">100%</td>
<td style="text-align:center">FF</td>
</tr>
<tr>
<td style="text-align:center">95%</td>
<td style="text-align:center">F2</td>
</tr>
<tr>
<td style="text-align:center">90%</td>
<td style="text-align:center">E6</td>
</tr>
<tr>
<td style="text-align:center">85%</td>
<td style="text-align:center">D9</td>
</tr>
<tr>
<td style="text-align:center">80%</td>
<td style="text-align:center">CC</td>
</tr>
<tr>
<td style="text-align:center">75%</td>
<td style="text-align:center">BF</td>
</tr>
<tr>
<td style="text-align:center">70%</td>
<td style="text-align:center">B3</td>
</tr>
<tr>
<td style="text-align:center">65%</td>
<td style="text-align:center">A6</td>
</tr>
<tr>
<td style="text-align:center">60%</td>
<td style="text-align:center">99</td>
</tr>
<tr>
<td style="text-align:center">55%</td>
<td style="text-align:center">8C</td>
</tr>
<tr>
<td style="text-align:center">50%</td>
<td style="text-align:center">80</td>
</tr>
<tr>
<td style="text-align:center">45%</td>
<td style="text-align:center">73</td>
</tr>
<tr>
<td style="text-align:center">40%</td>
<td style="text-align:center">66</td>
</tr>
<tr>
<td style="text-align:center">35%</td>
<td style="text-align:center">59</td>
</tr>
<tr>
<td style="text-align:center">30%</td>
<td style="text-align:center">4D</td>
</tr>
<tr>
<td style="text-align:center">25%</td>
<td style="text-align:center">40</td>
</tr>
<tr>
<td style="text-align:center">20%</td>
<td style="text-align:center">33</td>
</tr>
<tr>
<td style="text-align:center">15%</td>
<td style="text-align:center">26</td>
</tr>
<tr>
<td style="text-align:center">10%</td>
<td style="text-align:center">1A</td>
</tr>
<tr>
<td style="text-align:center">5%</td>
<td style="text-align:center">0D</td>
</tr>
<tr>
<td style="text-align:center">0%</td>
<td style="text-align:center">00</td>
</tr>
</tbody>
</table>
<h2 id="3-dp和px换算及关系"><a href="#3-dp和px换算及关系" class="headerlink" title="3. dp和px换算及关系"></a>3. dp和px换算及关系</h2><p>各DPI的换算：</p>
<p><img src="http://img.blog.csdn.net/20160721152503652" alt="Android DPI"></p>
<p>数据总结表：</p>
<table>
<thead>
<tr>
<th style="text-align:center">名称</th>
<th style="text-align:center">对应 DPI</th>
<th style="text-align:center">比例(以 mdpi 为基数 1)</th>
<th style="text-align:center">和px的换算关系</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">lpdi</td>
<td style="text-align:center">120 DPI</td>
<td style="text-align:center">0.75</td>
<td style="text-align:center">1 dp = 0.75 px</td>
</tr>
<tr>
<td style="text-align:center">mdpi</td>
<td style="text-align:center">160 DPI</td>
<td style="text-align:center">1</td>
<td style="text-align:center">1 dp = 1 px</td>
</tr>
<tr>
<td style="text-align:center">hdpi</td>
<td style="text-align:center">240 DPI</td>
<td style="text-align:center">1.5</td>
<td style="text-align:center">1 dp = 1.5 px</td>
</tr>
<tr>
<td style="text-align:center">xhdpi</td>
<td style="text-align:center">320 DPI</td>
<td style="text-align:center">2</td>
<td style="text-align:center">1 dp = 2 px</td>
</tr>
<tr>
<td style="text-align:center">xxhdpi</td>
<td style="text-align:center">480 DPI</td>
<td style="text-align:center">3</td>
<td style="text-align:center">1 dp = 3 px</td>
</tr>
<tr>
<td style="text-align:center">xxxhdpi</td>
<td style="text-align:center">640 DPI</td>
<td style="text-align:center">4</td>
<td style="text-align:center">1 dp = 4 px</td>
</tr>
</tbody>
</table>
<h3 id="dp-到-px"><a href="#dp-到-px" class="headerlink" title="dp 到 px"></a>dp 到 px</h3><p>这里给定：<strong>400 dp * 240 dp</strong><br>则对应的图片分辨率分别为：</p>
<ul>
<li>lpdi  ⇒ 300 px * 180 px</li>
<li>mdpi ⇒ 400 px * 240 px</li>
<li>hdpi ⇒ 600 px * 360 px</li>
<li>xhdpi ⇒ 800 px * 480 px</li>
<li>xxhdpi ⇒ 1200 px * 720 px</li>
<li>xxxhdpi ⇒ 1600 px * 960 px</li>
</ul>
<h3 id="px-到-dp"><a href="#px-到-dp" class="headerlink" title="px 到 dp"></a>px 到 dp</h3><p>从 <code>px</code> 换算成 <code>dp</code> 要知道它是以什么 <code>dpi</code> 标准来设计的，根据换算关系表可得到相应的 <code>dp</code> 。<br>例如： 以 <code>xxhdpi</code> 标准设计的 UI，其中一个切图的分辨率是 <code>600 px * 360 px</code> ，根据换算关系表可知，在 <code>xxhdpi</code> 标准下，<code>1 dp = 3 px</code> ,则其对应的 <code>dp</code> 是  <code>200 dp * 120 dp</code> 。</p>
<p><strong>PS</strong>：你可以通过下面的方式和我联系</p>
<blockquote>
<ul>
<li>微博：<a href="http://weibo.com/zyansen" target="_blank" rel="external">cafeting</a></li>
<li>Github： <a href="https://github.com/likfe" target="_blank" rel="external">likfe</a></li>
<li>CSDN：<a href="http://blog.csdn.net/ys743276112" target="_blank" rel="external">他叫自己Mr.张</a> </li>
</ul>
</blockquote>
]]></content>
      
        
        <tags>
            
            <tag> Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android必知必会-发布开源Android项目注意事项]]></title>
      <url>/2016/07/17/android-postOpenProjectNote/</url>
      <content type="html"><![CDATA[<h2 id="1-合理配置-gitignore-文件"><a href="#1-合理配置-gitignore-文件" class="headerlink" title="1. 合理配置 .gitignore 文件"></a>1. 合理配置 <code>.gitignore</code> 文件</h2><p>配置 <code>.gitignore</code> 可以排除一些非必要文件和保护保密信息，下面是在项目根目录下 <code>.gitignore</code> 的配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">.gradle</div><div class="line">/local.properties</div><div class="line">/gradle.properties</div><div class="line">/build</div><div class="line">*.log</div><div class="line">*.apk</div><div class="line">*.ap_</div><div class="line">/*/build/</div></pre></td></tr></table></figure>
<p>这里介绍下一些参数的意义：</p>
<ul>
<li><code>/local.properties</code>：这个文件里默认写的有本地 SDK 的位置，多人协作时一般要排除，仅仅做开源项目可以不排除。</li>
<li><code>/gradle.properties</code>：一般写有 gradle 的 jvm 、代理和打包签名文件 Key 的一些信息，根据需要进行处理，一般情况下需要排除，其他情况见下文。</li>
<li><code>/build</code>和<code>/*/build/</code>：排除 build 项目生成的文件，文件较大，且 IDE 可以自动生成，无特殊需求，<strong>必须排除</strong>。</li>
</ul>
<a id="more"></a>
<h2 id="2-签名文件"><a href="#2-签名文件" class="headerlink" title="2. 签名文件"></a>2. 签名文件</h2><p>在使用了一些需要配置 <code>appkey</code> 的第三方的 SDK 时，比如 XX 地图 SDK 、XX 播放器 SDK ，这些都需要在对应的开发者中心里配置<strong>包名</strong>和 <strong>Android签名</strong> 信息，这些和签名文件直接相关，所以需要在项目里提前放置好一个编译用的签名文件，可以在 <code>gradle.properties</code> 里写上相应的变量。</p>
<p>签名文件目前有两种格式：<code>.keystore</code> 和 <code>.jsk</code> ，这里以 <code>debug.jks</code> 为例，<strong>此文件存放在项目根目录</strong>，如果目录有变化，加上相应的路径即可。</p>
<p>根据是否在 <code>gradle.properties</code> 里写上相应的变量有两种使用方法：</p>
<h3 id="方案一：不使用-gradle-properties"><a href="#方案一：不使用-gradle-properties" class="headerlink" title="方案一：不使用 gradle.properties"></a>方案一：不使用 <code>gradle.properties</code></h3><p>不使用 <code>gradle.properties</code> 的话，相关信息直接写在 <code>/app/build.gradle</code> 文件里:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">android &#123;</div><div class="line">  	...</div><div class="line">  	signingConfigs &#123;</div><div class="line">        debug &#123;</div><div class="line">            storeFile file(<span class="string">"$rootDir/debug.jks"</span>)</div><div class="line">            storePassword <span class="string">"androidstore"</span></div><div class="line">            keyAlias <span class="string">"androiddebugkey"</span></div><div class="line">            keyPassword <span class="string">"androidkey"</span></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        release &#123;</div><div class="line">            storeFile file(<span class="string">"$rootDir/debug.jks"</span>)</div><div class="line">            storePassword <span class="string">"androidstore"</span></div><div class="line">            keyAlias <span class="string">"androiddebugkey"</span></div><div class="line">            keyPassword <span class="string">"androidkey"</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="方案二：使用-gradle-properties"><a href="#方案二：使用-gradle-properties" class="headerlink" title="方案二：使用 gradle.properties"></a>方案二：使用 <code>gradle.properties</code></h3><p>使用 <code>gradle.properties</code> 的话，相关信息写在 <code>/gradle.properties</code> 和 <code>/app/build.gradle</code> 文件里:</p>
<p>对于 <code>/gradle.properties</code> ：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">RELEASE_KEY_ALIAS=androiddebugkey</div><div class="line">RELEASE_STORE_PASSWORD=androidstore</div><div class="line">RELEASE_KEY_PASSWORD=androidkey</div><div class="line">RELEASE_STORE_FILE=$rootDir/debug.jks</div></pre></td></tr></table></figure>
<p>对于 <code>/app/build.gradle</code> ：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">android &#123;</div><div class="line">  	...</div><div class="line">  	signingConfigs &#123;</div><div class="line">        debug &#123;</div><div class="line">            storeFile file(RELEASE_STORE_FILE)</div><div class="line">            storePassword RELEASE_STORE_PASSWORD</div><div class="line">            keyAlias RELEASE_KEY_ALIAS</div><div class="line">            keyPassword RELEASE_KEY_PASSWORD</div><div class="line">        &#125;</div><div class="line">        releaseConfig &#123;</div><div class="line">            storeFile file(RELEASE_STORE_FILE)</div><div class="line">            storePassword RELEASE_STORE_PASSWORD</div><div class="line">            keyAlias RELEASE_KEY_ALIAS</div><div class="line">            keyPassword RELEASE_KEY_PASSWORD</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这种情况下 <code>/gradle.properties</code> 不能出现在 <code>.gitignore</code> 文件中。</p>
<h2 id="3-SO-文件"><a href="#3-SO-文件" class="headerlink" title="3. .SO 文件"></a>3. <code>.SO</code> 文件</h2><p>如果开源项目中使用的开源库中有多个库包含 <code>jni</code>，由于每个开源库提供的 <code>so</code> 文件的编译版本不尽相同，那么，很有可能在不同 CPU 架构的手机上崩溃，所以要在打包时进行 <code>so</code> 文件的过滤或者说选择。</p>
<p>下面举个简单的例子：假设我的一个开源项目使用了 <code>gif-drawable</code>、<code>fresco</code>、<code>Vitamio-4.0</code></p>
<p>在 <code>/app/build.gradle</code> 中的配置如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">dependencies &#123;</div><div class="line">	...</div><div class="line">	compile &apos;pl.droidsonroids.gif:android-gif-drawable:1.1.14&apos;</div><div class="line">	compile &apos;com.facebook.fresco:fresco:0.9.0&apos;</div><div class="line">	compile(name: &apos;Vitamio-4.0&apos;, ext: &apos;aar&apos;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后我们看一下它们各自编译的 <code>so</code> 版本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">gif-drawable</div><div class="line">	--mips</div><div class="line">	--mips64</div><div class="line">	--armeabi</div><div class="line">	--armeabi-v7a</div><div class="line">	--arm64-v8a</div><div class="line">	--x86</div><div class="line">	--x86_64</div><div class="line">fresco:imagepipeline</div><div class="line">	--armeabi</div><div class="line">	--armeabi-v7a</div><div class="line">	--arm64-v8a</div><div class="line">	--x86</div><div class="line">	--x86_64</div><div class="line">Vitamio-4.0</div><div class="line">	--mips</div><div class="line">	--armeabi</div><div class="line">	--armeabi-v7a</div><div class="line">	--x86</div></pre></td></tr></table></figure>
<p>我们找一下以上三个库的 <code>so</code> 版本的<strong>交集</strong>，对，这里强调下：<strong>交集</strong>、<strong>交集</strong>、<strong>交集</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">armeabi</div><div class="line">armeabi-v7a</div><div class="line">x86</div></pre></td></tr></table></figure>
<p>找到了交集，就是我们需要在打包进APK的 <code>so</code> 版本，如何指定打包 <code>so</code> 版本，需要配置 <code>/app/build.gradle</code> 文件：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">android &#123;</div><div class="line">	...</div><div class="line">	productFlavors &#123;</div><div class="line">        dev &#123;</div><div class="line">            ndk &#123;</div><div class="line">                abiFilters <span class="string">"armeabi-v7a"</span>,<span class="string">"arm64-v8a"</span>,<span class="string">"x86"</span></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        prod &#123;</div><div class="line">            ndk &#123;</div><div class="line">                abiFilters <span class="string">"armeabi-v7a"</span>,<span class="string">"arm64-v8a"</span>,<span class="string">"x86"</span></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>关于打包时指定 <code>so</code> 版本这一点很重要，不仅时在开源项目中需要注意，在实际的开发项目中更要注意这一点，所以在选择包含了 jni 的开源库时，务必要注意到当前项目中其他开源库的 jni 的版本。每次添加新的包含 jni 的类库时，都要做一次比对，务必打包它们交集的 jni 版本。</p>
<h2 id="4-第三方SDK二次打包"><a href="#4-第三方SDK二次打包" class="headerlink" title="4. 第三方SDK二次打包"></a>4. 第三方SDK二次打包</h2><p>项目中使用的第三方 SDK 中，其作者可能考虑的不够细致，也可能是为了兼容 Eclipse ，常常会出现让你复制粘贴大量的图片和 XML 文件到现有的项目中，这大大影响了项目原有的目录结构和可读性，更糟糕的问题是对 SDK 的升级、删除会非常的麻烦，碰到这样的 SDK ，需要我们进行二次打包成 aar 格式的类库。</p>
<p><strong>PS</strong>：Eclipse 不支持 aar 格式，只能使用上述比较麻烦的方式，不过你可以在使用此类类库的时候，<strong>列一张清单</strong>，记录此 SDK 在项目中添加的所有文件，便于以后变更。如果不是特别需要，建议使用 Android Studio 进行开发。</p>
<h3 id="打包-aar"><a href="#打包-aar" class="headerlink" title="打包 aar"></a>打包 aar</h3><p>打包 aar 需要在 Android Studio 中进行。这里先做一个约定，在 Android Studio 中的一个 Project 中，包含两个 module ，其中需要打包成 aar 的 module ，名称是 <strong>demoLibary</strong> ，主 module 或者说测试用的 module 名称是 <strong>app</strong> 。</p>
<p>1.修改 <strong>demoLibary</strong> 的 <code>build.gradle</code>  ：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//apply plugin: 'com.android.application'</span></div><div class="line">apply <span class="string">plugin:</span> <span class="string">'com.android.library'</span></div></pre></td></tr></table></figure>
<p>即修改 <code>apply plugin: &#39;com.android.application&#39;</code> 为 <code>apply plugin: &#39;com.android.library&#39;</code></p>
<p>2.修改<strong>demoLibary</strong>一些信息：</p>
<p>删除 <code>AndroidManifest.xml</code> 中的无用信息：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//例如：</span></div><div class="line"><span class="string">android:</span>icon=<span class="string">"@mipmap/ic_launcher"</span></div><div class="line"><span class="string">android:</span>label=<span class="string">"@string/app_name"</span></div></pre></td></tr></table></figure>
<p>删除 <code>res/values</code> 下不用的值和文件。</p>
<p>3.在主 module <strong>app</strong> 里添加对 <strong>demoLibary</strong> 的引用：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">dependencies &#123;</div><div class="line">	...</div><div class="line">	compile project(<span class="string">':demoLibary'</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>4.生成 aar 文件：</p>
<p><code>build</code> module <strong>app</strong> 之后就能在 <strong>demoLibary</strong> 下的 <code>build/outputs/aar</code> 下找到我们需要的 aar 文件了，这里命名为 <code>demoLibary-1.0.aar</code>。</p>
<h3 id="使用-aar"><a href="#使用-aar" class="headerlink" title="使用 aar"></a>使用 aar</h3><p>1.配置项目根目录的 <code>/build.gradle</code> ：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">allprojects &#123;</div><div class="line">    repositories &#123;</div><div class="line">    	...</div><div class="line">    	flatDir &#123;</div><div class="line">            dirs <span class="string">'libs'</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>2.在 module <strong>app</strong> 中引用 aar ：</p>
<p>首先复制 <code>demoLibary-1.0.aar</code> 到 module <strong>app</strong> 下的 <code>libs</code> 目录（没有则创建此目录）中，然后修改 <code>/app/build.gradle</code> 文件：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">dependencies &#123;</div><div class="line">    compile fileTree(<span class="string">include:</span> [<span class="string">'*.jar'</span>], <span class="string">dir:</span> <span class="string">'libs'</span>)</div><div class="line">    compile(<span class="string">name:</span> <span class="string">'demoLibary-1.0'</span>, <span class="string">ext:</span> <span class="string">'aar'</span>)</div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这样，你就可以使用 <strong>demoLibary</strong> 开放的接口和方法了。</p>
<h2 id="n-不是结尾"><a href="#n-不是结尾" class="headerlink" title="n. 不是结尾"></a>n. 不是结尾</h2><p>以上几点是目前发现的较明显的问题，如果你了解更多的注意事项，欢迎和我联系。</p>
<blockquote>
<p><strong>PS</strong>：你可以通过下面的方式和我联系</p>
<ul>
<li>微博：<a href="http://weibo.com/zyansen" target="_blank" rel="external">cafeting</a></li>
<li>Github： <a href="https://github.com/likfe" target="_blank" rel="external">likfe</a></li>
<li>CSDN：<a href="http://blog.csdn.net/ys743276112" target="_blank" rel="external">他叫自己Mr.张</a> </li>
</ul>
</blockquote>
]]></content>
      
        
        <tags>
            
            <tag> Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android必知必会-长按返回健退出]]></title>
      <url>/2016/07/06/android-longpress-back/</url>
      <content type="html"><![CDATA[<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>平常比较常见的都是一定时间间隔内按两次返回键来退出应用，并且第一次点击会有相应的提示，网上资料比较多，这里写一下，长按返回键退出。</p>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p>实现的方案常用的有两个：</p>
<ul>
<li>重写<code>dispatchKeyEvent(KeyEvent event)</code>方法</li>
<li>重写<code>onKeyDown(int keyCode, KeyEvent event)</code>方法</li>
</ul>
<a id="more"></a>
<h3 id="方案一"><a href="#方案一" class="headerlink" title="方案一"></a>方案一</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchKeyEvent</span><span class="params">(KeyEvent event)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (event.getKeyCode() == KeyEvent.KEYCODE_BACK &amp;&amp; event.isLongPress()) &#123;</div><div class="line">        <span class="comment">//do something else</span></div><div class="line">        System.exit(<span class="number">0</span>);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>代码很简单，如果按下了返回键且是长按，则退出。</p>
<h3 id="方案二"><a href="#方案二" class="headerlink" title="方案二"></a>方案二</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onKeyDown</span><span class="params">(<span class="keyword">int</span> keyCode, KeyEvent event)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (keyCode == KeyEvent.KEYCODE_BACK &amp;&amp; event.getRepeatCount() == <span class="number">0</span>) &#123;</div><div class="line">        Toast.makeText(<span class="keyword">this</span>, <span class="string">"长按返回键退出"</span>, Toast.LENGTH_SHORT).show();</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (keyCode == KeyEvent.KEYCODE_BACK &amp;&amp; event.getRepeatCount() == <span class="number">2</span>) &#123;</div><div class="line">        <span class="comment">//do something else</span></div><div class="line">        System.exit(<span class="number">0</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>推荐本方案，可以修改<code>else if</code>中<code>event.getRepeatCount()==</code>的次数来修改长按的时间，<code>event.getRepeatCount()</code> 为<strong>0</strong>时代表单击了一次，当次数<code>&gt;=1</code>时就代表长按了,值越大，说明按的时间越长。<br>之所以推荐本方案，因为可以在第一次点击返回键的时候提醒用户。</p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>本来准备多整理些资料一起发出来，掘金刚刚在内测发布工具，这里就手写一篇试试感觉如何，体验还是很棒的。以下是个人意见：</p>
<p>优点：</p>
<ul>
<li>配色漂亮</li>
<li>界面干净，写作比较专注，适合有经验的老手</li>
<li>响应快，对<code>MarkDown</code>语法的细节处理的不错</li>
</ul>
<p>缺点：</p>
<ul>
<li>界面没有引导，新手会蒙圈吧</li>
<li>左边的写作区的配色是暗色，没有可选性（难道根据时间换白色和黑色主题？）</li>
<li>不支持流程图等高级功能</li>
</ul>
<p>总的来说，基本功能都是有的，界面比较干净，这个是优点也是缺点了，相对而言，更适合把<code>MarkDown</code>语法熟记于心的人。</p>
<p>最后，来个配图看看写作界面：</p>
<p><img src="http://ac-mhke0kuv.clouddn.com/bcb599449a6de0393bcc.png" alt=""></p>
<blockquote>
<p><strong>PS</strong>：你可以通过下面的方式和我联系</p>
<ul>
<li>微博：<a href="http://weibo.com/zyansen" target="_blank" rel="external">cafeting</a></li>
<li>Github： <a href="https://github.com/likfe" target="_blank" rel="external">likfe</a></li>
<li>CSDN：<a href="http://blog.csdn.net/ys743276112" target="_blank" rel="external">他叫自己Mr.张</a> </li>
</ul>
</blockquote>
]]></content>
      
        
        <tags>
            
            <tag> Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android必知必会-Android Studio下配置和使用Lambda]]></title>
      <url>/2016/07/06/android-setting-lamdba/</url>
      <content type="html"><![CDATA[<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>和朋友讨论 <code>JAVA8</code> 的新特性，聊到<code>Lambda</code>，正好在掘金上看到一篇相关的文章，结合资料，作一个总结，特别是记录下实际使用中遇到的问题。</p>
<h3 id="什么是Lambda表达式"><a href="#什么是Lambda表达式" class="headerlink" title="什么是Lambda表达式"></a>什么是Lambda表达式</h3><blockquote>
<p>lambda表达式，它将允许我们将行为传到函数里。在Java 8之前，如果想将行为传入函数，仅有的选择就是匿名类，需要6行代码。而定义行为最重要的那行代码，却混在中间不够突出。Lambda表达式取代了匿名类，取消了模板，允许用函数式风格编写代码。这样有时可读性更好，表达更清晰。</p>
<p>— Java8 lambda表达式10个示例</p>
</blockquote>
<a id="more"></a>
<p>阅读完上面的文字估计也不是特别明白，对于我们日常开发Android，就是简化了匿名函数的使用，可以简单通过下面的示例来感受一下，如果你有更深的兴趣，文末有更多搜集的资料供你阅读。</p>
<h3 id="Lamdba示例"><a href="#Lamdba示例" class="headerlink" title="Lamdba示例"></a>Lamdba示例</h3><h4 id="用lambda表达式实现Runnable"><a href="#用lambda表达式实现Runnable" class="headerlink" title="用lambda表达式实现Runnable"></a>用lambda表达式实现Runnable</h4><p>使用lambda表达式可以替换匿名类，而实现<code>Runnable</code>接口是匿名类的最好示例。Java 8之前的<code>runnable</code>实现方法，需要4行代码，而使用<code>lambda</code>表达式只需要一行代码。只需要用<code>() -&gt; {}</code>代码块替代整个匿名类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Java 8之前：</span></div><div class="line"><span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">    	System.out.println(<span class="string">"在Java8之前, 需要写很多代码"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;).start();</div><div class="line"></div><div class="line"><span class="comment">//Java 8方式：</span></div><div class="line"><span class="keyword">new</span> Thread( () -&gt; System.out.println(<span class="string">"使用Java8, Lambda表达式一目了然"</span>) ).start();</div></pre></td></tr></table></figure>
<p>输出：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">在Java8之前, 需要写很多代码</div><div class="line">使用Java8, Lambda表达式一目了然</div></pre></td></tr></table></figure></p>
<p>这个例子展示了Java 8 lambda表达式的语法，可以使用<code>lambda</code>写出如下代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">(params) -&gt; expression</div><div class="line">(params) -&gt; statement</div><div class="line">(params) -&gt; &#123; statements &#125;</div></pre></td></tr></table></figure></p>
<p>例如，如果你的方法不对参数进行修改、重写，只是在控制台打印点东西的话，那么可以这样写：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">() -&gt; System.out.println(<span class="string">"Hello World"</span>);</div></pre></td></tr></table></figure></p>
<p>如果你的方法接收两个参数，那么可以写成如下这样：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(int a, int b) -&gt; a + b</div></pre></td></tr></table></figure></p>
<h4 id="使用lambda表达式进行事件处理"><a href="#使用lambda表达式进行事件处理" class="headerlink" title="使用lambda表达式进行事件处理"></a>使用lambda表达式进行事件处理</h4><p>在Android日常开发中，我们常常会设置各种事件，比如<code>setOnClickListener</code>、<code>setOnItemClickListener</code>等等，下面对比下前后的写法变化：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//之前</span></div><div class="line">viewA.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">            	<span class="comment">//Do something</span></div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line"><span class="comment">//使用lambda</span></div><div class="line">viewA.setOnClickListener(v -&gt; &#123;</div><div class="line">  <span class="comment">//Do something</span></div><div class="line">&#125;);</div><div class="line"><span class="comment">//或者</span></div><div class="line">viewA.setOnClickListener(View v -&gt; &#123;</div><div class="line">  <span class="comment">//Do something</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>这样一对比是不是简洁很多？那么对于多个参数的<code>setOnItemClickListener</code>怎么写呢？</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//之前</span></div><div class="line">xxxListView.setOnItemClickListener(<span class="keyword">new</span> AdapterView.OnItemClickListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onItemClick</span><span class="params">(AdapterView&lt;?&gt; parent, View view, <span class="keyword">int</span> position, <span class="keyword">long</span> id)</span> </span>&#123;</div><div class="line">                <span class="comment">//Do something</span></div><div class="line">            &#125;</div><div class="line">&#125;);</div><div class="line"><span class="comment">//使用lambda后</span></div><div class="line">xxxListView.setOnItemClickListener((parent,view,position,id)-&gt;&#123;</div><div class="line">	<span class="comment">//Do something</span></div><div class="line">&#125;);</div><div class="line"><span class="comment">//或者</span></div><div class="line">xxxListView.setOnItemClickListener((AdapterView&lt;?&gt; parent, View view, <span class="keyword">int</span> position, <span class="keyword">long</span> id)-&gt;&#123;</div><div class="line">	<span class="comment">//Do something</span></div><div class="line">&#125;);</div><div class="line"><span class="comment">//甚至</span></div><div class="line">xxxListView.setOnItemClickListener((a,b,c,d)-&gt;&#123;</div><div class="line">	<span class="comment">//Do something</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>以上两种例子大概是日常Android开发中最为常用的，更多示例请访问 ：<a href="http://www.importnew.com/16436.html" target="_blank" rel="external">Java8 lambda表达式10个示例</a></p>
<h2 id="启用Lambda"><a href="#启用Lambda" class="headerlink" title="启用Lambda"></a>启用Lambda</h2><p>启用<code>Lamdba</code>目前有两种方式，一个是使用Google官方的，一个是使用第三方Java8兼容插件，<strong>推荐使用第三方兼容插件</strong> 。</p>
<p>基本要求如下：</p>
<ul>
<li>Android Studio 2.1+</li>
<li>安装好 JAVA 8</li>
</ul>
<h3 id="方式一：Google官方方式"><a href="#方式一：Google官方方式" class="headerlink" title="方式一：Google官方方式"></a>方式一：Google官方方式</h3><blockquote>
<p>要使用新的 Java 8 语言功能，还需使用新的 Jack 工具链。新的 Android 工具链将 Java 源语言编译成 Android 可读取的 Dalvik 可执行文件字节码，且有其自己的 .jack 库格式，在一个工具中提供了大多数工具链功能：重新打包、压缩、模糊化以及 Dalvik 可执行文件分包。</p>
</blockquote>
<p>以下是构建 Android Dalvik 可执行文件可用的两种工具链的对比：</p>
<p>旧版 javac 工具链：<br><code>javac (.java --&gt; .class) --&gt; dx (.class --&gt; .dex)</code><br>新版 Jack 工具链：<br><code>Jack (.java --&gt; .jack --&gt; .dex)</code><br><strong>配置 Gradle</strong><br>如需为您的项目启用 Java 8 语言功能和 Jack，请在模块层级的 build.gradle 文件中输入以下内容：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">android &#123;</div><div class="line">  ...</div><div class="line">  defaultConfig &#123;</div><div class="line">    ...</div><div class="line">    jackOptions &#123;</div><div class="line">      enabled <span class="literal">true</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  compileOptions &#123;</div><div class="line">    sourceCompatibility JavaVersion.VERSION_1_8</div><div class="line">    targetCompatibility JavaVersion.VERSION_1_8</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>已知问题</strong><br>Instant Run 目前不能用于 Jack，在使用新的工具链时将被禁用。</p>
<blockquote>
<p><a href="https://developer.android.com/preview/j8-jack.html#configuration" target="_blank" rel="external">Java 8 语言功能</a></p>
</blockquote>
<h3 id="方式二：使用第三方Java8兼容插件"><a href="#方式二：使用第三方Java8兼容插件" class="headerlink" title="方式二：使用第三方Java8兼容插件"></a>方式二：使用第三方Java8兼容插件</h3><p>下面是插件的<code>ReadMe</code>的配置：添加下面的内容到项目的<code>build.gradle</code>文件中</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">buildscript &#123;</div><div class="line">  repositories &#123;</div><div class="line">     mavenCentral()</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  dependencies &#123;</div><div class="line">     classpath <span class="string">'me.tatarka:gradle-retrolambda:3.2.5'</span></div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// Required because retrolambda is on maven central</span></div><div class="line">repositories &#123;</div><div class="line">  mavenCentral()</div><div class="line">&#125;</div><div class="line"></div><div class="line">apply <span class="string">plugin:</span> <span class="string">'com.android.application'</span> <span class="comment">//or apply plugin: 'java'</span></div><div class="line">apply <span class="string">plugin:</span> <span class="string">'me.tatarka.retrolambda'</span></div></pre></td></tr></table></figure>
<p>在本人的项目中，是如下配置，可以避免很多不必要的错误：</p>
<p><code>build.gradle</code>文件在项目根目录有一个，在Module下也有一个：</p>
<blockquote>
<p>/build.gradle</p>
</blockquote>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">buildscript &#123;</div><div class="line">    repositories &#123;</div><div class="line">    	jcenter()</div><div class="line">        mavenCentral()</div><div class="line">    &#125;</div><div class="line">    dependencies &#123;</div><div class="line">        classpath <span class="string">'com.android.tools.build:gradle:2.1.2'</span></div><div class="line">        classpath <span class="string">'me.tatarka:gradle-retrolambda:3.2.5'</span></div><div class="line">        classpath <span class="string">'me.tatarka.retrolambda.projectlombok:lombok.ast:0.2.3.a2'</span></div><div class="line">    &#125;</div><div class="line">    configurations.classpath.exclude <span class="string">group:</span> <span class="string">'com.android.tools.external.lombok'</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">allprojects &#123;</div><div class="line">    repositories &#123;</div><div class="line">        jcenter()</div><div class="line">        mavenCentral()</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>/app/build.gradle</p>
</blockquote>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">apply <span class="string">plugin:</span> <span class="string">'com.android.application'</span></div><div class="line">apply <span class="string">plugin:</span> <span class="string">'me.tatarka.retrolambda'</span></div><div class="line"></div><div class="line">android &#123;</div><div class="line">	...</div><div class="line">	compileOptions &#123;</div><div class="line">        sourceCompatibility JavaVersion.VERSION_1_8</div><div class="line">        targetCompatibility JavaVersion.VERSION_1_8</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>可以看到我在使用中多了<a href="https://github.com/evant/android-retrolambda-lombok" target="_blank" rel="external">几个配置</a>，不过都是在这个插件的<code>issue</code>里查到的。建议仔细阅读下<a href="https://github.com/evant/gradle-retrolambda" target="_blank" rel="external">配置说明</a> ，可以适应一些实际项目中的一些特别需求。</p>
<h2 id="常见Error及解决方式"><a href="#常见Error及解决方式" class="headerlink" title="常见Error及解决方式"></a>常见Error及解决方式</h2><h3 id="Couldnot-find-property-‘options’-on-task-‘-app-compileDebugJavaWithJack’"><a href="#Couldnot-find-property-‘options’-on-task-‘-app-compileDebugJavaWithJack’" class="headerlink" title="Couldnot find property ‘options’ on task ‘:app:compileDebugJavaWithJack’."></a>Couldnot find property ‘options’ on task ‘:app:compileDebugJavaWithJack’.</h3><p><strong>原因</strong>：使用Google官方的方式有一定的兼容性，使用Jack时不能同时使用APT，如果使用butterknife、Dagger等使用了APT的注解框架就不行了</p>
<p><strong>解决方案</strong>：使用retrolambda的兼容插件的方式启用lambda</p>
<h3 id="Doesn’t-seem-to-correctly-use-modified-lombok-version"><a href="#Doesn’t-seem-to-correctly-use-modified-lombok-version" class="headerlink" title="Doesn’t seem to correctly use modified lombok version"></a>Doesn’t seem to correctly use modified lombok version</h3><p><strong>原因</strong>：<a href="https://github.com/evant/android-retrolambda-lombok/issues/4" target="_blank" rel="external">参见这里</a></p>
<p><strong>解决方案</strong>：按照我上面写的就不会出现这个问题了。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>对于想尝鲜的的开发者，启用Lamdba是个不错的选择，毕竟这个东西会慢慢普及的。下面是一些为想了解更多Lamdba使用方法的朋友搜集的资料以及本文参考的文章：</p>
<ul>
<li><a href="http://www.jianshu.com/p/5fc2b3362702" target="_blank" rel="external">jdk1.8新特性之lambda表达式及在Android Studio中的使用</a></li>
<li><a href="http://www.importnew.com/16436.html" target="_blank" rel="external">Java8 lambda表达式10个示例</a></li>
<li><a href="http://www.importnew.com/10360.html" target="_blank" rel="external">Java 8简明教程</a></li>
<li><a href="http://blog.csdn.net/yuhanghate/article/details/51544201" target="_blank" rel="external">Error:Could not find property ‘options’ on task ‘:app:compileDebugJavaWithJack’.</a></li>
<li><a href="https://github.com/evant/android-retrolambda-lombok/issues/4" target="_blank" rel="external">Doesn’t seem to correctly use modified lombok version</a></li>
<li><a href="https://github.com/evant/gradle-retrolambda" target="_blank" rel="external">retrolambda插件</a></li>
</ul>
<blockquote>
<p><strong>PS</strong>：你可以通过下面的方式和我联系</p>
<ul>
<li>微博：<a href="http://weibo.com/zyansen" target="_blank" rel="external">cafeting</a></li>
<li>Github： <a href="https://github.com/likfe" target="_blank" rel="external">likfe</a></li>
<li>CSDN：<a href="http://blog.csdn.net/ys743276112" target="_blank" rel="external">他叫自己Mr.张</a> </li>
</ul>
</blockquote>
]]></content>
      
        
        <tags>
            
            <tag> Android </tag>
            
            <tag> Lambda </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android 开发指南-0]]></title>
      <url>/2016/06/28/androidTutorials-0/</url>
      <content type="html"><![CDATA[<p>无意间发现一个网站，主打IOS方面的教程，然而作为一个Android开发者，我就找了下网站里有没有Android的教程，还真有，这里就翻译一下。</p>
<blockquote>
<p>翻译目标教程：<a href="https://www.raywenderlich.com/category/android" target="_blank" rel="external">https://www.raywenderlich.com/category/android</a></p>
</blockquote>
<h2 id="Android-开发指南"><a href="#Android-开发指南" class="headerlink" title="Android 开发指南"></a>Android 开发指南</h2><p>想用 <code>Java</code> 来开发 <code>Android APP</code> 吗？<br>看看我们收集的超过15免费安卓开发教程，用覆盖所有你知道的知识来开始!</p>
<blockquote>
<p>注意:网站所有的Android教程使用Java。如果您是初次接触Java，一定要先读一本Java主题的书。</p>
</blockquote>
<a id="more"></a>
<h3 id="Getting-Started-开始"><a href="#Getting-Started-开始" class="headerlink" title="Getting Started 开始"></a>Getting Started 开始</h3><p>开始的最好方法是通过学习我们的<a href="https://www.raywenderlich.com/120177/beginning-android-development-tutorial-installing-android-studio" target="_blank" rel="external">开始Android开发</a>系列教程。<br>如果你需要快速学习Java，看看我们的 <a href="https://www.raywenderlich.com/110452/java-for-android" target="_blank" rel="external">Java For Android 教程</a>和<a href="https://www.raywenderlich.com/119175/java-for-android-cheat-sheet-and-quick-reference" target="_blank" rel="external">cheat sheet 备忘录</a>。</p>
<ul>
<li><a href="https://www.raywenderlich.com/110452/java-for-android" target="_blank" rel="external">Java For Android</a></li>
</ul>
<ul>
<li><a href="https://www.raywenderlich.com/119175/java-for-android-cheat-sheet-and-quick-reference" target="_blank" rel="external">Java for Android 备忘录和速记</a></li>
</ul>
<ul>
<li><a href="https://www.raywenderlich.com/120177/beginning-android-development-tutorial-installing-android-studio" target="_blank" rel="external">开始Android开发教程: 安装 Android Studio</a></li>
</ul>
<ul>
<li><a href="https://www.raywenderlich.com/120508/beginning-android-development-tutorial-android-studio" target="_blank" rel="external">开始Android开发教程:介绍 Android Studio</a></li>
</ul>
<h3 id="Core-Concepts-核心概念"><a href="#Core-Concepts-核心概念" class="headerlink" title="Core Concepts 核心概念"></a>Core Concepts 核心概念</h3><p>一旦你已经学习了基础知识，你应该了解Android开发所需要知道的一些核心概念，如<code>activities</code>（活动）、<code>fragments</code> （片段）,<code>intents</code> （意图）,一些重要的设计模式。</p>
<ul>
<li><a href="https://www.raywenderlich.com/103044/android-intents-tutorial" target="_blank" rel="external">Android: Intents 教程</a></li>
</ul>
<ul>
<li><a href="https://www.raywenderlich.com/109843/common-design-patterns-for-android" target="_blank" rel="external">Android 常见的设计模式</a></li>
</ul>
<ul>
<li><a href="https://www.raywenderlich.com/116580/introduction-to-android-activities-tutorial" target="_blank" rel="external">介绍 Android Activities 的教程</a></li>
</ul>
<ul>
<li><a href="https://www.raywenderlich.com/117838/introduction-to-android-fragments-tutorial" target="_blank" rel="external">介绍 Android Fragments 的教程</a></li>
</ul>
<h3 id="User-Interface-用户界面"><a href="#User-Interface-用户界面" class="headerlink" title="User Interface 用户界面"></a>User Interface 用户界面</h3><p>创建一个Android应用的一个重要组成部分是创建一个用户界面。在本节中,您将学习如何创建用户界面外观和了解各种屏幕尺寸。</p>
<ul>
<li><a href="https://www.raywenderlich.com/103367/material-design" target="_blank" rel="external">Android: Material Design 介绍</a></li>
</ul>
<ul>
<li><a href="https://www.raywenderlich.com/114066/adaptive-ui-android-tutorial" target="_blank" rel="external">Adaptive UI in Android Tutorial 自适应界面</a></li>
</ul>
<ul>
<li><a href="https://www.raywenderlich.com/124438/android-listview-tutorial" target="_blank" rel="external">Android ListView 教程</a></li>
</ul>
<ul>
<li><a href="https://www.raywenderlich.com/126528/android-recyclerview-tutorial" target="_blank" rel="external">Android RecyclerView 教程</a></li>
</ul>
<h3 id="其他-Android-教程"><a href="#其他-Android-教程" class="headerlink" title="其他 Android 教程"></a>其他 Android 教程</h3><p>别急，还有更多！在本节中,您将学习如何使用不同的Android SDK版本，如何分发你的应用程序到Android应用程序商店,等等。</p>
<ul>
<li><a href="https://www.raywenderlich.com/103540/geofences-googleapiclient" target="_blank" rel="external">Geofences on Android with GoogleApiClient</a></li>
</ul>
<ul>
<li><a href="https://www.raywenderlich.com/118966/android-sdk-versions-tutorial" target="_blank" rel="external">Android SDK 版本教程</a></li>
</ul>
<ul>
<li><a href="https://www.raywenderlich.com/122114/android-app-distribution-tutorial-zero-google-play-store" target="_blank" rel="external">Android App 分发教程: 从零到 Google Play Store</a></li>
</ul>
<ul>
<li><a href="https://www.raywenderlich.com/124936/whats-new-android-studio-2-0" target="_blank" rel="external">Android Studio 2.0 有什么新东西？</a></li>
</ul>
<p>后续内容翻译中…</p>
<blockquote>
<p><strong>PS</strong>：你可以通过下面的方式和我联系</p>
<ul>
<li>微博：<a href="http://weibo.com/zyansen" target="_blank" rel="external">cafeting</a></li>
<li>Github： <a href="https://github.com/likfe" target="_blank" rel="external">likfe</a></li>
<li>CSDN：<a href="http://blog.csdn.net/ys743276112" target="_blank" rel="external">他叫自己Mr.张</a> </li>
</ul>
</blockquote>
]]></content>
      
        
        <tags>
            
            <tag> Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android必知必会-Android Studio修改包名]]></title>
      <url>/2016/06/15/android-studio-rename-package/</url>
      <content type="html"><![CDATA[<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>公司做相似产品较多，一般都是以某个产品为基础修改，逐步替换设计图的切图。这个就会导致需要经常为Copy的项目修改包名。<br>这里是参考一些网上的说法，结合自身实战经验加以完善，特此分享给同行们，避免不必要的弯路。</p>
<a id="more"></a>
<h2 id="Android-Studio修改包名"><a href="#Android-Studio修改包名" class="headerlink" title="Android Studio修改包名"></a>Android Studio修改包名</h2><h3 id="1-修改包显示方式"><a href="#1-修改包显示方式" class="headerlink" title="1.修改包显示方式"></a>1.修改包显示方式</h3><p>如下图所示：<br><img src="http://img.blog.csdn.net/20160615174836929" alt="这里写图片描述"></p>
<p>通过修改包显示方式，我们可以更方便的修改包名。</p>
<h3 id="2-修改包名"><a href="#2-修改包名" class="headerlink" title="2.修改包名"></a>2.修改包名</h3><p>经过1中的操作，我们可以随意修改包的某个节点</p>
<ul>
<li>选中所要修改包的节点</li>
<li>右键后选中-&gt;<code>Refactor</code>-&gt;<code>Rename</code></li>
<li>在弹窗里输入要修改成什么名字，确认</li>
<li>在弹窗里选择 修改<code>package</code></li>
</ul>
<h3 id="3-后续操作"><a href="#3-后续操作" class="headerlink" title="3.后续操作"></a>3.后续操作</h3><ol>
<li>修改当前<code>Module</code>的<code>build.gradle</code>文件中的<code>applicationId</code>,改为跟你的包名一致；</li>
<li>修改当前<code>Module</code>的<code>AndroidManifest.xml</code>文件中的<code>manifest</code>节点里的<code>package</code>属性值，改为跟你的包名一致。</li>
</ol>
<p>以上两个后续操作缺一不可，否则会造成很多奇特的Bug，比如<code>Id</code>没有错误且存在的情况下，提示找不到<code>id</code>；还有找不到资源、某些<code>Activity</code> 无法启动等等的Bug。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>以上「3.后续操作」里的第二操作是很多人都容易忽略的地方，不修改的话一时间也不会出现问题，如果忽略里，以后遇到无法解决的Bug后可能需要很久才会意识到<code>AndroidManifest.xml</code> 包名的问题。</p>
<blockquote>
<p><strong>PS</strong>：你可以通过下面的方式和我联系</p>
<ul>
<li>微博：<a href="http://weibo.com/zyansen" target="_blank" rel="external">cafeting</a></li>
<li>Github： <a href="https://github.com/likfe" target="_blank" rel="external">likfe</a></li>
<li>CSDN：<a href="http://blog.csdn.net/ys743276112" target="_blank" rel="external">他叫自己Mr.张</a> </li>
</ul>
</blockquote>
]]></content>
      
        
        <tags>
            
            <tag> Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[MAMP显示文件列表]]></title>
      <url>/2016/06/14/mamp-list-file/</url>
      <content type="html"><![CDATA[<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>MAMP是Mac下的一个PHP+Nginx+MySQL的集成环境，支持多站点，不同版本PHP。<br>今天有人请教MAMP如何显示文件列表的问题，这里记录一下。</p>
<a id="more"></a>
<h3 id="知识补充"><a href="#知识补充" class="headerlink" title="知识补充"></a>知识补充</h3><p>一个网站为了安全考虑，默认是禁止访问目录下的文件列表的。<br>当你请求一个目录时：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">st=&gt;start: 开始</div><div class="line">e=&gt;end: 结束</div><div class="line"></div><div class="line">cond1=&gt;condition: 是否存在index文件列表里的文件？</div><div class="line">cond2=&gt;condition: 是否允许显示文件列表？</div><div class="line">cond3=&gt;condition: 是否指定了404页面？</div><div class="line"></div><div class="line">op1=&gt;operation: 显示默认的文件</div><div class="line">op2=&gt;operation: 显示文件列表</div><div class="line">op3=&gt;operation: 显示指定的404页面</div><div class="line">op4=&gt;operation: 显示服务器级的404错误</div><div class="line"></div><div class="line">st-&gt;cond1-&gt;e</div><div class="line">cond1(yes)-&gt;op1-&gt;e</div><div class="line">cond1(no)-&gt;cond2(bottom)</div><div class="line"></div><div class="line">cond2(yes)-&gt;op2-&gt;e</div><div class="line">cond2(no)-&gt;cond3(right)</div><div class="line"></div><div class="line">cond3(yes)-&gt;op3-&gt;e</div><div class="line">cond3(no)-&gt;op4-&gt;e</div></pre></td></tr></table></figure>
<ul>
<li>默认的index文件列表（一般是index.html,index.htm,index.php）</li>
<li>网站配置里404相关说明，可以指定404时访问的文件<h2 id="配置MAMP"><a href="#配置MAMP" class="headerlink" title="配置MAMP"></a>配置MAMP</h2>如图所示：<br><img src="http://img.blog.csdn.net/20160614185258257" alt="这里写图片描述"></li>
</ul>
<ol>
<li>勾选 Indexs</li>
<li>设置Directory index的值为<code>*</code></li>
</ol>
<p>这里有配置Nginx的配置文件开启访问文件列表的方式：</p>
<blockquote>
<p><a href="http://blog.csdn.net/testcs_dn/article/details/39644147" target="_blank" rel="external">http://blog.csdn.net/testcs_dn/article/details/39644147</a></p>
</blockquote>
<p>PS:</p>
<blockquote>
<p>你可以关注的我 <a href="https://github.com/likfe" target="_blank" rel="external">Github</a>、<a href="http://blog.csdn.net/ys743276112" target="_blank" rel="external">CSDN</a> 和 <a href="http://weibo.com/zyansen" target="_blank" rel="external">微博</a></p>
</blockquote>
]]></content>
      
        
        <tags>
            
            <tag> PHP </tag>
            
            <tag> MAMP </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[AMH 5.X下安装 Flarum]]></title>
      <url>/2016/06/12/amh-install-flarum/</url>
      <content type="html"><![CDATA[<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>最近无意间发现几个开源软件的<code>Bug反馈系统</code>使用的是<strong>Flarum</strong>，Flarum是一款优雅简洁论坛软件，看起来还是相当不错的，一时抑制不住想要尝试一下。</p>
<p>由于服务器使用的是AMH集成环境，它相对于通常的直接安装环境有很多的区别，这导致安装过程中产生里不少问题。这里做个总结。</p>
<h3 id="Flarum"><a href="#Flarum" class="headerlink" title="Flarum"></a>Flarum</h3><p>Flarum 是一款优雅简洁论坛软件，让在线交流变得更加轻松愉快。</p>
<a id="more"></a>
<ul>
<li><a href="https://discuss.flarum.org" target="_blank" rel="external">官网</a></li>
<li><a href="http://www.flarum.org.cn" target="_blank" rel="external">中文站</a></li>
</ul>
<h3 id="AMH"><a href="#AMH" class="headerlink" title="AMH"></a>AMH</h3><p><a href="https://amh.sh" target="_blank" rel="external">AMH</a> 是国内首个开源的主机面板，AMH 支持用户自由弹性组建运行环境与切换环境，您可以下载安装不同版本的WEB服务器、数据库、脚本软件自由组合创建您需要的运行环境。</p>
<p>我使用的是<code>AMH5.X</code>的付费版本，<code>4.X</code>的免费版本也可以参考本教程。</p>
<p>目前服务器环境是LNMP：</p>
<blockquote>
<p>CentOS-6.6 64位</p>
<p>lnmp-2.5</p>
<p>mysql-generic-5.5.40</p>
<p>nginx-generic-1.6.0</p>
<p>php-7.0</p>
</blockquote>
<h3 id="Composer"><a href="#Composer" class="headerlink" title="Composer"></a>Composer</h3><p>Composer是 PHP 用来管理依赖（dependency）关系的工具。你可以在自己的项目中声明所依赖的外部工具库（libraries），Composer 会帮你安装这些依赖的库文件。</p>
<ul>
<li><a href="https://getcomposer.org" target="_blank" rel="external">官网</a></li>
<li><a href="http://www.phpcomposer.com" target="_blank" rel="external">中文站</a></li>
</ul>
<p>Composer是安装Flarum的必要工具。</p>
<h2 id="安装PHP扩展"><a href="#安装PHP扩展" class="headerlink" title="安装PHP扩展"></a>安装PHP扩展</h2><p>这里需要安装Flarum所需要的必要的PHP扩展，先看下系统需求：</p>
<blockquote>
<p>Flarum 系统需求</p>
<p>服务器： Apache (需要支持 mod_rewrite)、Nginx、Lighttpd<br>PHP 5.5+，需要开启的扩展：mbstring, pdo_mysql, openssl, json, gd, dom, fileinfo<br>MySQL 5.5+</p>
</blockquote>
<p><strong>特别注意：</strong>PHP是5.5+、MySQL 5.5+，如果版本过低可以使用AMH安装更高版本，AMH支持多版本PHP和MySQL。</p>
<h3 id="流程："><a href="#流程：" class="headerlink" title="流程："></a>流程：</h3><ol>
<li>登录到AMH的管理面板</li>
<li>软件下载 &gt; fileinfo-1.0 &gt; 下载并安装到对应的环境</li>
<li>软件下载 &gt; mcrypt-1.0 &gt; 下载并安装到对应的环境</li>
<li>软件下载 &gt; pdo_mysql-1.0 &gt; 下载并安装到对应的环境</li>
</ol>
<h2 id="安装Composer"><a href="#安装Composer" class="headerlink" title="安装Composer"></a>安装Composer</h2><p>Flarum官网的文档要求使用Composer命令行的方式进行安装，所以需要先安装Composer：</p>
<p>使用SSH方式登录服务器之后：执行</p>
<p><code>curl -sS https://getcomposer.org/installer | php</code></p>
<blockquote>
<p>注意： 如果上述方法由于某些原因失败了，你还可以通过 php &gt;下载安装器：</p>
</blockquote>
<p><code>php -r &quot;readfile(&#39;https://getcomposer.org/installer&#39;);&quot; | php</code></p>
<p>这里你可能会遇到 <code>-bash php command not found</code>的错误提示，请参考下文的<strong>问题集锦</strong> 。</p>
<p>PS：<a href="http://docs.phpcomposer.com/00-intro.html" target="_blank" rel="external">安装Composer文档</a></p>
<h2 id="安装Flarum"><a href="#安装Flarum" class="headerlink" title="安装Flarum"></a>安装Flarum</h2><p>环境搭建好了，这里讲解安装Flarum的过程</p>
<blockquote>
<p><a href="http://flarum.org/docs/installation/" target="_blank" rel="external">官方安装文档</a></p>
</blockquote>
<ol>
<li>在AMH控制面板下创建好一个站点（这里指定为<code>A站点</code>），并做好域名解析，确认可以正常访问</li>
<li>删除<code>A站点</code>下的所有文件</li>
<li>创建好一个Flarum使用的MySQL数据库和对应的用户</li>
<li>SSH下进入<code>A站点</code>根目录（<code>cd /home/wwwroot/环境/domain/主域名/web/</code>）</li>
<li>执行安装命令：<code>composer create-project flarum/flarum . --stability=beta</code></li>
<li>配置<code>A站点的Nginx</code>配置文件（<code>/home/wwwroot/环境/vhost/主域名.conf</code>）：参见<a href="http://flarum.org/docs/installation/" target="_blank" rel="external">官方安装文档</a>。特别注意：<code>location ~* \.php$</code>下的参数以自动生成的为准，还需要删除自动生成的ErrorPage的配置信息。</li>
<li>重载Nginx并访问<code>A站点</code>，填写相关安装信息。（遇到文件读写权限问题，查看下文问题集锦）</li>
</ol>
<h3 id="安装Flarum中文语言包"><a href="#安装Flarum中文语言包" class="headerlink" title="安装Flarum中文语言包"></a>安装Flarum中文语言包</h3><p>为了便于操作，我们安装中文语言包来进行默认语言的切换。</p>
<p>尝试了几种安装方式，这里推荐使用命令行安装：</p>
<ol>
<li>SSH下进入<code>A站点</code>根目录</li>
<li>执行<code>composer require jsthon/flarum-ext-simplified-chinese</code>即可</li>
<li>访问<code>A站点</code>，进入后台修改勾选中文扩展，并修改默认语言。</li>
</ol>
<blockquote>
<p>其他语言和扩展：<a href="https://discuss.flarum.org/d/1534-extension-list" target="_blank" rel="external">https://discuss.flarum.org/d/1534-extension-list</a></p>
</blockquote>
<h2 id="问题集锦"><a href="#问题集锦" class="headerlink" title="问题集锦"></a>问题集锦</h2><p>可能遇到的问题：</p>
<h3 id="bash-php-command-not-found"><a href="#bash-php-command-not-found" class="headerlink" title="-bash php command not found"></a>-bash php command not found</h3><p>Composer的安装和使用是使用的php-cli的方式，AMH支持多版本的PHP，环境变量里并未指定php-cli的版本，这里需要我们把指定版本的<a href="http://blog.csdn.net/ys743276112/article/details/51648243" target="_blank" rel="external">PHP加入到环境变量</a>里。</p>
<p>在<code>~/.bash_profile</code>里加入：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">PATH=<span class="variable">$PATH</span>:/usr/<span class="built_in">local</span>/php-版本/bin</div><div class="line"><span class="built_in">export</span> PATH</div></pre></td></tr></table></figure>
<p>保存修改后执行<code>source ~/.bash_profile</code>使得修改生效。</p>
<p>PS：如果你使用的是其他发行版的Linux，请自行搜索如何设置<code>PHP加入到环境变量</code> 。</p>
<h3 id="requires-ext-fileinfo-或者-request-for-intervention-image"><a href="#requires-ext-fileinfo-或者-request-for-intervention-image" class="headerlink" title="requires ext-fileinfo * 或者 request for intervention/image"></a>requires ext-fileinfo * 或者 request for intervention/image</h3><blockquote>
<p>参见：</p>
<ul>
<li><a href="http://stackoverflow.com/questions/24850136/i-have-ext-fileinfo-but-composer-says-it-is-missing" target="_blank" rel="external">http://stackoverflow.com/questions/24850136/i-have-ext-fileinfo-but-composer-says-it-is-missing</a></li>
<li><a href="http://amh.sh/bbs/post-6149-1-1.htm" target="_blank" rel="external">http://amh.sh/bbs/post-6149-1-1.htm</a></li>
</ul>
</blockquote>
<p>简单来说，就是咱们在AMH里安装的PHP扩展并没有影响到<code>php-cli</code>方式运行PHP的配置，需要我们手动同步一下配置：</p>
<p><code>cp /home/wwwroot/环境/etc/amh-php.ini /usr/local/php-版本/etc/php.ini</code></p>
<p>重载Nginx即可生效。</p>
<h3 id="Please-chmod-this-directory-to-0775"><a href="#Please-chmod-this-directory-to-0775" class="headerlink" title="Please chmod this directory to 0775"></a>Please chmod this directory to 0775</h3><p>当你访问通过composer安装好的<code>A站点</code>时，遇到里类似的权限读写问题，对于AMH环境，我们需要执行：</p>
<p><code>sudo chown www:www -R  /home/wwwroot/环境/domain/主域名/web</code></p>
<p>这里有一些讨论：</p>
<ul>
<li><a href="https://discuss.flarum.org/d/823-directorys-are-not-writable/46" target="_blank" rel="external">https://discuss.flarum.org/d/823-directorys-are-not-writable/46</a></li>
<li><a href="https://discuss.flarum.org/d/2209-directory-not-writable/3" target="_blank" rel="external">https://discuss.flarum.org/d/2209-directory-not-writable/3</a></li>
</ul>
<p>上面的讨论使用的用户组和AMH的不一样，AMH网站的用户组是<code>www</code>，结合实际情况才能真正解决问题。</p>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><p>查看我们的成果：<a href="http://forum.inkcode.cc" target="_blank" rel="external">Cafeting的论坛</a></p>
<blockquote>
<p><a href="http://flarum.org/docs/" target="_blank" rel="external">官方文档</a> 适应最新版的Flarum，推荐<br><a href="https://www.gitbook.com/book/justjavac/flarum" target="_blank" rel="external">中文文档</a> 较旧，有一定参考意义</p>
</blockquote>
<p>AMH集成环境相对于通常的直接安装环境有很多的区别，使用的时候务必要考虑到。</p>
<blockquote>
<p><strong>PS</strong>：你可以通过下面的方式和我联系</p>
<ul>
<li>微博：<a href="http://weibo.com/zyansen" target="_blank" rel="external">cafeting</a></li>
<li>Github： <a href="https://github.com/likfe" target="_blank" rel="external">likfe</a></li>
<li>CSDN：<a href="http://blog.csdn.net/ys743276112" target="_blank" rel="external">他叫自己Mr.张</a> </li>
</ul>
</blockquote>
]]></content>
      
        
        <tags>
            
            <tag> AMH </tag>
            
            <tag> Flarum </tag>
            
            <tag> PHP </tag>
            
            <tag> Composer </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android必知必会-带列表的地图POI周边搜索]]></title>
      <url>/2016/05/30/mapPoiSearch/</url>
      <content type="html"><![CDATA[<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>先看效果图：（以公司附近的国贸为中心点）</p>
<p><img src="http://mmmedia.qiniudn.com/2016-05-30_007D8133A7BD3AF58D7994F64FDDB8D9.gif" alt="2016-05-30_007D8133A7BD3AF58D7994F64FDDB8D9.gif"></p>
<p>上面是地图，下面是地理位置列表，有的只有地理位置列表（QQ动态的位置），这是个很常见的功能。它有个专门的叫法：<strong>POI周边搜索</strong>。</p>
<a id="more"></a>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p>这个效果实现起来其实很简单，不过需要你先阅读下地图的API，这里使用的是高德地图的Android SDK，SDK的配置这里不作讲解，文末会放一些链接供学习。</p>
<h3 id="思路："><a href="#思路：" class="headerlink" title="思路："></a>思路：</h3><ol>
<li>利用地图的定位功能，获取用户当前的位置</li>
<li>根据获得的位置信息调用POI搜索，获取位置列表</li>
<li>ListView展示位置列表</li>
<li>用户拖动地图，获取地图中心坐标的位置信息，并执行2~3的步骤</li>
</ol>
<h3 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h3><p><strong>Layout:</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">LinearLayout</span></span></div><div class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></span></div><div class="line"><span class="tag">    &gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">com.amap.api.maps2d.MapView</span></span></div><div class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/map_local"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"0dp"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_weight</span>=<span class="string">"2"</span>/&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">ListView</span></span></div><div class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/map_list"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"0dp"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_weight</span>=<span class="string">"3"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:divider</span>=<span class="string">"@color/space"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:dividerHeight</span>=<span class="string">"1dp"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:scrollbars</span>=<span class="string">"none"</span>/&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<p><strong>Activity:</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">New_LocalActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> <span class="keyword">implements</span> <span class="title">LocationSource</span>,</span></div><div class="line"><span class="class">        <span class="title">AMapLocationListener</span>, <span class="title">AMap</span>.<span class="title">OnCameraChangeListener</span>, <span class="title">PoiSearch</span>.<span class="title">OnPoiSearchListener</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@BindView</span>(R.id.map_local)</div><div class="line">    MapView mapView;</div><div class="line">    <span class="meta">@BindView</span>(R.id.map_list)</div><div class="line">    ListView mapList;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String KEY_LAT = <span class="string">"lat"</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String KEY_LNG = <span class="string">"lng"</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String KEY_DES = <span class="string">"des"</span>;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">private</span> AMapLocationClient mLocationClient;</div><div class="line">    <span class="keyword">private</span> LocationSource.OnLocationChangedListener mListener;</div><div class="line">    <span class="keyword">private</span> LatLng latlng;</div><div class="line">    <span class="keyword">private</span> String city;</div><div class="line">    <span class="keyword">private</span> AMap aMap;</div><div class="line">    <span class="keyword">private</span> String deepType = <span class="string">""</span>;<span class="comment">// poi搜索类型</span></div><div class="line">    <span class="keyword">private</span> PoiSearch.Query query;<span class="comment">// Poi查询条件类</span></div><div class="line">    <span class="keyword">private</span> PoiSearch poiSearch;</div><div class="line">    <span class="keyword">private</span> PoiResult poiResult; <span class="comment">// poi返回的结果</span></div><div class="line">    <span class="keyword">private</span> PoiOverlay poiOverlay;<span class="comment">// poi图层</span></div><div class="line">    <span class="keyword">private</span> List&lt;PoiItem&gt; poiItems;<span class="comment">// poi数据</span></div><div class="line"></div><div class="line">    <span class="keyword">private</span> PoiSearch_adapter adapter;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_new__local);</div><div class="line">        ButterKnife.bind(<span class="keyword">this</span>);</div><div class="line">        mapView.onCreate(savedInstanceState);</div><div class="line">        init();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (aMap == <span class="keyword">null</span>) &#123;</div><div class="line">            aMap = mapView.getMap();</div><div class="line">            aMap.setOnCameraChangeListener(<span class="keyword">this</span>);</div><div class="line">            setUpMap();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        deepType = <span class="string">"餐饮"</span>;<span class="comment">//这里以餐饮为例</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//-------- 定位 Start ------</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setUpMap</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (mLocationClient == <span class="keyword">null</span>) &#123;</div><div class="line">            mLocationClient = <span class="keyword">new</span> AMapLocationClient(getApplicationContext());</div><div class="line">            AMapLocationClientOption mLocationOption = <span class="keyword">new</span> AMapLocationClientOption();</div><div class="line">            <span class="comment">//设置定位监听</span></div><div class="line">            mLocationClient.setLocationListener(<span class="keyword">this</span>);</div><div class="line">            <span class="comment">//设置为高精度定位模式</span></div><div class="line">            mLocationOption.setOnceLocation(<span class="keyword">true</span>);</div><div class="line">            mLocationOption.setLocationMode(AMapLocationClientOption.AMapLocationMode.Hight_Accuracy);</div><div class="line">            <span class="comment">//设置定位参数</span></div><div class="line">            mLocationClient.setLocationOption(mLocationOption);</div><div class="line">            mLocationClient.startLocation();</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// 自定义系统定位小蓝点</span></div><div class="line">        MyLocationStyle myLocationStyle = <span class="keyword">new</span> MyLocationStyle();</div><div class="line">        myLocationStyle.myLocationIcon(BitmapDescriptorFactory</div><div class="line">                .fromResource(R.drawable.location_marker));<span class="comment">// 设置小蓝点的图标</span></div><div class="line">        myLocationStyle.strokeColor(Color.BLACK);<span class="comment">// 设置圆形的边框颜色</span></div><div class="line">        myLocationStyle.radiusFillColor(Color.argb(<span class="number">100</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">180</span>));<span class="comment">// 设置圆形的填充颜色</span></div><div class="line">        myLocationStyle.strokeWidth(<span class="number">1.0f</span>);<span class="comment">// 设置圆形的边框粗细</span></div><div class="line">        aMap.setMyLocationStyle(myLocationStyle);</div><div class="line">        aMap.setLocationSource(<span class="keyword">this</span>);<span class="comment">// 设置定位监听</span></div><div class="line">        aMap.getUiSettings().setMyLocationButtonEnabled(<span class="keyword">true</span>);<span class="comment">// 设置默认定位按钮是否显示</span></div><div class="line">        aMap.setMyLocationEnabled(<span class="keyword">true</span>);<span class="comment">// 设置为true表示显示定位层并可触发定位，false表示隐藏定位层并不可触发定位，默认是false</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 开始进行poi搜索</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doSearchQuery</span><span class="params">()</span> </span>&#123;</div><div class="line">        aMap.setOnMapClickListener(<span class="keyword">null</span>);<span class="comment">// 进行poi搜索时清除掉地图点击事件</span></div><div class="line">        <span class="keyword">int</span> currentPage = <span class="number">0</span>;</div><div class="line">        query = <span class="keyword">new</span> PoiSearch.Query(<span class="string">""</span>, deepType, city);<span class="comment">// 第一个参数表示搜索字符串，第二个参数表示poi搜索类型，第三个参数表示poi搜索区域（空字符串代表全国）</span></div><div class="line">        query.setPageSize(<span class="number">20</span>);<span class="comment">// 设置每页最多返回多少条poiitem</span></div><div class="line">        query.setPageNum(currentPage);<span class="comment">// 设置查第一页</span></div><div class="line">        LatLonPoint lp = <span class="keyword">new</span> LatLonPoint(latlng.latitude, latlng.longitude);</div><div class="line"></div><div class="line">        poiSearch = <span class="keyword">new</span> PoiSearch(<span class="keyword">this</span>, query);</div><div class="line">        poiSearch.setOnPoiSearchListener(<span class="keyword">this</span>);</div><div class="line">        poiSearch.setBound(<span class="keyword">new</span> PoiSearch.SearchBound(lp, <span class="number">5000</span>, <span class="keyword">true</span>));</div><div class="line">        <span class="comment">// 设置搜索区域为以lp点为圆心，其周围2000米范围</span></div><div class="line">        poiSearch.searchPOIAsyn();<span class="comment">// 异步搜索</span></div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onLocationChanged</span><span class="params">(AMapLocation aMapLocation)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (mListener != <span class="keyword">null</span> &amp;&amp; aMapLocation != <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">if</span> (aMapLocation.getErrorCode() == <span class="number">0</span>) &#123;</div><div class="line">                <span class="comment">// 显示我的位置</span></div><div class="line">                mListener.onLocationChanged(aMapLocation);</div><div class="line">                <span class="comment">//设置第一次焦点中心</span></div><div class="line">                latlng = <span class="keyword">new</span> LatLng(aMapLocation.getLatitude(), aMapLocation.getLongitude());</div><div class="line">                aMap.animateCamera(CameraUpdateFactory.newLatLngZoom(latlng, <span class="number">14</span>), <span class="number">1000</span>, <span class="keyword">null</span>);</div><div class="line">                city = aMapLocation.getProvince();</div><div class="line">                doSearchQuery();</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                String errText = <span class="string">"定位失败,"</span> + aMapLocation.getErrorCode() + <span class="string">": "</span> + aMapLocation.getErrorInfo();</div><div class="line">                Log.e(<span class="string">"AmapErr"</span>, errText);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">activate</span><span class="params">(OnLocationChangedListener listener)</span> </span>&#123;</div><div class="line">        mListener = listener;</div><div class="line">        mLocationClient.startLocation();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deactivate</span><span class="params">()</span> </span>&#123;</div><div class="line">        mListener = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">if</span> (mLocationClient != <span class="keyword">null</span>) &#123;</div><div class="line">            mLocationClient.stopLocation();</div><div class="line">            mLocationClient.onDestroy();</div><div class="line">        &#125;</div><div class="line">        mLocationClient = <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCameraChange</span><span class="params">(CameraPosition cameraPosition)</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCameraChangeFinish</span><span class="params">(CameraPosition cameraPosition)</span> </span>&#123;</div><div class="line">        latlng = cameraPosition.target;</div><div class="line">        aMap.clear();</div><div class="line">        aMap.addMarker(<span class="keyword">new</span> MarkerOptions().position(latlng));</div><div class="line">        doSearchQuery();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPoiSearched</span><span class="params">(PoiResult result, <span class="keyword">int</span> rCode)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (rCode == <span class="number">0</span>) &#123;</div><div class="line">            <span class="keyword">if</span> (result != <span class="keyword">null</span> &amp;&amp; result.getQuery() != <span class="keyword">null</span>) &#123;<span class="comment">// 搜索poi的结果</span></div><div class="line">                <span class="keyword">if</span> (result.getQuery().equals(query)) &#123;<span class="comment">// 是否是同一条</span></div><div class="line">                    poiResult = result;</div><div class="line">                    poiItems = poiResult.getPois();<span class="comment">// 取得第一页的poiitem数据，页数从数字0开始</span></div><div class="line">                    List&lt;SuggestionCity&gt; suggestionCities = poiResult</div><div class="line">                            .getSearchSuggestionCitys();</div><div class="line">                    <span class="keyword">if</span> (poiItems != <span class="keyword">null</span> &amp;&amp; poiItems.size() &gt; <span class="number">0</span>) &#123;</div><div class="line">                        adapter = <span class="keyword">new</span> PoiSearch_adapter(<span class="keyword">this</span>, poiItems);</div><div class="line">                        mapList.setAdapter(adapter);</div><div class="line">                        mapList.setOnItemClickListener(<span class="keyword">new</span> mOnItemClickListener());</div><div class="line"></div><div class="line">                      &#125;</div><div class="line">                    &#125;</div><div class="line">                    <span class="keyword">else</span> &#123;</div><div class="line">                        Logger.d(<span class="string">"无结果"</span>);</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                Logger.e(<span class="string">"无结果"</span>);</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (rCode == <span class="number">27</span>) &#123;</div><div class="line">            Logger.e(<span class="string">"error_network"</span>);</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (rCode == <span class="number">32</span>) &#123;</div><div class="line">            Logger.e(<span class="string">"error_key"</span>);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            Logger.e(<span class="string">"error_other："</span> + rCode);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPoiItemSearched</span><span class="params">(PoiItem poiItem, <span class="keyword">int</span> i)</span> </span>&#123;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//-------- 定位 End ------</span></div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onResume</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onResume();</div><div class="line">        mLocationClient.startLocation();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onPause</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onPause();</div><div class="line">        mLocationClient.stopLocation();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</div><div class="line">        mLocationClient.onDestroy();</div><div class="line">        <span class="keyword">super</span>.onDestroy();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">mOnItemClickListener</span> <span class="keyword">implements</span> <span class="title">AdapterView</span>.<span class="title">OnItemClickListener</span> </span>&#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onItemClick</span><span class="params">(AdapterView&lt;?&gt; parent, View view, <span class="keyword">int</span> position, <span class="keyword">long</span> id)</span> </span>&#123;</div><div class="line">            Intent intent = <span class="keyword">new</span> Intent();</div><div class="line">            intent.putExtra(KEY_LAT, poiItems.get(position).getLatLonPoint().getLatitude());</div><div class="line">            intent.putExtra(KEY_LNG, poiItems.get(position).getLatLonPoint().getLongitude());</div><div class="line">            intent.putExtra(KEY_DES, poiItems.get(position).getTitle());</div><div class="line">            setResult(RESULT_OK, intent);</div><div class="line">            finish();</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>示例中的Activity是使用<code>startActivityForResult</code>方式启动的，最后点击位置之后会返回点选的位置信息。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>我第一次准备实现上述的效果时，也是不知所措，因为还没有对地图API有比较全面的认识，后来看了不少资料，自己便结合了一下地图的功能点，实现了设计图中的效果。</p>
<p>下面是一些资料，初学者务必先学习基础API的应用：</p>
<ul>
<li><a href="http://lbs.amap.com" target="_blank" rel="external">高德开发者中心</a></li>
<li><a href="http://www.imooc.com/learn/339" target="_blank" rel="external">慕课网-如何使用高德Android SDK进行LBS的开发</a></li>
<li><a href="http://blog.csdn.net/ys743276112/article/details/51519223" target="_blank" rel="external">带列表的地图POI周边搜索</a></li>
</ul>
<p>如果你有什么问题，可以在博客上留言。</p>
<p>PS:</p>
<blockquote>
<p>你可以关注的我 <a href="https://github.com/likfe" target="_blank" rel="external">Github</a>、<a href="http://blog.csdn.net/ys743276112" target="_blank" rel="external">CSDN</a> 和 <a href="http://weibo.com/zyansen" target="_blank" rel="external">微博</a></p>
</blockquote>
]]></content>
      
        
        <tags>
            
            <tag> Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android必知必会-自定义Scrollbar样式]]></title>
      <url>/2016/05/16/diyScrollbar/</url>
      <content type="html"><![CDATA[<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>设计师给的设计图完全依照 IOS 的标准来的，导致很多细节的控件都得自己重写，最近的设计图中有显示滚动条，Android 默认的滚动条样式（带描边）和设计图格格不入，无奈，只好研究下自定义 Scrollbar 样式。这里稍微整理下。<br><a id="more"></a></p>
<h2 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h2><p>在<code>ListView</code>/<code>ScrollView</code>/<code>RecyclerView</code>中添加属性：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- 情况A ：垂直滚动条--&gt;</span></div><div class="line">android:scrollbars="vertical"</div><div class="line">android:scrollbarTrackVertical="@drawable/xxx_vertical_track"</div><div class="line">android:scrollbarThumbVertical="@drawable/xxx_vertical_thumb"</div><div class="line"><span class="comment">&lt;!-- 情况B ：水平滚动条--&gt;</span></div><div class="line">android:scrollbars="horizontal"</div><div class="line">android:scrollbarTrackHorizontal="@drawable/xxx_horizontal_track"</div><div class="line">android:scrollbarThumbHorizontal="@drawable/xxx_horizontal_thumb"</div><div class="line"></div><div class="line"><span class="comment">&lt;!-- 其他通用的属性 --&gt;</span></div><div class="line"><span class="comment">&lt;!-- 1.定义滚动条的样式和位置 --&gt;</span></div><div class="line">android:scrollbarStyle="outsideInset"</div><div class="line"><span class="comment">&lt;!-- 2.定义滚动条的大小，垂直时指宽度，水平时指高度 --&gt;</span></div><div class="line">android:scrollbarSize="4dp"</div></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th style="text-align:center">属性</th>
<th style="text-align:center">效果</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">scrollbarThumbVertical[Horizontal]</td>
<td style="text-align:center">短条</td>
</tr>
<tr>
<td style="text-align:center">scrollbarTrackVertical[Horizontal]</td>
<td style="text-align:center">长条，即背景</td>
</tr>
</tbody>
</table>
<p>即<code>scrollbaTrackxxx</code>，<code>scrollbarThumbxxx</code>自定义的 xml 文件，放在<code>Drawable</code>中，<code>track</code>是指长条，<code>thumb</code>是指短条，然后再 xml 中定义短条和长条的样式。</p>
<h3 id="需要注意"><a href="#需要注意" class="headerlink" title="需要注意"></a>需要注意</h3><p>其中，<code>scrollbaTrackxxx</code>、<code>scrollbarThumbxxx</code><strong>可以使用</strong>：</p>
<ul>
<li>Shape自定义 Drawable</li>
<li>图片</li>
<li><code>.9.png</code></li>
<li><code>@color/xxx</code>的方式使用颜色值</li>
</ul>
<p><strong>不可以</strong>直接使用<code>#xxxxxx</code>颜色值</p>
<h3 id="android-scrollbarStyle"><a href="#android-scrollbarStyle" class="headerlink" title="android:scrollbarStyle"></a>android:scrollbarStyle</h3><p> <code>android:scrollbarStyle</code>可以定义滚动条的样式和位置，可选值有<code>insideOverlay</code>、<code>insideInset</code>、<code>outsideOverlay</code>、<code>outsideInset</code>四种。</p>
<p>其中<code>inside</code>和<code>outside</code>分别表示是否在 view 的 padding 区域内，<code>overlay</code>和<code>inset</code>表示覆盖在 view 上或是插在 view 后面，所以四种值分别表示：</p>
<table>
<thead>
<tr>
<th style="text-align:center">属性值</th>
<th style="text-align:center">效果</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">insideOverlay</td>
<td style="text-align:center"><strong>默认值</strong>，表示在padding区域内并且覆盖在view上</td>
</tr>
<tr>
<td style="text-align:center">insideInset</td>
<td style="text-align:center">表示在padding区域内并且插入在view后面</td>
</tr>
<tr>
<td style="text-align:center">outsideOverlay</td>
<td style="text-align:center">表示在padding区域外并且覆盖在view上</td>
</tr>
<tr>
<td style="text-align:center">outsideInset</td>
<td style="text-align:center">表示在padding区域外并且插入在view后面</td>
</tr>
</tbody>
</table>
<h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><p>下面是两个Demo：</p>
<p>color:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">color</span> <span class="attr">name</span>=<span class="string">"red_square"</span>&gt;</span>#CCFF6464<span class="tag">&lt;/<span class="name">color</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">color</span> <span class="attr">name</span>=<span class="string">"transparent"</span>&gt;</span>#00000000<span class="tag">&lt;/<span class="name">color</span>&gt;</span></div></pre></td></tr></table></figure>
<p>drawable:scrollbar_vertical_thumb</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">shape</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 填充 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">solid</span> <span class="attr">android:color</span>=<span class="string">"#66000000"</span>/&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 圆角 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">corners</span> <span class="attr">android:radius</span>=<span class="string">"1dp"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">shape</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="Demo-1"><a href="#Demo-1" class="headerlink" title="Demo 1"></a>Demo 1</h3><p><strong>layout：</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">android:scrollbarStyle="outsideOverlay"</div><div class="line">android:scrollbarThumbVertical="@drawable/scrollbar_vertical_thumb"</div><div class="line"><span class="comment">&lt;!-- </span></div><div class="line"><span class="comment">scrollbarTrackVertical设为透明或者直接不设置即可</span></div><div class="line"><span class="comment">android:scrollbarTrackVertical="@color/transparent"</span></div><div class="line"><span class="comment">再次强调：scrollbarThumbVertical、scrollbarTrackVertical 不可以直接设置为颜色值,但可以使用@color的方式使用颜色值</span></div><div class="line"><span class="comment">--&gt;</span></div><div class="line">android:scrollbarSize="3dp"</div><div class="line">android:scrollbars="vertical"</div></pre></td></tr></table></figure>
<h3 id="Demo-2"><a href="#Demo-2" class="headerlink" title="Demo 2"></a>Demo 2</h3><p><strong>layout：</strong><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">android:scrollbarStyle="outsideOverlay"</div><div class="line">android:scrollbarThumbVertical="@color/red_square"</div><div class="line">android:scrollbarSize="3dp"</div><div class="line">android:scrollbars="vertical"</div></pre></td></tr></table></figure></p>
<h3 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h3><table>
<thead>
<tr>
<th style="text-align:center">默认样式</th>
<th style="text-align:center">Demo 1</th>
<th style="text-align:center">Demo 2</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><img src="http://img.blog.csdn.net/20160516180441093" alt="default"></td>
<td style="text-align:center"><img src="http://img.blog.csdn.net/20160516180459625" alt="demo1"></td>
<td style="text-align:center"><img src="http://img.blog.csdn.net/20160516180511849" alt="demo2"></td>
</tr>
</tbody>
</table>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>在查资料的过程中，发现滚动条也可以使用代码来画，这里不做过多介绍，有兴趣的可以研究一下。</p>
<blockquote>
<p><strong>PS</strong>：你可以通过下面的方式和我联系</p>
<ul>
<li>微博：<a href="http://weibo.com/zyansen" target="_blank" rel="external">cafeting</a></li>
<li>Github： <a href="https://github.com/likfe" target="_blank" rel="external">likfe</a></li>
<li>CSDN：<a href="http://blog.csdn.net/ys743276112" target="_blank" rel="external">他叫自己Mr.张</a> </li>
</ul>
</blockquote>
]]></content>
      
        
        <tags>
            
            <tag> Android </tag>
            
            <tag> Scrollbar </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android必知必会-获取View坐标和长宽的时机]]></title>
      <url>/2016/05/13/theTimeGetViewInfo/</url>
      <content type="html"><![CDATA[<h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>最近要实现一个功能，用到了一些属性动画，需要获取一些View的坐标信息，设计图如下：<br><a id="more"></a><br><img src="http://img.blog.csdn.net/20160513160842549" alt="design"></p>
<p>这里我使用的是<code>DialogFragment</code>来实现的，可以复用。</p>
<p>先贴一下获取View坐标的一些资料：</p>
<blockquote>
<p><a href="http://www.cnblogs.com/mengdd/p/3273284.html" target="_blank" rel="external">Android View各种尺寸位置相关的方法探究</a></p>
<p><a href="http://blog.csdn.net/ys743276112/article/details/51396319" target="_blank" rel="external"> Android获得控件在屏幕中的绝对坐标</a></p>
</blockquote>
<h3 id="合适的时机"><a href="#合适的时机" class="headerlink" title="合适的时机"></a>合适的时机</h3><p>要想获得View的坐标和长宽，必须要等到View绘制完毕，在平常写代码的生命周期函数内一般是获取不到的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Activity</span></div><div class="line">onCreate();</div><div class="line">onResume();</div><div class="line"><span class="comment">//Fragmen</span></div><div class="line">onCreate();</div><div class="line">onCreateView();</div><div class="line">onResume();</div><div class="line">onShow();</div><div class="line">setUserVisibleHint();</div></pre></td></tr></table></figure>
<p>以上这些时机都是不行的。</p>
<p>目前经过测试可用的方法是：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * 对于：Activity</span></div><div class="line"><span class="comment"> * 覆写 onWindowFocusChanged(boolean hasFocus)方法</span></div><div class="line"><span class="comment"> */</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onWindowFocusChanged</span><span class="params">(<span class="keyword">boolean</span> hasFocus)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onWindowFocusChanged(hasFocus);</div><div class="line">        <span class="keyword">int</span>[] location1 = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">2</span>] ;</div><div class="line">        view.getLocationInWindow(location1); <span class="comment">//获取在当前窗口内的绝对坐标</span></div><div class="line">        <span class="keyword">int</span>[] location2 = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">2</span>] ;</div><div class="line">        view.getLocationOnScreen(location2);<span class="comment">//获取在整个屏幕内的绝对坐标</span></div><div class="line">        <span class="comment">//do something</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * 对于：Fragmen</span></div><div class="line"><span class="comment"> * 在 onCreateView()中为View添加addOnGlobalLayoutListener</span></div><div class="line"><span class="comment"> */</span></div><div class="line">	<span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">onCreateView</span><span class="params">(LayoutInflater inflater, ViewGroup container,Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        View view = inflater.inflate(R.layout.xxx, container, <span class="keyword">false</span>);</div><div class="line">        ViewTreeObserver vto = view.getViewTreeObserver();</div><div class="line">        vto.addOnGlobalLayoutListener(<span class="keyword">new</span>  ViewTreeObserver.OnGlobalLayoutListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onGlobalLayout</span><span class="params">()</span> </span>&#123;</div><div class="line">                <span class="comment">//在这里获取View及其子控件的坐标和长宽信息</span></div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">      <span class="comment">//do something</span></div><div class="line">        <span class="keyword">return</span> view;</div><div class="line">    &#125;</div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * 对于：DialogFragment</span></div><div class="line"><span class="comment"> * 在 onCreateDialog()中为View添加addOnGlobalLayoutListener</span></div><div class="line"><span class="comment"> * PS: start-end之间的是重点，其他可以不看</span></div><div class="line"><span class="comment"> */</span></div><div class="line">	<span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Dialog <span class="title">onCreateDialog</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        LayoutInflater inflater = getActivity().getLayoutInflater();</div><div class="line">        View view = inflater.inflate(R.layout.xxxx, <span class="keyword">null</span>);</div><div class="line">      <span class="comment">//-----获取View及其子控件的坐标和长宽信息 start----</span></div><div class="line">      	ViewTreeObserver vto = view.getViewTreeObserver();</div><div class="line">        vto.addOnGlobalLayoutListener(<span class="keyword">new</span> ViewTreeObserver.OnGlobalLayoutListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onGlobalLayout</span><span class="params">()</span> </span>&#123;</div><div class="line">                <span class="comment">//在这里获取View及其子控件的坐标和长宽信息</span></div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">      <span class="comment">//-----获取View及其子控件的坐标和长宽信息 end----</span></div><div class="line">      </div><div class="line">        Dialog dialog = <span class="keyword">new</span> Dialog(getActivity(), R.style.CustomCityPickerDialog);</div><div class="line">        dialog.requestWindowFeature(Window.FEATURE_NO_TITLE);</div><div class="line">        dialog.setContentView(view);</div><div class="line">        dialog.setCanceledOnTouchOutside(<span class="keyword">true</span>);</div><div class="line">        ButterKnife.bind(<span class="keyword">this</span>, view);</div><div class="line">        <span class="comment">// 设置宽度为屏宽、靠近屏幕底部。</span></div><div class="line">        Window window = dialog.getWindow();</div><div class="line">        window.setBackgroundDrawableResource(R.color.transparent);</div><div class="line">        WindowManager.LayoutParams wlp = window.getAttributes();</div><div class="line">        wlp.gravity = Gravity.BOTTOM;</div><div class="line">        wlp.width = WindowManager.LayoutParams.MATCH_PARENT;</div><div class="line">        window.setAttributes(wlp);</div><div class="line">        <span class="keyword">return</span> dialog;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h3 id="后话"><a href="#后话" class="headerlink" title="后话"></a>后话</h3><p>这是最后的成果：<br><img src="http://o73yhoopc.bkt.clouddn.com/5EAA53013EB5AD8401EBF68B86F60F98.gif" alt="成果"></p>
<p>下一篇文章将简单总结一下最近学习的属性动画，和如何实现上图中效果。</p>
<p>PS:</p>
<blockquote>
<p>你可以关注的我 <a href="https://github.com/likfe" target="_blank" rel="external">Github</a>、<a href="http://blog.csdn.net/ys743276112" target="_blank" rel="external">CSDN</a> 和 <a href="http://weibo.com/zyansen" target="_blank" rel="external">微博</a></p>
</blockquote>
]]></content>
      
        
        <tags>
            
            <tag> Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android项目开发填坑记-9patchPng报错]]></title>
      <url>/2016/04/28/9patchAttention/</url>
      <content type="html"><![CDATA[<h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>之前写了一篇文章<a href="http://blog.csdn.net/ys743276112/article/details/45794809" target="_blank" rel="external">Android必知必会–NinePatch图片制作</a>详细介绍了Android 9Patch图片的制作和一些Demo展示，这次说明一下9Patch图片的制作的注意事项和遇到相关报错的解决方案。</p>
<h3 id="一、注意事项"><a href="#一、注意事项" class="headerlink" title="一、注意事项"></a>一、注意事项</h3><p>9Patch图片的<strong>左边框</strong>和<strong>上边框</strong>至少<strong>有一个描点</strong>，<strong>右边框</strong>和<strong>下边框</strong>则<strong>有且只有一段描点</strong>。</p>
<a id="more"></a>
<table>
<thead>
<tr>
<th style="text-align:center">边框</th>
<th style="text-align:center">描点数</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">左边框</td>
<td style="text-align:center">>=1</td>
</tr>
<tr>
<td style="text-align:center">上边框</td>
<td style="text-align:center">>=1</td>
</tr>
<tr>
<td style="text-align:center">右边框</td>
<td style="text-align:center">非0，仅仅可为1</td>
</tr>
<tr>
<td style="text-align:center">下边框</td>
<td style="text-align:center">非0，仅仅可为1</td>
</tr>
</tbody>
</table>
<p><strong>左边框</strong>和<strong>上边框</strong>留白的地方，即告诉系统那里不进行处理，保持原样。</p>
<h3 id="二、No-marked-region-found-along-edge"><a href="#二、No-marked-region-found-along-edge" class="headerlink" title="二、No marked region found along edge"></a>二、No marked region found along edge</h3><p>与<code>No marked region found along edge</code>类似和相关的，意思是某条边框或者全部的边框没有进行描点。</p>
<p><strong>解决方法</strong>：检查一下报错的那个9Patch的四条边是否都进行了描点。</p>
<h3 id="三、Can’t-have-more-than-one-marked-region-along-edge"><a href="#三、Can’t-have-more-than-one-marked-region-along-edge" class="headerlink" title="三、Can’t have more than one marked region along edge."></a>三、Can’t have more than one marked region along edge.</h3><p>与<code>Can&#39;t have more than one marked region along edge.</code>类似和相关的，意思是右边框或者下边框有一个或两边框的描点<strong>超过了一个</strong>，从【注意事项】里我们了解到这两条边框的描点数只能为1。</p>
<p><strong>解决方法</strong>：检查一下报错的那个9Patch的右边框和下边框是否描点数超过1，有可能只是描点描了一个像素，所以检查的时候建议放大多倍进行检查。</p>
<blockquote>
<p>参考: <a href="http://stackoverflow.com/questions/3733471/android-9-patch-png-what-if-i-need-smth-like-a-11-patch-png" target="_blank" rel="external">StackOverFlow</a></p>
<p><strong>PS</strong>：你可以通过下面的方式和我联系</p>
<ul>
<li>微博：<a href="http://weibo.com/zyansen" target="_blank" rel="external">cafeting</a></li>
<li>Github： <a href="https://github.com/likfe" target="_blank" rel="external">likfe</a></li>
<li>CSDN：<a href="http://blog.csdn.net/ys743276112" target="_blank" rel="external">他叫自己Mr.张</a> </li>
</ul>
</blockquote>
]]></content>
      
        
        <tags>
            
            <tag> Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android必知必会--GreenDao缓存]]></title>
      <url>/2016/04/22/greenDao-session/</url>
      <content type="html"><![CDATA[<ul>
<li><a href="http://likfe.github.io/2016/04/22/greenDao-session/" target="_blank" rel="external">Github版</a></li>
<li><a href="http://blog.csdn.net/ys743276112/article/details/50479917" target="_blank" rel="external">CSDN版</a></li>
</ul>
<p>本篇文章不是介绍GreenDao的配置和基础使用，记录一下GreenDao缓存的问题，帮助遇到同样问题的朋友找到原因和方法，下面是示例：<br><a id="more"></a></p>
<h3 id="场景重现"><a href="#场景重现" class="headerlink" title="场景重现"></a>场景重现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//第一次查询</span></div><div class="line">List chats = daoSession.getChatSessionDao()</div><div class="line">	.queryBuilder()</div><div class="line">	.orderDesc(ChatSessionDao.Properties.Updatetime)</div><div class="line">	.list();</div><div class="line"></div><div class="line"><span class="comment">//对数据库中的一条数据进行更新：</span></div><div class="line">ChatSession cs = chats.get(<span class="number">0</span>);</div><div class="line">Log.d(<span class="string">"body"</span>,cs.getBody());</div><div class="line">cs.setBody(cs.getBody() + <span class="string">"new"</span>);</div><div class="line">daoSession.getChatSessionDao().update(cs);</div><div class="line"></div><div class="line"><span class="comment">//第二次查询</span></div><div class="line">List chats = daoSession.getChatSessionDao()</div><div class="line">	.queryBuilder()</div><div class="line">	.orderDesc(ChatSessionDao.Properties.Updatetime)</div><div class="line">	.list();</div><div class="line">	</div><div class="line">Log.d(<span class="string">"body"</span>,chats.get(<span class="number">0</span>).getBody());</div></pre></td></tr></table></figure>
<p>结果发现两次的<code>body</code>的值是一样的，使用工具查看Sqlite数据库，发现<code>body</code>的值已经变化了，也就是说，我们第二次查询并没有真正执行，返回的是第一次查询的结果。如果要解决缓存问题，这里就要用到<code>DaoSession</code>的一个方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">DaoSession.clear();</div></pre></td></tr></table></figure>
<p>在示例代码中应该写在第二次查询前面<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">daoSession.clear();</div><div class="line"><span class="comment">//第二次查询</span></div><div class="line">......</div></pre></td></tr></table></figure></p>
<p>PS:这个清理缓存的方法，会清除所有表的缓存，目前没有发现可以清除单个表或者某个查询的缓存的方法。</p>
<h3 id="GreenDao配置与使用"><a href="#GreenDao配置与使用" class="headerlink" title="GreenDao配置与使用"></a>GreenDao配置与使用</h3><p>GreenDao详细的配置和Demo可以参考：</p>
<blockquote>
<ol>
<li><a href="http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2015/0727/3223.html" target="_blank" rel="external">ORM 框架之 greenDAO 使用心得</a></li>
<li><a href="http://wiki.xby1993.net/doku.php?id=greendao" target="_blank" rel="external">GreenDao</a></li>
</ol>
</blockquote>
<p>PS:</p>
<blockquote>
<p>你可以关注的我 <a href="https://github.com/likfe" target="_blank" rel="external">Github</a>、<a href="http://blog.csdn.net/ys743276112" target="_blank" rel="external">CSDN</a> 和 <a href="http://weibo.com/zyansen" target="_blank" rel="external">微博</a></p>
</blockquote>
]]></content>
      
        
        <tags>
            
            <tag> Android </tag>
            
            <tag> GreenDao </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android项目开发填坑记-Fragmen的onBackPressed]]></title>
      <url>/2016/04/20/fragmen-onBackPressed/</url>
      <content type="html"><![CDATA[<h2 id="知识背景"><a href="#知识背景" class="headerlink" title="知识背景"></a>知识背景</h2><p><code>Fragment</code>在当前的Android开发中，有两种引用方式，一个是 Android 3.0 时加入的，一个是supportV4包中的。这里简称为<code>Fragment3.0</code>和<code>FragmentV4</code>。</p>
<h2 id="Fragment中的返回"><a href="#Fragment中的返回" class="headerlink" title="Fragment中的返回"></a>Fragment中的返回</h2><p>在Fragment中经常用到自定义标题栏，而<strong>返回按钮</strong>的点击事件一般设置为：<code>getActivity().onBackPressed();</code>，这样可以使得点击返回按钮和点击手机上的返回键的效果一致，即调用所在Activity的<code>onBackPressed();</code>。</p>
<a id="more"></a>
<p>那么可能会造成一个问题：</p>
<p>本来你是想点击返回按钮让当前的<code>Fragment</code>出栈，显示上一个<code>Fragment</code>，但是却关闭了整个<code>Fragment</code>所在的<code>Activity</code>。</p>
<p>即 启动Activity–&gt;显示FragmentA–&gt;显示FragmentB–&gt;用户点击返回按钮或者手机上的返回键–&gt;退出了Activity。</p>
<h2 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h2><p>下面我们追踪一下代码调用，找找产生这种现象的原因：</p>
<h3 id="Fragment-3-0的getActivity-onBackPressed"><a href="#Fragment-3-0的getActivity-onBackPressed" class="headerlink" title="Fragment 3.0的getActivity().onBackPressed()"></a><strong>Fragment 3.0</strong>的<code>getActivity().onBackPressed()</code></h3><blockquote>
<p>Activity类</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBackPressed</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (mActionBar != <span class="keyword">null</span> &amp;&amp; mActionBar.collapseActionView()) &#123;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (!mFragments.getFragmentManager().popBackStackImmediate()) &#123;</div><div class="line">            finishAfterTransition();</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h3 id="Fragment-V4的getActivity-onBackPressed"><a href="#Fragment-V4的getActivity-onBackPressed" class="headerlink" title="Fragment V4的getActivity().onBackPressed()"></a><strong>Fragment V4</strong>的<code>getActivity().onBackPressed()</code></h3><blockquote>
<p>FragmentActivity</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBackPressed</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (!mFragments.getSupportFragmentManager().popBackStackImmediate()) &#123;</div><div class="line">            supportFinishAfterTransition();</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h3 id="真相"><a href="#真相" class="headerlink" title="真相"></a>真相</h3><p>从对代码调用的追踪，发现了真相。<code>Fragment3.0</code>和<code>FragmentV4</code></p>
<ol>
<li><code>Fragment3.0</code>的<code>getActivity().onBackPressed()</code>默认调用了<code>Activity</code>的<code>onBackPressed()</code>方法，方法里面使用的<code>getFragmentManager()</code>获取<code>FragmentManager</code>对象弹出栈内的<code>Fragment3.0</code>版的Fragment</li>
<li><code>FragmentV4</code>的<code>getActivity().onBackPressed()</code>默认调用了<code>FragmentActivity</code>的<code>onBackPressed()</code>方法，方法里面使用的<code>getSupportFragmentManager()</code>获取<code>FragmentManager</code>对象进行弹出栈内的<code>FragmentV4</code>版的Fragment</li>
</ol>
<p>简单说就是<code>Fragment3.0</code>要放在继承了<code>Activity</code>的Activity中使用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">XXX_Activity</span> <span class="keyword">extends</span> <span class="title">Activity</span></span>&#123;</div><div class="line">...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>FragmentV4</code>要放在继承了<code>FragmentActivity</code>的Activity中使用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">XXX_Activity</span> <span class="keyword">extends</span> <span class="title">FragmentActivity</span></span>&#123;</div><div class="line">...</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//或者系统默认的 FragmentActivity 的子类 AppCompatActivity</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">XXX_Activity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span></span>&#123;</div><div class="line">...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Fragment和Activity版本不匹配时"><a href="#Fragment和Activity版本不匹配时" class="headerlink" title="Fragment和Activity版本不匹配时"></a>Fragment和Activity版本不匹配时</h2><p>开发的时候，或许并不能达到Fragment版本和对应的Activity相匹配的理想状态，那么就有了下面的一个比较完善的解决方案：</p>
<h3 id="解决方案："><a href="#解决方案：" class="headerlink" title="解决方案："></a>解决方案：</h3><p>使用其匹配的Activity类的<code>onBackPressed()</code>方法的代码重写所在的<code>Activity</code>的<code>onBackPressed()</code>方法：</p>
<p><code>FragmentV4</code>配合继承了<code>Activity</code>的Activity中时：</p>
<blockquote>
<p>XXX_Activity extends Activity</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//使用FragmentActivity的onBackPressed()的代码覆盖</span></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBackPressed</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (!mFragments.getSupportFragmentManager().popBackStackImmediate()) &#123;</div><div class="line">            supportFinishAfterTransition();</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p><code>Fragment3.0</code>配合继承了<code>FragmentActivity</code>的Activity中时：</p>
<blockquote>
<p>XXX_Activity extends FragmentActivity（或者AppCompatActivity）</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//使用Activity的onBackPressed()的代码覆盖</span></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBackPressed</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (mActionBar != <span class="keyword">null</span> &amp;&amp; mActionBar.collapseActionView()) &#123;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (!mFragments.getFragmentManager().popBackStackImmediate()) &#123;</div><div class="line">            finishAfterTransition();</div><div class="line">        &#125;</div><div class="line">	&#125;</div></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>由于当前 Android Studio 默认新建的 Activity 继承于 <code>AppCompatActivity</code>,所以建议大家使用<code>FragmentV4</code>进行开发，这样能省下不少麻烦，本系列还有一篇文章介绍<code>Fragment3.0</code>使用<code>onAttach</code>时的Bug，而这个对于<code>FragmentV4</code>则没有。<br>传送门：<a href="">Android项目开发填坑记-Fragmen的onAttach方法</a></p>
<p>PS:</p>
<blockquote>
<p>你可以关注的我 <a href="https://github.com/likfe" target="_blank" rel="external">Github</a>、<a href="http://blog.csdn.net/ys743276112" target="_blank" rel="external">CSDN</a> 和 <a href="http://weibo.com/zyansen" target="_blank" rel="external">微博</a></p>
</blockquote>
]]></content>
      
        
        <tags>
            
            <tag> Android </tag>
            
            <tag> Fragment </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android项目开发填坑记-Fragmen的onAttach方法]]></title>
      <url>/2016/04/20/fragmen-onAttach/</url>
      <content type="html"><![CDATA[<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>现在Android开发多使用一个Activity管理多个Fragment进行开发，不免需要两者相互传递数据，一般是给Fragment添加回调接口，让Activity继承并实现。</p>
<p>回调接口一般都写在Fragment的<code>onAttach()</code>方法中，Fragment 3.0 的<code>onAttach()</code>方法有2个重载，其中一个被废弃，所以通常是：</p>
<a id="more"></a>
<blockquote>
<p>XX_Fragment extends Fragment(Fragment 3.0)</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAttach</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (context <span class="keyword">instanceof</span> OnCoverChangeListener) &#123;</div><div class="line">            mListener = (ABC_Listener) context;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(context.toString()</div><div class="line">                    + <span class="string">" must implement ABC_Listener"</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">super</span>.onAttach(context);</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>但是在一些特定的Android版本下，这个<code>onAttach(Context context)</code>并未被调用，而是调用了<strong>废弃的</strong><code>onAttach(Activity activity)</code>方法。</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>如果使用了Fragment 3.0，并且用到了自定义回调，那么为了兼容，需要：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAttach</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (context <span class="keyword">instanceof</span> OnCoverChangeListener) &#123;</div><div class="line">            mListener = (ABC_Listener) context;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(context.toString()</div><div class="line">                    + <span class="string">" must implement ABC_Listener"</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">super</span>.onAttach(context);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//SDK API&lt;23时，onAttach(Context)不执行，需要使用onAttach(Activity)。Fragment自身的Bug，v4的没有此问题</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAttach</span><span class="params">(Activity activity)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onAttach(activity);</div><div class="line">        <span class="keyword">if</span> (Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.M) &#123;</div><div class="line">            <span class="keyword">if</span> (activity <span class="keyword">instanceof</span> OnCoverChangeListener) &#123;</div><div class="line">                mListener = (ABC_Listener) activity;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(activity.toString()</div><div class="line">                        + <span class="string">" must implement ABC_Listener"</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>建议使用FragmentV4版的，减少不必要的系统自身Bug的处理。</p>
<p>还有一篇关于FragmentV4、Fragment3.0的<code>onBackPressed();</code>的Bug详解：<br>传送门：<a href="">Android项目开发填坑记-Fragmen的onBackPressed</a></p>
<p><strong>PS</strong>：你可以通过下面的方式和我联系</p>
<blockquote>
<ul>
<li>微博：<a href="http://weibo.com/zyansen" target="_blank" rel="external">cafeting</a></li>
<li>Github： <a href="https://github.com/likfe" target="_blank" rel="external">likfe</a></li>
<li>CSDN：<a href="http://blog.csdn.net/ys743276112" target="_blank" rel="external">他叫自己Mr.张</a> </li>
</ul>
</blockquote>
]]></content>
      
        
        <tags>
            
            <tag> Android </tag>
            
            <tag> Fragment </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android必知必会-Fragment监听返回键事件]]></title>
      <url>/2016/04/14/fragment-backpress/</url>
      <content type="html"><![CDATA[<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>项目要求用户注册成功后进入修改个人资料的页面，且不允许返回到上一个页面，资料修改完成后结束当前页面，进入APP主页。</p>
<p>由于是使用多个Fragment完成注册流程，就需要Fragment监听用户点击手机上的返回按钮，查了一些资料，加上自己使用过程中发现的问题，特此记录，帮助更多有此需求的朋友</p>
<a id="more"></a>
<h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><blockquote>
<p>XXX_Fragment</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResume</span><span class="params">()</span> </span>&#123;</div><div class="line">       <span class="keyword">super</span>.onResume();</div><div class="line">       getFocus();</div><div class="line">   &#125;</div><div class="line">   </div><div class="line"><span class="comment">//主界面获取焦点</span></div><div class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">getFocus</span><span class="params">()</span> </span>&#123;</div><div class="line">       getView().setFocusableInTouchMode(<span class="keyword">true</span>);</div><div class="line">       getView().requestFocus();</div><div class="line">       getView().setOnKeyListener(<span class="keyword">new</span> View.OnKeyListener() &#123;</div><div class="line">           <span class="meta">@Override</span></div><div class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onKey</span><span class="params">(View v, <span class="keyword">int</span> keyCode, KeyEvent event)</span> </span>&#123;</div><div class="line">               <span class="keyword">if</span> (event.getAction() == KeyEvent.ACTION_UP &amp;&amp; keyCode == KeyEvent.KEYCODE_BACK) &#123;</div><div class="line">                   <span class="comment">// 监听到返回按钮点击事件</span></div><div class="line">                   ......</div><div class="line">                  <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">               &#125;</div><div class="line">               <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">           &#125;</div><div class="line">       &#125;);</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>以上代码是<code>stackoverflow.com</code>中找到的一个解决方案，但是在使用时，由于Fragment页面里可能有其他能获取焦点的View（例如EditText），会导致监听失效，点击返回键会返回到上个页面。</p>
<h3 id="更完善的解决方案："><a href="#更完善的解决方案：" class="headerlink" title="更完善的解决方案："></a>更完善的解决方案：</h3><p>除了上面的代码，我们需要对可以获取焦点的View的<code>setOnKeyListener</code>进行处理，这里以一个EditText为例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//private EditText nickname;</span></div><div class="line"></div><div class="line">nickname.setOnKeyListener(<span class="keyword">new</span> View.OnKeyListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onKey</span><span class="params">(View v, <span class="keyword">int</span> keyCode, KeyEvent event)</span> </span>&#123;</div><div class="line">                <span class="keyword">if</span> (keyCode == KeyEvent.KEYCODE_BACK</div><div class="line">                        &amp;&amp; event.getAction() == KeyEvent.ACTION_UP) &#123;</div><div class="line">                    <span class="comment">//关闭软键盘</span></div><div class="line">                    InputMethodManager imm = (InputMethodManager) getActivity().getSystemService(Context.INPUT_METHOD_SERVICE);</div><div class="line">                    imm.hideSoftInputFromWindow(nickname.getWindowToken(), <span class="number">0</span>);</div><div class="line">                    <span class="comment">//使得根View重新获取焦点，以监听返回键</span></div><div class="line">                    getFocus();</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div></pre></td></tr></table></figure>
<p>使用到的资料：</p>
<blockquote>
<p><a href="http://blog.csdn.net/ccpat/article/details/45176665" target="_blank" rel="external">http://blog.csdn.net/ccpat/article/details/45176665</a></p>
<p><a href="http://stackoverflow.com/questions/22552958/handling-back-press-when-using-fragments-in-android" target="_blank" rel="external">http://stackoverflow.com/questions/22552958/handling-back-press-when-using-fragments-in-android</a></p>
</blockquote>
<p>PS:</p>
<blockquote>
<p>你可以关注的我 <a href="https://github.com/likfe" target="_blank" rel="external">Github</a>、<a href="http://blog.csdn.net/ys743276112" target="_blank" rel="external">CSDN</a> 和 <a href="http://weibo.com/zyansen" target="_blank" rel="external">微博</a></p>
</blockquote>
]]></content>
      
        
        <tags>
            
            <tag> Android </tag>
            
            <tag> Fragment </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android反编译 -- 错误代码还原]]></title>
      <url>/2016/04/09/My-New-Post/</url>
      <content type="html"><![CDATA[<h3 id="1-setColor-16777216"><a href="#1-setColor-16777216" class="headerlink" title="1. setColor(-16777216)"></a>1. <code>setColor(-16777216)</code></h3><p>反编译的代码中会有很多<code>setColor(int)</code>的情况，比如<code>setColor(-16777216)</code>，这个值比较特别，能轻易的查到Android文档中对这个整数的定义：</p>
<blockquote>
<p>public static final int BLACK.<br>Added in API level 1<br>Constant Value: -16777216 ( 0xff000000). </p>
</blockquote>
<p>也就是说<code>setColor(-16777216)</code>中<code>-16777216</code>对应的颜色是<strong>BLACK</strong>(0xff000000)，那么其他系统未定义成某个颜色名的值呢？</p>
<a id="more"></a>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">-16777216 对应 0xff000000</div><div class="line">       -1 对应 0xffffffff</div><div class="line"> 0xffffff 的值 16777215</div><div class="line">   </div><div class="line">那么对任意的 setColor(int)中的int值，我们可以：</div><div class="line">0xffffffff+(int)+1 或 0xffffffff-(-int+1) </div><div class="line"></div><div class="line">则对于 ：setColor(-16777216)</div><div class="line">可写成 ：setColor(0xffffffff - 16777215)) 或 setColor(-16777216 + 1 + 0xffffffff))</div><div class="line"></div><div class="line">这样，我们就不用查文档寻找特定的颜色值，也能解决任意颜色的设置。</div></pre></td></tr></table></figure>
<blockquote>
<p><a href="http://stackoverflow.com/questions/8489990/how-to-set-color-using-integer" target="_blank" rel="external">Stackoverflow : How to set color using integer?</a></p>
</blockquote>
<h3 id="2-MeasureSpec-makeMeasureSpec-xx-int"><a href="#2-MeasureSpec-makeMeasureSpec-xx-int" class="headerlink" title="2.MeasureSpec.makeMeasureSpec(xx, int)"></a>2.<code>MeasureSpec.makeMeasureSpec(xx, int)</code></h3><p>反编译的代码中<code>MeasureSpec.makeMeasureSpec(xx, int)</code>的第二个参数是个<code>int</code>类型的数，这个比较简单，直接看文档或者源码即可找到：</p>
<p>源码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MeasureSpec</span> </span>&#123;</div><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> UNSPECIFIED = <span class="number">0</span>;</div><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> EXACTLY = <span class="number">1073741824</span>;</div><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> AT_MOST = -<span class="number">2147483648</span>;</div><div class="line">        ...</div><div class="line">        &#125;</div></pre></td></tr></table></figure>
<p>文档：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">public static final int AT_MOST</div><div class="line">Added in API level 1</div><div class="line">Measure specification mode: The child can be as large as it wants up to the specified size.</div><div class="line">Constant Value: -2147483648 (0x80000000)</div><div class="line"></div><div class="line">public static final int EXACTLY</div><div class="line">Added in API level 1</div><div class="line">Measure specification mode: The parent has determined an exact size for the child. The child is going to be given those bounds regardless of how big it wants to be.</div><div class="line">Constant Value: 1073741824 (0x40000000)</div><div class="line"></div><div class="line">public static final int UNSPECIFIED</div><div class="line">Added in API level 1</div><div class="line">Measure specification mode: The parent has not imposed any constraint on the child. It can be whatever size it wants.</div><div class="line">Constant Value: 0 (0x00000000)</div></pre></td></tr></table></figure>
<p>则对于：<br><code>MeasureSpec.makeMeasureSpec(xx, 0)</code><br>我们应该修改为<br><code>MeasureSpec.makeMeasureSpec(xx, View.MeasureSpec.UNSPECIFIED)</code></p>
<p>其他依次类推。</p>
<h3 id="3-setVisibility-int"><a href="#3-setVisibility-int" class="headerlink" title="3.setVisibility(int)"></a>3.<code>setVisibility(int)</code></h3><p>这个同<strong>[2]</strong>,看文档或者看源码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> VISIBLE = <span class="number">0</span>;</div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> INVISIBLE = <span class="number">4</span>;</div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> GONE = <span class="number">8</span>;</div></pre></td></tr></table></figure>
<p>则对于：<code>setVisibility(0)</code> ==&gt; <code>setVisibility(View.VISIBLE)</code></p>
<p>其他依次类推。</p>
<h3 id="4-new-Runnable"><a href="#4-new-Runnable" class="headerlink" title="4.new Runnable()..."></a>4.<code>new Runnable()...</code></h3><p>反编译的代码中：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">new</span> Runnable() &#123;</div><div class="line">    <span class="keyword">final</span> <span class="comment">/* synthetic */</span> AbstractButton a;</div><div class="line">		&#123;</div><div class="line">       	<span class="keyword">this</span>.a = r1;</div><div class="line">       &#125;</div><div class="line"></div><div class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">          <span class="keyword">this</span>.a.xxxxx();</div><div class="line">       &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>可直接去掉成员变量：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">new</span> Runnable() &#123;</div><div class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">          xxxxx();</div><div class="line">       &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h3 id="5-new-Handler"><a href="#5-new-Handler" class="headerlink" title="5.new Handler()..."></a>5.<code>new Handler()...</code></h3><p>同<code>[4]</code>,直接去掉成员变量:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">new</span> Handler() &#123;</div><div class="line">            <span class="keyword">final</span> <span class="comment">/* synthetic */</span> ButtonSave a;</div><div class="line"></div><div class="line">            &#123;</div><div class="line">                <span class="keyword">this</span>.a = r1;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message message)</span> </span>&#123;</div><div class="line">            		<span class="keyword">this</span>.a.xxx();</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line"><span class="comment">//修改为</span></div><div class="line"><span class="keyword">new</span> Handler() &#123;</div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message message)</span> </span>&#123;</div><div class="line">                xxx();</div><div class="line">            &#125;</div><div class="line">        &#125;;</div></pre></td></tr></table></figure>
<h3 id="6-context-getSystemService-quot-layout-inflater-quot"><a href="#6-context-getSystemService-quot-layout-inflater-quot" class="headerlink" title="6.context.getSystemService(&quot;layout_inflater&quot;)"></a>6.<code>context.getSystemService(&quot;layout_inflater&quot;)</code></h3><p>直接看源码即可：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String POWER_SERVICE = <span class="string">"power"</span>;</div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String WINDOW_SERVICE = <span class="string">"window"</span>;</div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String LAYOUT_INFLATER_SERVICE = <span class="string">"layout_inflater"</span>;</div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String ACCOUNT_SERVICE = <span class="string">"account"</span>;</div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String ACTIVITY_SERVICE = <span class="string">"activity"</span>;</div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String ALARM_SERVICE = <span class="string">"alarm"</span>;</div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String NOTIFICATION_SERVICE = <span class="string">"notification"</span>;</div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String ACCESSIBILITY_SERVICE = <span class="string">"accessibility"</span>;</div><div class="line">...</div></pre></td></tr></table></figure>
<p>则<code>context.getSystemService(&quot;layout_inflater&quot;)</code> ==&gt; <code>context.getSystemService(Context.LAYOUT_INFLATER_SERVICE)</code></p>
<p>其他依次类推。</p>
<h3 id="7-intent-setFlags-335544320"><a href="#7-intent-setFlags-335544320" class="headerlink" title="7.intent.setFlags(335544320)"></a>7.<code>intent.setFlags(335544320)</code></h3><p>先看源码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">Intent implements Parcelable, Cloneable  &#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> FLAG_GRANT_READ_URI_PERMISSION = <span class="number">1</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> FLAG_GRANT_WRITE_URI_PERMISSION = <span class="number">2</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> FLAG_FROM_BACKGROUND = <span class="number">4</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> FLAG_DEBUG_LOG_RESOLUTION = <span class="number">8</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> FLAG_EXCLUDE_STOPPED_PACKAGES = <span class="number">16</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> FLAG_INCLUDE_STOPPED_PACKAGES = <span class="number">32</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> FLAG_ACTIVITY_NO_HISTORY = <span class="number">1073741824</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> FLAG_ACTIVITY_SINGLE_TOP = <span class="number">536870912</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> FLAG_ACTIVITY_NEW_TASK = <span class="number">268435456</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> FLAG_ACTIVITY_MULTIPLE_TASK = <span class="number">134217728</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> FLAG_ACTIVITY_CLEAR_TOP = <span class="number">67108864</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> FLAG_ACTIVITY_FORWARD_RESULT = <span class="number">33554432</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> FLAG_ACTIVITY_PREVIOUS_IS_TOP = <span class="number">16777216</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> FLAG_ACTIVITY_EXCLUDE_FROM_RECENTS = <span class="number">8388608</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> FLAG_ACTIVITY_BROUGHT_TO_FRONT = <span class="number">4194304</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> FLAG_ACTIVITY_RESET_TASK_IF_NEEDED = <span class="number">2097152</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> FLAG_ACTIVITY_LAUNCHED_FROM_HISTORY = <span class="number">1048576</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> FLAG_ACTIVITY_CLEAR_WHEN_TASK_RESET = <span class="number">524288</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> FLAG_ACTIVITY_NO_USER_ACTION = <span class="number">262144</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> FLAG_ACTIVITY_REORDER_TO_FRONT = <span class="number">131072</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> FLAG_ACTIVITY_NO_ANIMATION = <span class="number">65536</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> FLAG_ACTIVITY_CLEAR_TASK = <span class="number">32768</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> FLAG_ACTIVITY_TASK_ON_HOME = <span class="number">16384</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> FLAG_RECEIVER_REGISTERED_ONLY = <span class="number">1073741824</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> FLAG_RECEIVER_REPLACE_PENDING = <span class="number">536870912</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> FLAG_RECEIVER_FOREGROUND = <span class="number">268435456</span>;</div></pre></td></tr></table></figure>
<p>那么对于<code>intent.setFlags(int);</code> 中 <code>int</code>值是上面四种之一的话就比较简单，例如：</p>
<p><code>intent.setFlags(536870912);</code> ==&gt; <code>intent.setFlags(PendingIntent.FLAG_NO_CREATE);</code> </p>
<p>但是遇到一个比较特别的：<code>intent.setFlags(335544320);</code></p>
<p>源码里根本没有这样一个值啊，其实<code>intent.setFlags( A | B )</code>是可以使用<code>|(或运算)</code>的，那么：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">10000000000000000000000000000 = 268435456</div><div class="line">					|				|</div><div class="line">  100000000000000000000000000 =  67108864</div><div class="line">10100000000000000000000000000 = 335544320</div><div class="line"></div><div class="line">即 268435456 | 67108864 = 335544320</div></pre></td></tr></table></figure>
<p>从而:</p>
<p><code>intent.setFlags(335544320);</code>==&gt;</p>
<p><code>intent.setFlags( FLAG_ACTIVITY_NEW_TASK | FLAG_ACTIVITY_CLEAR_TOP )</code></p>
<p>或者</p>
<p><code>intent.setFlags( FLAG_RECEIVER_FOREGROUND | FLAG_ACTIVITY_CLEAR_TOP )</code></p>
<p>从 <a href="https://www.codota.com" target="_blank" rel="external">Codota</a> 中搜索<code>intent.setFlags(335544320);</code>看到的是第一种情况，结合<code>intent.setFlags()</code>的用法，应该也是第一种情况。</p>
<p>相关资料：</p>
<blockquote>
<p><a href="http://farwmarth.com/2013/04/23/android%20反编译和代码解读/" target="_blank" rel="external">http://farwmarth.com/2013/04/23/android%20反编译和代码解读/</a></p>
</blockquote>
<p>PS:</p>
<blockquote>
<p>本文已整理到Github上，欢迎提交更多代码！</p>
<p>你可以关注的我 <a href="https://github.com/likfe" target="_blank" rel="external">Github</a>、<a href="http://blog.csdn.net/ys743276112" target="_blank" rel="external">CSDN</a> 和 <a href="http://weibo.com/zyansen" target="_blank" rel="external">微博</a></p>
</blockquote>
]]></content>
      
        
        <tags>
            
            <tag> Android </tag>
            
            <tag> 反编译 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Hello World]]></title>
      <url>/2016/04/09/hello-world/</url>
      <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>
]]></content>
      
        
    </entry>
    
  
  
</search>
